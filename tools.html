<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Dispatch Tools â€” Eagle Academy</title>
<link rel="stylesheet" href="assets/style.css"/>
<style>
:root{
  --navy-dark:#03041a;
  --font-main:'DM Sans',sans-serif;
  --font-head:'Syne',sans-serif;
  --font-mono:'JetBrains Mono',monospace;
  --font-hindi:'Noto Sans Devanagari',sans-serif;
  --radius-md:12px;
  --radius-lg:18px;
  --radius-xl:24px;
  --transition:all .22s ease;
}
.tools-hero{background:linear-gradient(135deg,var(--navy-dark) 0%,var(--navy) 60%,rgba(6,182,212,0.08) 100%);padding:40px 24px 32px;border-bottom:1px solid rgba(6,182,212,0.15);position:relative;overflow:hidden}
.tools-hero::before{content:'âš™';position:absolute;right:4%;top:10px;font-size:200px;opacity:.03;pointer-events:none}
.th-inner{max-width:1200px;margin:0 auto}
.tools-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:20px;max-width:1200px;margin:0 auto;padding:32px 24px}
.tool-card{background:rgba(255,255,255,0.025);border:1px solid rgba(255,255,255,0.08);border-radius:var(--radius-xl);overflow:hidden;transition:var(--transition)}
.tool-card:hover{border-color:rgba(6,182,212,0.3);transform:translateY(-2px)}
.tool-head{padding:20px 22px 14px;border-bottom:1px solid rgba(255,255,255,0.06);display:flex;align-items:center;gap:12px}
.tool-icon{width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0}
.tool-body{padding:20px 22px}
.tl{display:block;font-size:12px;color:var(--grey);font-family:var(--font-mono);margin-bottom:5px;font-weight:600;text-transform:uppercase;letter-spacing:.5px}
.tf{width:100%;padding:10px 14px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:var(--radius-md);color:var(--white);font-family:var(--font-main);font-size:14px;outline:none;transition:border-color .2s;margin-bottom:12px;-webkit-appearance:none}
.tf:focus{border-color:var(--cyan)}
.tf-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.result-box{background:rgba(6,182,212,0.08);border:1px solid rgba(6,182,212,0.25);border-radius:var(--radius-md);padding:14px 16px;margin-top:4px}
.result-main{font-family:var(--font-head);font-size:28px;font-weight:900;color:var(--cyan);line-height:1}
.result-sub{font-size:12px;color:var(--grey);margin-top:4px;line-height:1.6}
.result-good{background:rgba(34,197,94,0.08);border-color:rgba(34,197,94,0.3);}.result-good .result-main{color:var(--green)}
.result-warn{background:rgba(249,115,22,0.08);border-color:rgba(249,115,22,0.3);}.result-warn .result-main{color:var(--orange)}
.result-bad{background:rgba(239,68,68,0.08);border-color:rgba(239,68,68,0.3);}.result-bad .result-main{color:var(--red)}
.calc-btn{width:100%;padding:11px;background:linear-gradient(135deg,var(--cyan),#0891b2);border:none;border-radius:var(--radius-md);color:white;font-family:var(--font-main);font-size:14px;font-weight:700;cursor:pointer;transition:var(--transition);margin-bottom:10px}
.calc-btn:hover{filter:brightness(1.1);transform:translateY(-1px)}
.seg{display:flex;gap:4px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);border-radius:var(--radius-md);padding:4px;margin-bottom:12px}
.seg-btn{flex:1;padding:7px 10px;background:transparent;border:none;border-radius:9px;color:var(--grey);font-family:var(--font-main);font-size:13px;font-weight:600;cursor:pointer;transition:var(--transition)}
.seg-btn.act{background:linear-gradient(135deg,var(--cyan),#0891b2);color:white}
.mini-grid{display:grid;gap:8px;margin-top:10px}
.tz-row{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.07);border-radius:10px}
.tz-flag{font-size:18px}
.tz-time{font-family:var(--font-mono);font-size:18px;font-weight:700}
.tz-label{font-size:11px;color:var(--grey);margin-top:2px}
.india-tz{border-color:rgba(249,115,22,0.3);background:rgba(249,115,22,0.06)}
.india-tz .tz-time{color:var(--orange)}
.uk-tz{border-color:rgba(34,197,94,0.3);background:rgba(34,197,94,0.06)}
.uk-tz .tz-time{color:var(--green)}
.usa-e-tz{border-color:rgba(6,182,212,0.3);background:rgba(6,182,212,0.06)}
.usa-e-tz .tz-time{color:var(--cyan)}
.usa-c-tz{border-color:rgba(99,102,241,0.3);background:rgba(99,102,241,0.06)}
.usa-c-tz .tz-time{color:#a78bfa}
.hours-vis{display:grid;grid-template-columns:repeat(24,1fr);gap:1px;margin-top:10px;border-radius:8px;overflow:hidden}
.hv-cell{height:14px;background:rgba(255,255,255,0.06);position:relative;cursor:default}
.hv-cell.drive{background:var(--green)}
.hv-cell.break{background:var(--orange)}
.hv-cell.rest{background:var(--red)}
.hv-cell.load{background:var(--cyan)}
.hv-legend{display:flex;gap:12px;flex-wrap:wrap;margin-top:8px;font-size:11px}
.hv-dot{width:10px;height:10px;border-radius:2px;flex-shrink:0;margin-top:1px}
select.tf option{background:#0d0c2e;color:white}
.hi-note{font-family:var(--font-hindi);font-size:13px;color:rgba(255,200,80,0.8);margin-top:6px;display:none}
.chi.show .hi-note{display:block}
.divider-label{font-size:11px;color:var(--grey);text-align:center;position:relative;margin:10px 0}
.divider-label::before,.divider-label::after{content:'';position:absolute;top:50%;width:42%;height:1px;background:rgba(255,255,255,0.07)}
.divider-label::before{left:0}.divider-label::after{right:0}
</style>
</head>
<body>

<header class="ea-header">
  <div class="ea-header-inner">
    <a href="index.html" class="ea-logo">
      <img src="assets/logo.png" alt="Eagle Academy" onerror="this.style.display='none'"/>
      <div class="ea-logo-text"><div class="brand">EAGLE ACADEMY</div><div class="sub">Freight Dispatcher Certification</div></div>
    </a>
    <nav class="ea-nav">
      <a href="index.html" class="ea-nav-btn">ğŸ  Home</a>
      <a href="week1.html" class="ea-nav-btn">Week 1</a>
      <a href="week2.html" class="ea-nav-btn">Week 2</a>
      <a href="week3.html" class="ea-nav-btn">Week 3</a>
      <a href="week4.html" class="ea-nav-btn">Week 4</a>
      <a href="tools.html" class="ea-nav-btn active">ğŸ§® Tools</a>
      <a href="madam-ji.html" class="ea-nav-btn">ğŸ“ Madam JI</a>
      <a href="exam.html" class="ea-nav-btn">ğŸ“ Final Exam</a>
    </nav>
    <div class="lang-toggle">
      <button class="lang-btn active" onclick="setLang('en',this)">EN</button>
      <button class="lang-btn" onclick="setLang('hi',this)">à¤¹à¤¿à¤‚</button>
    </div>
  </div>
</header>

<div class="ticker-wrap"><div class="ticker-inner" style="color:var(--cyan);font-family:var(--font-mono);font-size:12px">
  <span>ğŸ§® 7 Live Tools</span><span>ğŸ’· UK Rate Calculator â€” Â£/mile</span><span>â± UK Drivers' Hours Checker</span><span>ğŸ‡¬ğŸ‡§â†”ğŸ‡®ğŸ‡³ Time Zone Converter</span><span>ğŸ“‹ Tachograph & WTD Checker</span><span>ğŸš› Detention Pay</span><span>ğŸ“Š Load Profitability</span><span>ğŸ” Empty Running %</span><span>âœ… UK Compliance First</span><span>ğŸ§® 7 Live Tools</span><span>ğŸ’· UK Rate Calculator â€” Â£/mile</span><span>â± UK Drivers' Hours â€” Tachograph</span>
</div></div>

<section class="tools-hero">
  <div class="th-inner">
    <div style="display:flex;align-items:center;gap:14px;margin-bottom:14px">
      <span class="tag tag-cyan">Phase 5</span>
      <span class="tag tag-green">ğŸ‡¬ğŸ‡§ UK Primary</span>
      <span class="tag tag-orange">7 Tools</span>
    </div>
    <h1 style="font-family:var(--font-head);font-size:clamp(24px,4vw,40px);font-weight:900;margin-bottom:6px">Dispatcher Toolbox</h1>
    <p style="font-size:14px;color:var(--grey)">Live calculators for UK &amp; USA freight dispatch â€” rates, hours, commissions, time zones and more</p>
    <p style="font-size:13px;color:var(--cyan);font-family:var(--font-hindi);margin-top:4px">à¤¡à¤¿à¤¸à¥à¤ªà¥ˆà¤šà¤° à¤Ÿà¥‚à¤²à¤¬à¥‰à¤•à¥à¤¸ â€” UK à¤”à¤° USA à¤«à¥à¤°à¥‡à¤Ÿ à¤•à¥‡ à¤²à¤¿à¤ à¤²à¤¾à¤‡à¤µ à¤•à¥ˆà¤²à¤•à¥à¤²à¥‡à¤Ÿà¤°</p>
  </div>
</section>

<div class="tools-grid">

  <!-- â•â•â• TOOL 1: UK Rate Calculator â•â•â• -->
  <div class="tool-card">
    <div class="tool-head">
      <div class="tool-icon" style="background:rgba(34,197,94,0.15)">ğŸ’·</div>
      <div>
        <div style="font-family:var(--font-head);font-size:15px;font-weight:800">UK Rate Calculator</div>
        <div style="font-size:11px;color:var(--grey)">Cost per mile Â· Revenue per mile Â· Profitability</div>
      </div>
    </div>
    <div class="tool-body">
      <div class="seg" id="seg_rate">
        <button class="seg-btn act" onclick="segSwitch('seg_rate',this,'r_uk')">ğŸ‡¬ğŸ‡§ UK (Â£/mile)</button>
        <button class="seg-btn" onclick="segSwitch('seg_rate',this,'r_us')">ğŸ‡ºğŸ‡¸ USA ($/mile)</button>
      </div>

      <div id="r_uk" data-seg="seg_rate">
        <label class="tl">Vehicle Type</label>
        <select class="tf" id="r_uk_vtype" onchange="setUKVehicleDefaults();calcUKRate()" style="margin-bottom:10px">
          <option value="artic">ğŸš› Artic (44t) â€” Â£1.50/mile default</option>
          <option value="rigid">ğŸšš Rigid HGV (18t) â€” Â£1.25/mile default</option>
          <option value="van">ğŸš LWB/XL Van â€” Â£0.85/mile default</option>
        </select>
        <label class="tl">Load Rate (Â£)</label>
        <input type="number" class="tf" id="r_uk_rate" placeholder="e.g. 1200" oninput="calcUKRate()"/>
        <div class="tf-row">
          <div><label class="tl">Miles</label><input type="number" class="tf" id="r_uk_miles" placeholder="e.g. 240" oninput="calcUKRate()"/></div>
          <div><label class="tl">Cost/Mile (Â£)</label><input type="number" class="tf" id="r_uk_cpm" placeholder="1.50" value="1.50" step="0.05" oninput="calcUKRate()"/></div>
        </div>
        <div id="r_uk_result" class="result-box" style="display:none">
          <div class="result-main" id="r_uk_rpm">â€”</div>
          <div class="result-sub" id="r_uk_sub">â€”</div>
        </div>
      </div>

      <div id="r_us" data-seg="seg_rate" style="display:none">
        <label class="tl">Vehicle Type</label>
        <select class="tf" id="r_us_vtype" onchange="setUSVehicleDefaults();calcUSRate()" style="margin-bottom:10px">
          <option value="semi">ğŸš› Semi/18-Wheeler â€” $1.65/mile default</option>
          <option value="straight">ğŸšš Straight Truck â€” $1.30/mile default</option>
          <option value="sprinter">ğŸš Sprinter/Cargo Van â€” $0.95/mile default</option>
        </select>
        <label class="tl">Load Rate ($)</label>
        <input type="number" class="tf" id="r_us_rate" placeholder="e.g. 2800" oninput="calcUSRate()"/>
        <div class="tf-row">
          <div><label class="tl">Miles</label><input type="number" class="tf" id="r_us_miles" placeholder="e.g. 950" oninput="calcUSRate()"/></div>
          <div><label class="tl">Cost/Mile ($)</label><input type="number" class="tf" id="r_us_cpm" placeholder="1.65" value="1.65" step="0.05" oninput="calcUSRate()"/></div>
        </div>
        <div id="r_us_result" class="result-box" style="display:none">
          <div class="result-main" id="r_us_rpm">â€”</div>
          <div class="result-sub" id="r_us_sub">â€”</div>
        </div>
      </div>

      <div class="hi-note chi">UK à¤®à¥‡à¤‚ Â£2.50/à¤®à¥€à¤² à¤¸à¥‡ à¤Šà¤ªà¤° = à¤…à¤šà¥à¤›à¤¾à¥¤ Â£2.00 à¤¸à¥‡ à¤¨à¥€à¤šà¥‡ = à¤œà¤¾à¤‚à¤šà¥‡à¤‚à¥¤ USA à¤®à¥‡à¤‚ $2.50 à¤¸à¥‡ à¤Šà¤ªà¤° = à¤…à¤šà¥à¤›à¤¾à¥¤</div>
    </div>
  </div>

  <!-- â•â•â• TOOL 2: UK Drivers Hours Checker â•â•â• -->
  <div class="tool-card">
    <div class="tool-head">
      <div class="tool-icon" style="background:rgba(249,115,22,0.15)">â±</div>
      <div>
        <div style="font-family:var(--font-head);font-size:15px;font-weight:800">UK Drivers' Hours Checker</div>
        <div style="font-size:11px;color:var(--grey)">Can they legally complete this load?</div>
      </div>
    </div>
    <div class="tool-body">
      <div class="tf-row">
        <div><label class="tl">Shift Start</label><input type="time" class="tf" id="h_start" value="06:00" oninput="calcHours()"/></div>
        <div><label class="tl">Drive Distance (miles)</label><input type="number" class="tf" id="h_miles" placeholder="e.g. 260" oninput="calcHours()"/></div>
      </div>
      <div class="tf-row">
        <div><label class="tl">Avg Speed (mph)</label><input type="number" class="tf" id="h_speed" placeholder="50" value="50" oninput="calcHours()"/></div>
        <div><label class="tl">Loading Time (mins)</label><input type="number" class="tf" id="h_load" placeholder="60" value="60" oninput="calcHours()"/></div>
      </div>
      <div class="tf-row">
        <div><label class="tl">Hours Already Driven</label><input type="number" class="tf" id="h_used" placeholder="0" value="0" step="0.5" oninput="calcHours()"/></div>
        <div><label class="tl">Extended Day? (Ã—2/wk max)</label>
          <select class="tf" id="h_ext" onchange="calcHours()">
            <option value="9">No â€” 9hr max</option>
            <option value="10">Yes â€” 10hr max</option>
          </select>
        </div>
      </div>

      <div id="h_result" class="result-box" style="display:none">
        <div class="result-main" id="h_verdict">â€”</div>
        <div class="result-sub" id="h_detail">â€”</div>
      </div>

      <div style="margin-top:10px">
        <div style="font-size:11px;color:var(--grey);margin-bottom:5px;font-family:var(--font-mono);font-weight:600">24HR TIMELINE</div>
        <div class="hours-vis" id="h_vis"></div>
        <div class="hv-legend">
          <div style="display:flex;align-items:center;gap:4px"><div class="hv-dot" style="background:var(--green)"></div><span style="font-size:11px;color:var(--grey)">Drive</span></div>
          <div style="display:flex;align-items:center;gap:4px"><div class="hv-dot" style="background:var(--orange)"></div><span style="font-size:11px;color:var(--grey)">Break</span></div>
          <div style="display:flex;align-items:center;gap:4px"><div class="hv-dot" style="background:var(--cyan)"></div><span style="font-size:11px;color:var(--grey)">Load/Unload</span></div>
          <div style="display:flex;align-items:center;gap:4px"><div class="hv-dot" style="background:var(--red)"></div><span style="font-size:11px;color:var(--grey)">Rest Required</span></div>
        </div>
      </div>
      <div class="hi-note chi">4.5 à¤˜à¤‚à¤Ÿà¥‡ à¤¡à¥à¤°à¤¾à¤‡à¤µ â†’ 45 à¤®à¤¿à¤¨à¤Ÿ à¤¬à¥à¤°à¥‡à¤• à¤…à¤¨à¤¿à¤µà¤¾à¤°à¥à¤¯à¥¤ à¤¦à¥ˆà¤¨à¤¿à¤• à¤…à¤§à¤¿à¤•à¤¤à¤®: 9 à¤˜à¤‚à¤Ÿà¥‡ (à¤¸à¤ªà¥à¤¤à¤¾à¤¹ à¤®à¥‡à¤‚ 2 à¤¬à¤¾à¤° 10 à¤˜à¤‚à¤Ÿà¥‡)à¥¤</div>
    </div>
  </div>

  <!-- â•â•â• TOOL 3: Time Zone Converter â•â•â• -->
  <div class="tool-card">
    <div class="tool-head">
      <div class="tool-icon" style="background:rgba(6,182,212,0.15)">ğŸŒ</div>
      <div>
        <div style="font-family:var(--font-head);font-size:15px;font-weight:800">Time Zone Converter</div>
        <div style="font-size:11px;color:var(--grey)">India â†” UK â†” USA Â· Live &amp; manual</div>
      </div>
    </div>
    <div class="tool-body">
      <div style="display:flex;gap:10px;align-items:center;margin-bottom:14px">
        <button class="calc-btn" style="margin:0;flex:1" onclick="setNow()">ğŸ• Set to Now</button>
        <div style="flex:1">
          <label class="tl">Set Custom Time (IST)</label>
          <input type="time" class="tf" id="tz_input" style="margin-bottom:0" oninput="convertTZ()"/>
        </div>
      </div>

      <div class="mini-grid">
        <div class="tz-row india-tz">
          <div style="display:flex;align-items:center;gap:10px"><span class="tz-flag">ğŸ‡®ğŸ‡³</span><div><div style="font-size:13px;font-weight:700">India (IST)</div><div class="tz-label">UTC +5:30</div></div></div>
          <div style="text-align:right"><div class="tz-time" id="tz_ist">â€”</div><div class="tz-label" id="tz_ist_d">â€”</div></div>
        </div>
        <div class="tz-row uk-tz">
          <div style="display:flex;align-items:center;gap:10px"><span class="tz-flag">ğŸ‡¬ğŸ‡§</span><div><div style="font-size:13px;font-weight:700">UK (GMT/BST)</div><div class="tz-label" id="tz_uk_offset">UTC +0 / +1 BST</div></div></div>
          <div style="text-align:right"><div class="tz-time" id="tz_uk">â€”</div><div class="tz-label" id="tz_uk_status">â€”</div></div>
        </div>
        <div class="tz-row usa-e-tz">
          <div style="display:flex;align-items:center;gap:10px"><span class="tz-flag">ğŸ‡ºğŸ‡¸</span><div><div style="font-size:13px;font-weight:700">USA East (EST/EDT)</div><div class="tz-label">UTC -5 / -4</div></div></div>
          <div style="text-align:right"><div class="tz-time" id="tz_est">â€”</div><div class="tz-label" id="tz_est_status">â€”</div></div>
        </div>
        <div class="tz-row usa-c-tz">
          <div style="display:flex;align-items:center;gap:10px"><span class="tz-flag">ğŸ‡ºğŸ‡¸</span><div><div style="font-size:13px;font-weight:700">USA Central (CST/CDT)</div><div class="tz-label">UTC -6 / -5</div></div></div>
          <div style="text-align:right"><div class="tz-time" id="tz_cst">â€”</div><div class="tz-label" id="tz_cst_status">â€”</div></div>
        </div>
      </div>

      <div id="tz_advice" style="font-size:12px;color:var(--grey);margin-top:10px;padding:10px 12px;background:rgba(255,255,255,0.03);border-radius:8px;line-height:1.7"></div>
      <div class="hi-note chi">UK = IST à¤¸à¥‡ 5:30 à¤˜à¤‚à¤Ÿà¥‡ à¤ªà¥€à¤›à¥‡à¥¤ UK à¤¸à¥à¤¬à¤¹ 8 à¤¬à¤œà¥‡ = à¤­à¤¾à¤°à¤¤ à¤¦à¥‹à¤ªà¤¹à¤° 1:30 à¤¬à¤œà¥‡à¥¤ USA (EST) = IST à¤¸à¥‡ 10:30 à¤˜à¤‚à¤Ÿà¥‡ à¤ªà¥€à¤›à¥‡à¥¤</div>
    </div>
  </div>

  <!-- â•â•â• TOOL 4: UK Tachograph & WTD Checker â•â•â• -->
  <div class="tool-card">
    <div class="tool-head">
      <div class="tool-icon" style="background:rgba(139,92,246,0.15)">ğŸ“‹</div>
      <div>
        <div style="font-family:var(--font-head);font-size:15px;font-weight:800">Tachograph & WTD Checker</div>
        <div style="font-size:11px;color:var(--grey)">UK compliance Â· Infringement type Â· WTD 48hr check</div>
      </div>
    </div>
    <div class="tool-body">
      <div class="seg" id="seg_tacho">
        <button class="seg-btn act" onclick="segSwitch('seg_tacho',this,'tc_daily')">Daily Hours</button>
        <button class="seg-btn" onclick="segSwitch('seg_tacho',this,'tc_wtd')">WTD Weekly</button>
      </div>

      <!-- Daily check -->
      <div id="tc_daily" data-seg="seg_tacho">
        <div class="tf-row">
          <div><label class="tl">Driving Time (hrs)</label><input type="number" class="tf" id="tc_drive" placeholder="e.g. 9.5" step="0.5" oninput="calcTacho()"/></div>
          <div><label class="tl">On-Duty Time (hrs)</label><input type="number" class="tf" id="tc_duty" placeholder="e.g. 11" step="0.5" oninput="calcTacho()"/></div>
        </div>
        <div class="tf-row">
          <div><label class="tl">Rest Period (hrs)</label><input type="number" class="tf" id="tc_rest" placeholder="e.g. 11" step="0.5" oninput="calcTacho()"/></div>
          <div><label class="tl">Extensions used this week</label><input type="number" class="tf" id="tc_ext" placeholder="0" min="0" max="2" oninput="calcTacho()"/></div>
        </div>
      </div>

      <!-- WTD check -->
      <div id="tc_wtd" data-seg="seg_tacho" style="display:none">
        <label class="tl">Total Working Hours This Week</label>
        <input type="number" class="tf" id="tc_wtd_hrs" placeholder="e.g. 52" step="0.5" oninput="calcWTD()"/>
        <label class="tl" style="margin-top:8px">Opt-Out Agreement Signed?</label>
        <div class="seg" id="seg_optout" style="margin-top:4px">
          <button class="seg-btn act" id="optout_no" onclick="segSwitch('seg_optout',this,'dummy1');calcWTD()">No</button>
          <button class="seg-btn" id="optout_yes" onclick="segSwitch('seg_optout',this,'dummy2');calcWTD()">Yes (signed)</button>
        </div>
        <div id="dummy1" data-seg="seg_optout" style="display:none"></div>
        <div id="dummy2" data-seg="seg_optout" style="display:none"></div>
      </div>

      <div id="tc_result" class="result-box" style="display:none">
        <div class="result-main" id="tc_verdict">â€”</div>
        <div class="result-sub" id="tc_detail">â€”</div>
      </div>
      <div class="hi-note chi">UK à¤®à¥‡à¤‚ à¤¡à¥à¤°à¤¾à¤‡à¤µà¤° à¤…à¤§à¤¿à¤•à¤¤à¤® 9 à¤˜à¤‚à¤Ÿà¥‡ (à¤¸à¤ªà¥à¤¤à¤¾à¤¹ à¤®à¥‡à¤‚ à¤¦à¥‹ à¤¬à¤¾à¤° 10 à¤˜à¤‚à¤Ÿà¥‡) à¤—à¤¾à¤¡à¤¼à¥€ à¤šà¤²à¤¾ à¤¸à¤•à¤¤à¤¾ à¤¹à¥ˆà¥¤ WTD à¤¨à¤¿à¤¯à¤®: à¤”à¤¸à¤¤à¤¨ 48 à¤˜à¤‚à¤Ÿà¥‡ à¤ªà¥à¤°à¤¤à¤¿ à¤¸à¤ªà¥à¤¤à¤¾à¤¹à¥¤</div>
    </div>
  </div>

  <!-- â•â•â• TOOL 5: Detention Pay â•â•â• -->
  <div class="tool-card">
    <div class="tool-head">
      <div class="tool-icon" style="background:rgba(239,68,68,0.15)">ğŸ•</div>
      <div>
        <div style="font-family:var(--font-head);font-size:15px;font-weight:800">Detention Pay Calculator</div>
        <div style="font-size:11px;color:var(--grey)">UK &amp; USA Â· How much to claim</div>
      </div>
    </div>
    <div class="tool-body">
      <div class="seg" id="seg_det">
        <button class="seg-btn act" onclick="segSwitch('seg_det',this,'det_uk');calcDet()">ğŸ‡¬ğŸ‡§ UK</button>
        <button class="seg-btn" onclick="segSwitch('seg_det',this,'det_us');calcDet()">ğŸ‡ºğŸ‡¸ USA</button>
      </div>

      <div id="det_uk" data-seg="seg_det">
        <div class="tf-row">
          <div><label class="tl">Arrived Time</label><input type="time" class="tf" id="det_uk_arr" value="09:00" oninput="calcDet()"/></div>
          <div><label class="tl">Departed / Released</label><input type="time" class="tf" id="det_uk_dep" value="12:00" oninput="calcDet()"/></div>
        </div>
        <div><label class="tl">UK Detention Rate (Â£/hr)</label><input type="number" class="tf" id="det_uk_rate" placeholder="25" value="25" oninput="calcDet()"/></div>
        <div style="font-size:11px;color:var(--grey);margin-bottom:10px">2 free hours included. Detention billed after that.</div>
      </div>

      <div id="det_us" data-seg="seg_det" style="display:none">
        <div class="tf-row">
          <div><label class="tl">Arrived Time</label><input type="time" class="tf" id="det_us_arr" value="09:00" oninput="calcDet()"/></div>
          <div><label class="tl">Departed / Released</label><input type="time" class="tf" id="det_us_dep" value="12:00" oninput="calcDet()"/></div>
        </div>
        <div><label class="tl">Detention Rate ($/hr)</label><input type="number" class="tf" id="det_us_rate" placeholder="50" value="50" oninput="calcDet()"/></div>
        <div style="font-size:11px;color:var(--grey);margin-bottom:10px">2 free hours included. Detention billed after that.</div>
      </div>

      <div id="det_result" class="result-box" style="display:none">
        <div class="result-main" id="det_amount">â€”</div>
        <div class="result-sub" id="det_detail">â€”</div>
      </div>
      <div class="hi-note chi">2 à¤®à¥à¤«à¥à¤¤ à¤˜à¤‚à¤Ÿà¥‡à¥¤ à¤‰à¤¸à¤•à¥‡ à¤¬à¤¾à¤¦ à¤ªà¥à¤°à¤¤à¤¿ à¤˜à¤‚à¤Ÿà¥‡ à¤¡à¤¿à¤Ÿà¥‡à¤‚à¤¶à¤¨ à¤šà¤¾à¤°à¥à¤œà¥¤ à¤²à¤¿à¤–à¤¿à¤¤ à¤®à¥‡à¤‚ à¤¦à¤°à¥à¤œ à¤•à¤°à¥‡à¤‚ à¤”à¤° 24 à¤˜à¤‚à¤Ÿà¥‡ à¤•à¥‡ à¤…à¤‚à¤¦à¤° à¤•à¥à¤²à¥‡à¤® à¤•à¤°à¥‡à¤‚à¥¤</div>
    </div>
  </div>

  <!-- â•â•â• TOOL 6: Empty Running â•â•â• -->
  <div class="tool-card">
    <div class="tool-head">
      <div class="tool-icon" style="background:rgba(251,191,36,0.15)">ğŸ“Š</div>
      <div>
        <div style="font-family:var(--font-head);font-size:15px;font-weight:800">Empty Running Calculator</div>
        <div style="font-size:11px;color:var(--grey)">Weekly empty run % Â· KPI target check</div>
      </div>
    </div>
    <div class="tool-body">
      <div class="tf-row">
        <div><label class="tl">Total Miles This Week</label><input type="number" class="tf" id="er_total" placeholder="e.g. 1200" oninput="calcER()"/></div>
        <div><label class="tl">Empty Miles</label><input type="number" class="tf" id="er_empty" placeholder="e.g. 240" oninput="calcER()"/></div>
      </div>
      <label class="tl">Weekly Revenue (Â£ or $)</label>
      <input type="number" class="tf" id="er_rev" placeholder="e.g. 4800" oninput="calcER()"/>

      <div id="er_result" style="display:none">
        <div class="result-box" id="er_box">
          <div class="result-main" id="er_pct">â€”</div>
          <div class="result-sub" id="er_detail">â€”</div>
        </div>
        <div style="margin-top:8px">
          <div style="height:10px;background:rgba(255,255,255,0.07);border-radius:99px;overflow:hidden">
            <div id="er_bar" style="height:100%;border-radius:99px;transition:width .6s ease;background:var(--green)"></div>
          </div>
          <div style="display:flex;justify-content:space-between;font-size:10px;color:var(--grey);margin-top:3px;font-family:var(--font-mono)">
            <span>0%</span><span style="color:var(--green)">TARGET: &lt;15%</span><span style="color:var(--orange)">INDUSTRY: 25â€“30%</span><span>50%</span>
          </div>
        </div>
      </div>
      <div class="hi-note chi">à¤–à¤¾à¤²à¥€ à¤®à¥€à¤² <15% = à¤¬à¥‡à¤¹à¤¤à¤°à¥€à¤¨à¥¤ UK à¤‰à¤¦à¥à¤¯à¥‹à¤— à¤”à¤¸à¤¤: 25â€“30%à¥¤ à¤…à¤§à¤¿à¤• à¤¬à¥ˆà¤•à¤¹à¥‰à¤² à¤²à¥‹à¤¡ à¤–à¥‹à¤œà¥‡à¤‚à¥¤</div>
    </div>
  </div>

  <!-- â•â•â• TOOL 7: Load Profitability â•â•â• -->
  <div class="tool-card" style="grid-column:span 1">
    <div class="tool-head">
      <div class="tool-icon" style="background:rgba(34,197,94,0.15)">ğŸš›</div>
      <div>
        <div style="font-family:var(--font-head);font-size:15px;font-weight:800">Load Profitability Analyser</div>
        <div style="font-size:11px;color:var(--grey)">Should you take this load? Full P&amp;L</div>
      </div>
    </div>
    <div class="tool-body">
      <div class="seg" id="seg_prof">
        <button class="seg-btn act" onclick="segSwitch('seg_prof',this,'pf_uk');calcProfit()">ğŸ‡¬ğŸ‡§ UK (Â£)</button>
        <button class="seg-btn" onclick="segSwitch('seg_prof',this,'pf_us');calcProfit()">ğŸ‡ºğŸ‡¸ USA ($)</button>
      </div>

      <div id="pf_uk" data-seg="seg_prof">
        <div class="tf-row">
          <div><label class="tl">Load Rate (Â£)</label><input type="number" class="tf" id="pf_uk_rate" placeholder="e.g. 1100" oninput="calcProfit()"/></div>
          <div><label class="tl">Miles</label><input type="number" class="tf" id="pf_uk_miles" placeholder="e.g. 280" oninput="calcProfit()"/></div>
        </div>
        <div class="tf-row">
          <div><label class="tl">Fuel Cost (Â£/mile)</label><input type="number" class="tf" id="pf_uk_fuel" placeholder="0.65" value="0.65" step="0.05" oninput="calcProfit()"/></div>
          <div><label class="tl">Driver Cost (Â£/mile)</label><input type="number" class="tf" id="pf_uk_driver" placeholder="0.55" value="0.55" step="0.05" oninput="calcProfit()"/></div>
        </div>
        <div class="tf-row">
          <div><label class="tl">Other Costs (Â£/mile)</label><input type="number" class="tf" id="pf_uk_other" placeholder="0.30" value="0.30" step="0.05" oninput="calcProfit()"/></div>
          <div><label class="tl">Dispatcher % (commission)</label><input type="number" class="tf" id="pf_uk_comm" placeholder="8" value="8" step="0.5" oninput="calcProfit()"/></div>
        </div>
      </div>

      <div id="pf_us" data-seg="seg_prof" style="display:none">
        <div class="tf-row">
          <div><label class="tl">Load Rate ($)</label><input type="number" class="tf" id="pf_us_rate" placeholder="e.g. 2600" oninput="calcProfit()"/></div>
          <div><label class="tl">Miles</label><input type="number" class="tf" id="pf_us_miles" placeholder="e.g. 850" oninput="calcProfit()"/></div>
        </div>
        <div class="tf-row">
          <div><label class="tl">Fuel Cost ($/mile)</label><input type="number" class="tf" id="pf_us_fuel" placeholder="0.75" value="0.75" step="0.05" oninput="calcProfit()"/></div>
          <div><label class="tl">Driver Cost ($/mile)</label><input type="number" class="tf" id="pf_us_driver" placeholder="0.65" value="0.65" step="0.05" oninput="calcProfit()"/></div>
        </div>
        <div class="tf-row">
          <div><label class="tl">Other Costs ($/mile)</label><input type="number" class="tf" id="pf_us_other" placeholder="0.25" value="0.25" step="0.05" oninput="calcProfit()"/></div>
          <div><label class="tl">Dispatcher % (commission)</label><input type="number" class="tf" id="pf_us_comm" placeholder="8" value="8" step="0.5" oninput="calcProfit()"/></div>
        </div>
      </div>

      <div id="pf_result" style="display:none">
        <div class="mini-grid" id="pf_grid"></div>
        <div style="margin-top:8px;padding:10px 12px;border-radius:10px;font-size:14px;font-weight:700;text-align:center" id="pf_verdict"></div>
      </div>
      <div class="hi-note chi">à¤•à¥à¤² à¤²à¤¾à¤—à¤¤ = (à¤ˆà¤‚à¤§à¤¨ + à¤¡à¥à¤°à¤¾à¤‡à¤µà¤° + à¤…à¤¨à¥à¤¯) Ã— à¤®à¥€à¤² + à¤¡à¤¿à¤¸à¥à¤ªà¥ˆà¤šà¤° à¤•à¤®à¥€à¤¶à¤¨à¥¤ à¤²à¤¾à¤­ = à¤²à¥‹à¤¡ à¤°à¥‡à¤Ÿ âˆ’ à¤•à¥à¤² à¤²à¤¾à¤—à¤¤à¥¤</div>
    </div>
  </div>

</div><!-- tools-grid -->

<footer style="border-top:1px solid rgba(6,182,212,0.1);padding:20px 24px;text-align:center;margin-top:8px">
  <div style="max-width:1200px;margin:0 auto">
    <div style="display:flex;align-items:center;justify-content:center;gap:12px;margin-bottom:6px">
      <img src="assets/logo.png" style="height:28px;background:white;padding:2px;border-radius:5px" onerror="this.style.display='none'"/>
      <span style="font-weight:900;font-size:14px;letter-spacing:1px;font-family:var(--font-head)">EAGLE ACADEMY</span>
    </div>
    <div style="font-size:12px;color:var(--grey)">Dispatcher Toolbox Â· Phase 5 Â· All calculations are estimates for training purposes</div>
  </div>
</footer>

<script src="assets/app.js"></script>
<script>
let lang='en';
function setLang(l,btn){lang=l;document.querySelectorAll('.lang-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');document.querySelectorAll('.hi-note').forEach(el=>el.style.display=l==='hi'?'block':'none');}
function segSwitch(segId,btn,showId){
  document.querySelectorAll('#'+segId+' .seg-btn').forEach(b=>b.classList.remove('act'));
  btn.classList.add('act');
  // Hide all panels registered to this seg group via data-seg attribute
  document.querySelectorAll('[data-seg="'+segId+'"]').forEach(el=>el.style.display='none');
  const show=document.getElementById(showId);
  if(show)show.style.display='block';
}

/* â”€â”€â”€ TOOL 1: UK/US Rate Calculator â”€â”€â”€ */
function setUKVehicleDefaults(){
  const v=document.getElementById('r_uk_vtype').value;
  const defaults={artic:'1.50',rigid:'1.25',van:'0.85'};
  document.getElementById('r_uk_cpm').value=defaults[v];
}
function setUSVehicleDefaults(){
  const v=document.getElementById('r_us_vtype').value;
  const defaults={semi:'1.65',straight:'1.30',sprinter:'0.95'};
  document.getElementById('r_us_cpm').value=defaults[v];
}
function calcUKRate(){
  const rate=parseFloat(document.getElementById('r_uk_rate').value)||0;
  const miles=parseFloat(document.getElementById('r_uk_miles').value)||0;
  const cpm=parseFloat(document.getElementById('r_uk_cpm').value)||1.50;
  if(!rate||!miles)return;
  const rpm=(rate/miles);const profit=rate-(cpm*miles);const profitPct=Math.round(profit/rate*100);
  const el=document.getElementById('r_uk_result');el.style.display='block';
  document.getElementById('r_uk_rpm').textContent='Â£'+rpm.toFixed(2)+'/mile';
  document.getElementById('r_uk_sub').textContent=`Revenue: Â£${rate.toFixed(0)} | Cost: Â£${(cpm*miles).toFixed(0)} | Gross Profit: Â£${profit.toFixed(0)} (${profitPct}%)`;
  el.className='result-box'+(rpm>=2.5?' result-good':rpm>=1.8?' result-warn':' result-bad');
}
function calcUSRate(){
  const rate=parseFloat(document.getElementById('r_us_rate').value)||0;
  const miles=parseFloat(document.getElementById('r_us_miles').value)||0;
  const cpm=parseFloat(document.getElementById('r_us_cpm').value)||1.65;
  if(!rate||!miles)return;
  const rpm=rate/miles;const profit=rate-(cpm*miles);const profitPct=Math.round(profit/rate*100);
  const el=document.getElementById('r_us_result');el.style.display='block';
  document.getElementById('r_us_rpm').textContent='$'+rpm.toFixed(2)+'/mile';
  document.getElementById('r_us_sub').textContent=`Revenue: $${rate.toFixed(0)} | Cost: $${(cpm*miles).toFixed(0)} | Gross Profit: $${profit.toFixed(0)} (${profitPct}%)`;
  el.className='result-box'+(rpm>=2.5?' result-good':rpm>=1.8?' result-warn':' result-bad');
}

/* â”€â”€â”€ TOOL 2: UK Hours Checker â”€â”€â”€ */
function calcHours(){
  const startStr=document.getElementById('h_start').value;
  const miles=parseFloat(document.getElementById('h_miles').value)||0;
  const speed=parseFloat(document.getElementById('h_speed').value)||50;
  const loadMins=parseFloat(document.getElementById('h_load').value)||60;
  const usedHrs=parseFloat(document.getElementById('h_used').value)||0;
  const maxDrive=parseFloat(document.getElementById('h_ext').value)||9;
  if(!miles||!startStr)return;
  const driveHrs=miles/speed;
  const breakHrs=driveHrs>4.5?0.75:0;
  const totalHrs=driveHrs+breakHrs+(loadMins/60);
  const availableDrive=maxDrive-usedHrs;
  const canComplete=driveHrs<=availableDrive;
  const endHrs=totalHrs;
  const el=document.getElementById('h_result');el.style.display='block';
  const [sh,sm]=startStr.split(':').map(Number);
  const endMins=sh*60+sm+Math.round(endHrs*60);
  const endH=Math.floor(endMins/60)%24;const endM=endMins%60;
  const endStr=String(endH).padStart(2,'0')+':'+String(endM).padStart(2,'0');
  if(canComplete){
    el.className='result-box result-good';
    document.getElementById('h_verdict').textContent='âœ… LEGAL â€” Can Complete';
    document.getElementById('h_detail').textContent=`Drive: ${driveHrs.toFixed(1)}hrs | Break: ${breakHrs>0?'45min':'None needed'} | Load/Unload: ${loadMins}min | Est finish: ${endStr} | Available drive: ${availableDrive.toFixed(1)}hrs`;
  } else {
    el.className='result-box result-bad';
    document.getElementById('h_verdict').textContent='ğŸš« ILLEGAL â€” Hours Exceeded';
    document.getElementById('h_detail').textContent=`Needs ${driveHrs.toFixed(1)}hrs driving but only ${availableDrive.toFixed(1)}hrs available after ${usedHrs}hrs already driven. Plan 2-day journey or find different driver.`;
  }
  // timeline viz
  const vis=document.getElementById('h_vis');vis.innerHTML='';
  for(let i=0;i<24;i++){const c=document.createElement('div');c.className='hv-cell';
    const minuteOfDay=sh*60+sm+(i*60);
    const elapsed=(minuteOfDay-(sh*60+sm))/60;
    if(elapsed<0||elapsed>endHrs+1){c.classList.add('');}
    else if(elapsed<=driveHrs*0.5){c.classList.add('drive');}
    else if(breakHrs>0&&elapsed>driveHrs*0.5&&elapsed<=driveHrs*0.5+0.75){c.classList.add('break');}
    else if(elapsed<=driveHrs+breakHrs){c.classList.add('drive');}
    else if(elapsed<=driveHrs+breakHrs+loadMins/60){c.classList.add('load');}
    else if(!canComplete){c.classList.add('rest');}
    c.title=`${i}:00`;vis.appendChild(c);
  }
}

/* â”€â”€â”€ TOOL 3: Time Zone â”€â”€â”€ */
function fmt(d){return String(d.getHours()).padStart(2,'0')+':'+String(d.getMinutes()).padStart(2,'0');}
function fmtDay(d){return d.toLocaleDateString('en-GB',{weekday:'short',day:'numeric',month:'short'});}
function isUKBST(d){const m=d.getMonth();return m>=2&&m<=9;}
function isUSAEDT(d){const m=d.getMonth();return m>=2&&m<=9;}

function convertTZ(useNow){
  const now=new Date();
  let istH,istM;
  if(useNow){istH=now.getHours();istM=now.getMinutes();const ti=document.getElementById('tz_input');if(ti)ti.value=String(istH).padStart(2,'0')+':'+String(istM).padStart(2,'0');}
  else{const v=document.getElementById('tz_input').value;if(!v)return;const[h,m]=v.split(':').map(Number);istH=h;istM=m;}
  const base=new Date(now.getFullYear(),now.getMonth(),now.getDate(),istH,istM,0);
  const bst=isUKBST(base);const edt=isUSAEDT(base);
  const ukOff=bst?-(5*60+30-60):-(5*60+30);
  const estOff=edt?-(5*60+30+4*60):-(5*60+30+5*60);
  const cstOff=edt?-(5*60+30+5*60):-(5*60+30+6*60);
  const ukDate=new Date(base.getTime()+ukOff*60000);
  const estDate=new Date(base.getTime()+estOff*60000);
  const cstDate=new Date(base.getTime()+cstOff*60000);
  document.getElementById('tz_ist').textContent=fmt(base);
  document.getElementById('tz_ist_d').textContent=fmtDay(base);
  document.getElementById('tz_uk').textContent=fmt(ukDate);
  document.getElementById('tz_uk_status').textContent=fmtDay(ukDate)+(bst?' (BST)':' (GMT)');
  document.getElementById('tz_uk_offset').textContent=bst?'UTC +1 (BST)':'UTC +0 (GMT)';
  document.getElementById('tz_est').textContent=fmt(estDate);
  document.getElementById('tz_est_status').textContent=fmtDay(estDate)+(edt?' (EDT)':' (EST)');
  document.getElementById('tz_cst').textContent=fmt(cstDate);
  document.getElementById('tz_cst_status').textContent=fmtDay(cstDate)+(edt?' (CDT)':' (CST)');
  const ukH=ukDate.getHours();
  let advice='';
  if(ukH>=8&&ukH<18)advice='ğŸŸ¢ UK business hours (8AMâ€“6PM) â€” good time to call UK carriers and brokers.';
  else if(ukH>=6&&ukH<8)advice='ğŸŸ¡ UK early morning â€” some drivers starting. Avoid calling transport offices yet.';
  else if(ukH>=18&&ukH<22)advice='ğŸŸ¡ UK evening â€” office hours ended. WhatsApp/SMS OK for non-urgent comms.';
  else advice='ğŸ”´ UK night hours â€” do not call. Schedule messages for morning.';
  document.getElementById('tz_advice').textContent=advice;
}
function setNow(){convertTZ(true);}

/* â”€â”€â”€ TOOL 4: Tachograph & WTD â”€â”€â”€ */
function calcTacho(){
  const drive=parseFloat(document.getElementById('tc_drive').value)||0;
  const duty=parseFloat(document.getElementById('tc_duty').value)||0;
  const rest=parseFloat(document.getElementById('tc_rest').value)||0;
  const ext=parseInt(document.getElementById('tc_ext').value)||0;
  if(!drive&&!duty&&!rest)return;
  const maxDrive=ext<2?10:9; // 10hr extension allowed twice a week
  const issues=[];
  if(drive>9&&ext>=2) issues.push('ğŸš¨ SERIOUS: Driving over 9 hrs â€” extensions already used this week');
  else if(drive>10) issues.push('ğŸš¨ SERIOUS: Driving over 10 hrs (max extension limit)');
  else if(drive>9) issues.push(`âš ï¸ WARNING: 10hr extension used (${ext+1}/2 this week)`);
  if(duty>13) issues.push('ğŸš¨ SERIOUS: On-duty time over 13 hours');
  if(rest<9) issues.push('ğŸš¨ SERIOUS: Rest under 9 hours (reduced rest)');
  else if(rest<11) issues.push('âš ï¸ WARNING: Reduced daily rest (min 9hrs, 3 times/week max)');
  const verdict = document.getElementById('tc_verdict');
  const detail = document.getElementById('tc_detail');
  document.getElementById('tc_result').style.display='block';
  if(issues.length===0){
    verdict.style.color='var(--green)';
    verdict.textContent='âœ… COMPLIANT';
    detail.textContent=`Drive: ${drive}h / 9h limit | Duty: ${duty}h | Rest: ${rest}h âœ“`;
  } else {
    verdict.style.color='var(--red)';
    verdict.textContent='âŒ INFRINGEMENT DETECTED';
    detail.innerHTML=issues.join('<br/>');
  }
}

function calcWTD(){
  const hrs=parseFloat(document.getElementById('tc_wtd_hrs').value)||0;
  if(!hrs)return;
  const optedOut=document.getElementById('optout_yes').classList.contains('act');
  const limit=optedOut?60:48;
  const verdict=document.getElementById('tc_verdict');
  const detail=document.getElementById('tc_detail');
  document.getElementById('tc_result').style.display='block';
  if(hrs<=48){
    verdict.style.color='var(--green)';
    verdict.textContent='âœ… WTD COMPLIANT';
    detail.textContent=`${hrs}h worked this week â€” under the 48h average limit`;
  } else if(hrs<=60&&optedOut){
    verdict.style.color='var(--gold)';
    verdict.textContent='âš ï¸ OVER 48H â€” OPT-OUT APPLIES';
    detail.textContent=`${hrs}h worked. Opt-out signed, so up to 60h permitted. Ensure opt-out is documented.`;
  } else {
    verdict.style.color='var(--red)';
    verdict.textContent='ğŸš¨ WTD BREACH';
    detail.textContent=`${hrs}h exceeds the ${limit}h WTD limit. ${optedOut?'Even with opt-out, 60h is the max.':'Driver must have signed opt-out to work over 48h.'}`;
  }
}

/* â”€â”€â”€ TOOL 5: Detention â”€â”€â”€ */
function calcDet(){
  const isUK=document.getElementById('det_uk').style.display!=='none';
  const sym=isUK?'Â£':'$';
  const arr=document.getElementById(isUK?'det_uk_arr':'det_us_arr').value;
  const dep=document.getElementById(isUK?'det_uk_dep':'det_us_dep').value;
  const rate=parseFloat(document.getElementById(isUK?'det_uk_rate':'det_us_rate').value)||(isUK?25:50);
  if(!arr||!dep)return;
  const[ah,am]=arr.split(':').map(Number);const[dh,dm]=dep.split(':').map(Number);
  let mins=(dh*60+dm)-(ah*60+am);if(mins<0)mins+=1440;
  const hrs=mins/60;const freeHrs=2;const billableHrs=Math.max(0,hrs-freeHrs);
  const amount=billableHrs*rate;
  const el=document.getElementById('det_result');el.style.display='block';
  document.getElementById('det_amount').textContent=sym+amount.toFixed(2);
  document.getElementById('det_detail').textContent=`Total wait: ${hrs.toFixed(2)}hrs | Free: ${freeHrs}hrs | Billable: ${billableHrs.toFixed(2)}hrs @ ${sym}${rate}/hr${amount===0?' â€” No detention payable':' â€” Claim within 24hrs of delivery'}`;
  el.className='result-box'+(amount>0?' result-warn':' result-good');
}

/* â”€â”€â”€ TOOL 6: Empty Running â”€â”€â”€ */
function calcER(){
  const total=parseFloat(document.getElementById('er_total').value)||0;
  const empty=parseFloat(document.getElementById('er_empty').value)||0;
  const rev=parseFloat(document.getElementById('er_rev').value)||0;
  if(!total||!empty)return;
  const pct=Math.round(empty/total*100);
  const rpmLoaded=rev&&(total-empty)>0?rev/(total-empty):0;
  document.getElementById('er_result').style.display='block';
  const box=document.getElementById('er_box');
  document.getElementById('er_pct').textContent=pct+'% Empty Running';
  document.getElementById('er_detail').textContent=`${empty} empty miles of ${total} total | Loaded RPM: ${rpmLoaded>0?'Â£$'.slice(0,1)+rpmLoaded.toFixed(2)+'/mile':'N/A'} | Industry avg: 25â€“30%`;
  box.className='result-box'+(pct<15?' result-good':pct<25?' result-warn':' result-bad');
  const bar=document.getElementById('er_bar');
  bar.style.width=Math.min(pct*2,100)+'%';
  bar.style.background=pct<15?'var(--green)':pct<25?'var(--orange)':'var(--red)';
}

/* â”€â”€â”€ TOOL 7: Load Profitability â”€â”€â”€ */
function calcProfit(){
  const isUK=document.getElementById('pf_uk').style.display!=='none';
  const sym=isUK?'Â£':'$';
  const rate=parseFloat(document.getElementById(isUK?'pf_uk_rate':'pf_us_rate').value)||0;
  const miles=parseFloat(document.getElementById(isUK?'pf_uk_miles':'pf_us_miles').value)||0;
  const fuel=parseFloat(document.getElementById(isUK?'pf_uk_fuel':'pf_us_fuel').value)||0;
  const driver=parseFloat(document.getElementById(isUK?'pf_uk_driver':'pf_us_driver').value)||0;
  const other=parseFloat(document.getElementById(isUK?'pf_uk_other':'pf_us_other').value)||0;
  const commPct=parseFloat(document.getElementById(isUK?'pf_uk_comm':'pf_us_comm').value)||8;
  if(!rate||!miles)return;
  const commAmt=rate*(commPct/100);
  const fuelCost=fuel*miles;const driverCost=driver*miles;const otherCost=other*miles;
  const totalCost=fuelCost+driverCost+otherCost+commAmt;
  const profit=rate-totalCost;const margin=Math.round(profit/rate*100);
  const rpm=rate/miles;
  document.getElementById('pf_result').style.display='block';
  document.getElementById('pf_grid').innerHTML=`
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px">
      <div style="background:rgba(6,182,212,0.08);border:1px solid rgba(6,182,212,0.2);border-radius:10px;padding:12px;text-align:center"><div style="font-size:18px;font-weight:900;color:var(--cyan);font-family:var(--font-head)">${sym}${totalCost.toFixed(0)}</div><div style="font-size:10px;color:var(--grey);margin-top:2px">Total Cost</div></div>
      <div style="background:rgba(${profit>0?'34,197,94':'239,68,68'},0.1);border:1px solid rgba(${profit>0?'34,197,94':'239,68,68'},0.3);border-radius:10px;padding:12px;text-align:center"><div style="font-size:18px;font-weight:900;color:${profit>0?'var(--green)':'var(--red)'};font-family:var(--font-head)">${sym}${profit.toFixed(0)}</div><div style="font-size:10px;color:var(--grey);margin-top:2px">Gross Profit</div></div>
      <div style="background:rgba(139,92,246,0.08);border:1px solid rgba(139,92,246,0.2);border-radius:10px;padding:12px;text-align:center"><div style="font-size:18px;font-weight:900;color:#a78bfa;font-family:var(--font-head)">${rpm.toFixed(2)}</div><div style="font-size:10px;color:var(--grey);margin-top:2px">${sym}/mile RPM</div></div>
    </div>
    <div style="background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);border-radius:10px;padding:10px 14px;font-size:11px;color:var(--grey);line-height:1.8;margin-top:2px">
      Fuel: ${sym}${fuelCost.toFixed(0)} | Driver: ${sym}${driverCost.toFixed(0)} | Other: ${sym}${otherCost.toFixed(0)} | Dispatch (${commPct}%): ${sym}${commAmt.toFixed(0)} | Margin: ${margin}%
    </div>`;
  const v=document.getElementById('pf_verdict');
  if(profit>0&&margin>=20){v.style.background='rgba(34,197,94,0.12)';v.style.color='var(--green)';v.style.border='1px solid rgba(34,197,94,0.3)';v.textContent='âœ… TAKE THIS LOAD â€” Good profitability ('+margin+'% margin)';}
  else if(profit>0){v.style.background='rgba(249,115,22,0.1)';v.style.color='var(--orange)';v.style.border='1px solid rgba(249,115,22,0.3)';v.textContent='âš ï¸ MARGINAL â€” Profitable but low margin ('+margin+'%). Negotiate rate up.';}
  else{v.style.background='rgba(239,68,68,0.1)';v.style.color='var(--red)';v.style.border='1px solid rgba(239,68,68,0.3)';v.textContent='ğŸš« REJECT â€” This load loses money. Either renegotiate or pass.';}
}

// Auto-run time zone on load
window.addEventListener('DOMContentLoaded',()=>{
  setNow();
  setInterval(()=>{convertTZ(true);},60000); // update every minute
  calcHours();
});
</script>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FLOATING FABs â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- Madam JI + Tools â€” hardcoded, position:fixed  -->
<style>
#mj-fab {
  position: fixed !important; bottom: 88px !important; right: 20px !important;
  z-index: 99999 !important; width: 64px; height: 64px; border-radius: 50%;
  background: linear-gradient(135deg, #7c3aed, #4f46e5);
  border: 2px solid rgba(168,85,247,0.5);
  outline: none; font-family: inherit;
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  overflow: hidden;
  animation: mjBounce 2.5s ease-in-out infinite, mjColorCycle 4s ease-in-out infinite;
  transition: transform .18s ease;
}
#mj-fab:hover {
  transform: scale(1.12) !important;
  animation: none !important;
  background: linear-gradient(135deg, #9333ea, #6366f1) !important;
  box-shadow: 0 0 0 12px rgba(124,58,237,0.12), 0 8px 36px rgba(124,58,237,0.8) !important;
}
/* Cycle wrapper â€” clips content to circle */
.mj-cycle-wrap {
  position: relative; width: 100%; height: 100%;
  display: flex; align-items: center; justify-content: center;
  pointer-events: none;
}
/* Each state */
.mj-state {
  position: absolute; inset: 0;
  display: flex; align-items: center; justify-content: center;
  text-align: center; line-height: 1.2;
  opacity: 0; pointer-events: none;
}
/* ğŸ˜• confused face */
.mj-s1 {
  font-size: 30px;
  animation: mjCycle1 5s ease-in-out infinite;
}
/* "Ask" */
.mj-s2 {
  font-size: 13px; font-weight: 900; color: rgba(255,255,255,0.9);
  letter-spacing: 1px; font-family: 'DM Sans', sans-serif;
  animation: mjCycle2 5s ease-in-out infinite;
}
/* "Madam JI" */
.mj-s3 {
  font-size: 10px; font-weight: 800; color: white;
  letter-spacing: .3px; font-family: 'DM Sans', sans-serif;
  animation: mjCycle3 5s ease-in-out infinite;
}
/* 
  5s total cycle:
  0.0â€“2.0s  â†’ ğŸ˜• visible   (2s)
  2.0â€“2.5s  â†’ fade to Ask  (0.5s)
  2.5â€“3.5s  â†’ Ask visible  (1s)
  3.5â€“4.0s  â†’ fade to MJ   (0.5s)
  4.0â€“5.0s  â†’ Madam JI     (1s) then fades back to ğŸ˜•
*/
@keyframes mjCycle1 {
  0%   { opacity:0; transform:scale(0.7); }
  5%   { opacity:1; transform:scale(1.1); }
  15%  { opacity:1; transform:scale(1); }
  40%  { opacity:1; transform:scale(1); }
  50%  { opacity:0; transform:scale(0.8); }
  100% { opacity:0; transform:scale(0.7); }
}
@keyframes mjCycle2 {
  0%   { opacity:0; transform:scale(0.5); }
  42%  { opacity:0; transform:scale(0.5); }
  50%  { opacity:1; transform:scale(1.15); }
  56%  { opacity:1; transform:scale(1); }
  66%  { opacity:1; transform:scale(1); }
  74%  { opacity:0; transform:scale(0.7); }
  100% { opacity:0; }
}
@keyframes mjCycle3 {
  0%   { opacity:0; transform:scale(0.5); }
  72%  { opacity:0; transform:scale(0.5); }
  80%  { opacity:1; transform:scale(1.1); }
  86%  { opacity:1; transform:scale(1); }
  94%  { opacity:1; transform:scale(1); }
  100% { opacity:0; transform:scale(0.8); }
}
/* Pause cycle on hover â€” show owl instead */
#mj-fab:hover .mj-state { animation-play-state: paused !important; opacity:0 !important; }
#mj-fab:hover .mj-cycle-wrap::after {
  content: 'ğŸ¦‰';
  font-size: 28px;
  position: absolute;
  animation: popIn .2s cubic-bezier(.22,1,.36,1);
}
@keyframes popIn {
  from { transform: scale(0.5); opacity:0; }
  to   { transform: scale(1);   opacity:1; }
}
@keyframes mjBounce {
  0%,100% { transform: translateY(0); }
  50%      { transform: translateY(-7px); }
}
@keyframes mjColorCycle {
  0%,100% { box-shadow: 0 4px 24px rgba(124,58,237,0.5); border-color: rgba(168,85,247,0.6); }
  33%     { box-shadow: 0 4px 28px rgba(99,102,241,0.7), 0 0 0 6px rgba(99,102,241,0.1); border-color: rgba(99,102,241,0.8); }
  66%     { box-shadow: 0 4px 28px rgba(219,39,119,0.7), 0 0 0 6px rgba(219,39,119,0.1); border-color: rgba(219,39,119,0.8); }
}
#mj-popup {
  position: fixed !important; bottom: 156px !important; right: 20px !important;
  z-index: 99998 !important; width: 360px; max-height: 540px;
  background: rgba(15,12,61,0.98);
  border: 1px solid rgba(124,58,237,0.4); border-radius: 20px;
  box-shadow: 0 16px 56px rgba(0,0,0,0.6);
  display: flex; flex-direction: column;
  transform: translateY(20px) scale(0.95); opacity: 0; pointer-events: none;
  transition: all .25s cubic-bezier(.22,1,.36,1);
  backdrop-filter: blur(20px);
}
#mj-popup.open { transform: translateY(0) scale(1) !important; opacity: 1 !important; pointer-events: all !important; }
.mj-pop-head { padding: 14px 16px; border-bottom: 1px solid rgba(124,58,237,0.2); display: flex; align-items: center; gap: 10px; flex-shrink: 0; }
.mj-pop-orb { width: 36px; height: 36px; border-radius: 50%; background: linear-gradient(135deg,#7c3aed,#f97316); display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
.mj-pop-name { font-weight: 700; font-size: 13px; color: #f0f2f8; }
.mj-pop-sub { font-size: 10px; color: rgba(168,85,247,0.9); font-family: monospace; letter-spacing: .5px; }
.mj-pop-close { margin-left: auto; background: none; border: none; color: rgba(255,255,255,0.4); font-size: 18px; cursor: pointer; padding: 4px; line-height: 1; }
.mj-pop-close:hover { color: white; }
.mj-pop-msgs { flex: 1; overflow-y: auto; padding: 12px; display: flex; flex-direction: column; gap: 8px; max-height: 300px; scrollbar-width: thin; }
.mj-msg { max-width: 85%; padding: 9px 12px; border-radius: 12px; font-size: 13px; line-height: 1.5; font-family: 'DM Sans',sans-serif; }
.mj-msg.bot  { background: rgba(124,58,237,0.15); border: 1px solid rgba(124,58,237,0.2); color: #e2d9f3; border-bottom-left-radius: 3px; align-self: flex-start; }
.mj-msg.user { background: rgba(249,115,22,0.15); border: 1px solid rgba(249,115,22,0.2); color: #fde8d8; border-bottom-right-radius: 3px; align-self: flex-end; }
.mj-msg.typing { display: flex; gap: 4px; align-items: center; padding: 12px; }
.mj-dot { width: 7px; height: 7px; border-radius: 50%; background: #a855f7; animation: mjDotB .8s ease-in-out infinite; }
.mj-dot:nth-child(2){animation-delay:.15s} .mj-dot:nth-child(3){animation-delay:.3s}
@keyframes mjDotB { 0%,80%,100%{transform:scale(.6);opacity:.4} 40%{transform:scale(1);opacity:1} }
.mj-pop-key { padding: 8px 12px; border-top: 1px solid rgba(124,58,237,0.15); flex-shrink: 0; }
.mj-pop-key input { width: 100%; padding: 7px 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(124,58,237,0.3); border-radius: 8px; color: white; font-family: monospace; font-size: 11px; outline: none; box-sizing: border-box; }
.mj-pop-key input::placeholder { color: rgba(255,255,255,0.25); }
.mj-pop-input { padding: 10px 12px; border-top: 1px solid rgba(124,58,237,0.15); display: flex; gap: 8px; flex-shrink: 0; }
.mj-pop-input input { flex: 1; padding: 9px 12px; background: rgba(255,255,255,0.06); border: 1px solid rgba(124,58,237,0.25); border-radius: 10px; color: white; font-size: 13px; font-family: 'DM Sans',sans-serif; outline: none; }
.mj-pop-input input:focus { border-color: rgba(124,58,237,0.6); }
.mj-pop-input input::placeholder { color: rgba(255,255,255,0.2); }
.mj-send { padding: 9px 14px; background: linear-gradient(135deg,#7c3aed,#4f46e5); border: none; border-radius: 10px; color: white; cursor: pointer; font-size: 15px; flex-shrink: 0; }
.mj-chips { display: flex; flex-wrap: wrap; gap: 5px; padding: 2px 0 6px; }
.mj-chip { padding: 5px 11px; border-radius: 999px; border: 1px solid rgba(124,58,237,0.35); background: rgba(124,58,237,0.1); color: #c4b5fd; font-size: 11px; cursor: pointer; font-family: 'DM Sans',sans-serif; transition: all .15s; }
.mj-chip:hover { background: rgba(124,58,237,0.3); transform: scale(1.04); }
.mj-chip-hi { border-color: rgba(249,115,22,0.4) !important; background: rgba(249,115,22,0.08) !important; color: #fed7aa !important; font-family: 'Noto Sans Devanagari', 'DM Sans', sans-serif !important; }
.mj-chip-hi:hover { background: rgba(249,115,22,0.2) !important; }
.mj-chip-label { font-size: 10px; font-weight: 700; color: rgba(255,255,255,0.35); letter-spacing: .8px; text-transform: uppercase; padding: 4px 0 2px; font-family: 'DM Sans', sans-serif; }
#tools-fab {
  position: fixed !important; bottom: 20px !important; left: 20px !important;
  z-index: 99999 !important; width: 64px; height: 64px; border-radius: 50%;
  background: linear-gradient(135deg, #f97316, #ea6c0a);
  border: 2px solid rgba(249,115,22,0.5);
  outline: none; font-family: inherit; overflow: hidden;
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  animation: toolsBounce 2.5s ease-in-out 1.2s infinite, toolsColorCycle 4s ease-in-out 0.8s infinite;
  transition: transform .18s ease;
}
#tools-fab:hover {
  transform: scale(1.12) !important;
  animation: none !important;
  background: linear-gradient(135deg, #fb923c, #f97316) !important;
  box-shadow: 0 0 0 12px rgba(249,115,22,0.1), 0 8px 36px rgba(249,115,22,0.8) !important;
}
.tools-inner {
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  gap: 1px; pointer-events: none;
}
/* Gear â€” spins slowly, speeds up on hover */
.tools-gear-icon {
  font-size: 20px; line-height: 1;
  display: block;
  animation: gearSpin 5s linear infinite;
  filter: drop-shadow(0 1px 3px rgba(0,0,0,0.3));
  transition: font-size .2s;
}
#tools-fab:hover .tools-gear-icon {
  animation: gearSpin .5s linear infinite !important;
  font-size: 24px;
}
/* "Toolkit" â€” breathes: tiny â†’ big â†’ tiny */
.tools-word {
  font-size: 6px; font-weight: 900; color: white; letter-spacing: .5px;
  font-family: 'DM Sans', sans-serif; white-space: nowrap;
  text-shadow: 0 1px 3px rgba(0,0,0,0.3);
  animation: toolkitBreathe 2.2s ease-in-out infinite;
  transform-origin: center;
}
#tools-fab:hover .tools-word {
  animation: none !important;
  font-size: 9px !important;
  letter-spacing: 1px;
}
@keyframes gearSpin {
  from { transform: rotate(0deg); }
  to   { transform: rotate(360deg); }
}
@keyframes toolkitBreathe {
  0%,100% { transform: scale(0.5); opacity: 0.5; font-size: 6px; }
  50%     { transform: scale(1);   opacity: 1;   font-size: 9px; }
}
@keyframes toolsBounce {
  0%,100% { transform: translateY(0); }
  50%      { transform: translateY(-7px); }
}
@keyframes toolsColorCycle {
  0%,100% { box-shadow: 0 4px 24px rgba(249,115,22,0.5); border-color: rgba(249,115,22,0.6); }
  33%     { box-shadow: 0 4px 28px rgba(245,158,11,0.7), 0 0 0 6px rgba(245,158,11,0.1); border-color: rgba(245,158,11,0.8); }
  66%     { box-shadow: 0 4px 28px rgba(239,68,68,0.7), 0 0 0 6px rgba(239,68,68,0.1); border-color: rgba(239,68,68,0.8); }
}
#tools-popup {
  position: fixed !important; bottom: 88px !important; left: 20px !important;
  z-index: 99998 !important; width: 320px;
  background: rgba(15,12,61,0.98);
  border: 1px solid rgba(249,115,22,0.3); border-radius: 20px;
  box-shadow: 0 16px 56px rgba(0,0,0,0.6);
  transform: translateY(20px) scale(0.95); opacity: 0; pointer-events: none;
  transition: all .25s cubic-bezier(.22,1,.36,1);
  backdrop-filter: blur(20px); overflow: hidden;
}
#tools-popup.open { transform: translateY(0) scale(1) !important; opacity: 1 !important; pointer-events: all !important; }
.tp-head { padding: 13px 16px; border-bottom: 1px solid rgba(249,115,22,0.15); display: flex; align-items: center; justify-content: space-between; }
.tp-head-title { font-weight: 700; font-size: 13px; color: #f0f2f8; display: flex; align-items: center; gap: 7px; }
.tp-close { background: none; border: none; color: rgba(255,255,255,0.4); font-size: 17px; cursor: pointer; }
.tp-close:hover { color: white; }
.tp-link { display: flex; align-items: center; gap: 12px; padding: 11px 16px; text-decoration: none; color: #f0f2f8; transition: background .15s; border-bottom: 1px solid rgba(255,255,255,0.05); }
.tp-link:last-of-type { border-bottom: none; }
.tp-link:hover { background: rgba(249,115,22,0.08); }
.tp-icon { width: 34px; height: 34px; border-radius: 9px; display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; }
.tp-name { font-size: 13px; font-weight: 600; }
.tp-desc { font-size: 10px; color: rgba(255,255,255,0.35); margin-top: 1px; font-family: monospace; }
.tp-all { display: block; text-align: center; padding: 10px; font-size: 12px; font-weight: 600; color: #f97316; text-decoration: none; background: rgba(249,115,22,0.06); }
.tp-all:hover { background: rgba(249,115,22,0.12); }
.fab-tooltip {
  position: fixed !important; z-index: 99999 !important;
  background: rgba(15,12,61,0.96); border-radius: 999px;
  font-size: 12px; font-weight: 700; font-family: 'DM Sans',sans-serif;
  padding: 6px 14px; white-space: nowrap; pointer-events: none;
  opacity: 0; transition: opacity .2s;
}
#mj-tooltip  { right: 84px; bottom: 100px; border: 1px solid rgba(124,58,237,0.5); color: #e9d5ff; }
#tools-tooltip { left: 84px; bottom: 32px; border: 1px solid rgba(249,115,22,0.5); color: #fed7aa; }
#mj-fab:hover    ~ #mj-tooltip    { opacity: 1; }
#tools-fab:hover ~ #tools-tooltip { opacity: 1; }
@media(max-width:480px){
  #mj-fab    { bottom: 80px !important; right: 16px !important; width:50px; height:50px; font-size:22px; }
  #tools-fab { bottom: 80px !important; left: 16px !important;  width:50px; height:50px; font-size:20px; }
  #mj-popup  { width: calc(100vw - 24px) !important; right: 12px !important; bottom: 144px !important; }
  #tools-popup { width: calc(100vw - 24px) !important; left: 12px !important; bottom: 144px !important; }
}
</style>

<!-- Madam JI Button + Popup -->
<button id="mj-fab" onclick="mjToggle()" title="Confused? Ask Madam JI" type="button">
  <span class="mj-cycle-wrap">
    <span class="mj-state mj-s1">ğŸ˜•</span>
    <span class="mj-state mj-s2">Ask</span>
    <span class="mj-state mj-s3">Madam<br>JI</span>
  </span>
</button>
<div id="mj-tooltip" class="fab-tooltip">Confused? Ask Madam JI ğŸ¦‰</div>
<div id="mj-popup">
  <div class="mj-pop-head">
    <div class="mj-pop-orb">ğŸ¦‰</div>
    <div>
      <div class="mj-pop-name">Madam JI</div>
      <div class="mj-pop-sub">AI TUTOR Â· ENGLISH & à¤¹à¤¿à¤‚à¤¦à¥€ Â· EAGLE ACADEMY</div>
    </div>
    <button class="mj-pop-close" onclick="mjToggle()" type="button">âœ•</button>
  </div>
  <div class="mj-pop-msgs" id="mj-msgs">
    <div class="mj-msg bot">à¤¨à¤®à¤¸à¥à¤¤à¥‡! ğŸ™ Hi! I'm Madam JI â€” your Eagle Academy AI tutor.<br><span style="font-size:11px;opacity:0.7">Ask in English à¤¯à¤¾ à¤¹à¤¿à¤‚à¤¦à¥€ à¤®à¥‡à¤‚ à¤ªà¥‚à¤›à¥‡à¤‚ ğŸ‡®ğŸ‡³</span></div>
    <div class="mj-chip-label">ğŸ‡¬ğŸ‡§ English</div>
    <div class="mj-chips">
      <button class="mj-chip" onclick="mjChip('What is an O-Licence?')" type="button">O-Licence?</button>
      <button class="mj-chip" onclick="mjChip('How do UK drivers hours work?')" type="button">UK Hours?</button>
      <button class="mj-chip" onclick="mjChip('What is the ICAR method?')" type="button">ICAR?</button>
      <button class="mj-chip" onclick="mjChip('What is a tachograph?')" type="button">Tachograph?</button>
    </div>
    <div class="mj-chip-label">ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤‚à¤¦à¥€ à¤®à¥‡à¤‚ à¤ªà¥‚à¤›à¥‡à¤‚</div>
    <div class="mj-chips">
      <button class="mj-chip mj-chip-hi" onclick="mjChip('O-Licence à¤•à¥à¤¯à¤¾ à¤¹à¥‹à¤¤à¤¾ à¤¹à¥ˆ?')" type="button">O-Licence à¤•à¥à¤¯à¤¾ à¤¹à¥ˆ?</button>
      <button class="mj-chip mj-chip-hi" onclick="mjChip('UK à¤®à¥‡à¤‚ à¤¡à¥à¤°à¤¾à¤‡à¤µà¤° à¤•à¥‡ à¤•à¤¾à¤® à¤•à¥‡ à¤˜à¤‚à¤Ÿà¥‡ à¤•à¤¿à¤¤à¤¨à¥‡ à¤¹à¥‹à¤¤à¥‡ à¤¹à¥ˆà¤‚?')" type="button">UK à¤¡à¥à¤°à¤¾à¤‡à¤µà¤° à¤˜à¤‚à¤Ÿà¥‡?</button>
      <button class="mj-chip mj-chip-hi" onclick="mjChip('ICAR method à¤•à¥à¤¯à¤¾ à¤¹à¥ˆ? à¤¹à¤¿à¤‚à¤¦à¥€ à¤®à¥‡à¤‚ à¤¸à¤®à¤à¤¾à¤à¤‚')" type="button">ICAR à¤•à¥à¤¯à¤¾ à¤¹à¥ˆ?</button>
      <button class="mj-chip mj-chip-hi" onclick="mjChip('Tachograph à¤•à¥à¤¯à¤¾ à¤¹à¥‹à¤¤à¤¾ à¤¹à¥ˆ à¤”à¤° à¤¯à¤¹ à¤•à¥à¤¯à¥‹à¤‚ à¤œà¤°à¥‚à¤°à¥€ à¤¹à¥ˆ?')" type="button">Tachograph?</button>
      <button class="mj-chip mj-chip-hi" onclick="mjChip('Freight dispatcher à¤•à¤¾ à¤•à¤¾à¤® à¤•à¥à¤¯à¤¾ à¤¹à¥‹à¤¤à¤¾ à¤¹à¥ˆ?')" type="button">Dispatcher à¤•à¤¾à¤®?</button>
      <button class="mj-chip mj-chip-hi" onclick="mjChip('BOL à¤¯à¤¾à¤¨à¥€ Bill of Lading à¤•à¥à¤¯à¤¾ à¤¹à¥ˆ?')" type="button">BOL à¤•à¥à¤¯à¤¾ à¤¹à¥ˆ?</button>
    </div>
  </div>
  <div class="mj-pop-key" id="mj-key-row" style="display:none">
    <div style="font-size:11px;color:rgba(255,255,255,0.5);margin-bottom:6px;line-height:1.5;">
      ğŸ”‘ Get your free API key at <strong style="color:#c4b5fd">console.anthropic.com</strong> â€” costs ~Â£2/month for a class
    </div>
    <input id="mj-api-input" type="password" placeholder="sk-ant-â€¦ paste your API key here" oninput="mjSaveKey(this.value)" style="font-size:11px;"/>
  </div>
  <div class="mj-pop-input">
    <input id="mj-q" type="text" placeholder="Ask in English à¤¯à¤¾ à¤¹à¤¿à¤‚à¤¦à¥€ à¤®à¥‡à¤‚ à¤ªà¥‚à¤›à¥‡à¤‚â€¦" onkeydown="if(event.key==='Enter')mjSend()"/>
    <button class="mj-send" onclick="mjSend()" type="button">â¤</button>
  </div>
</div>

<!-- Tools Button + Popup -->
<button id="tools-fab" onclick="toolsToggle()" title="Toolkit" type="button">
  <span class="tools-inner">
    <span class="tools-gear-icon">âš™</span>
    <span class="tools-word">Toolkit</span>
  </span>
</button>
<div id="tools-tooltip" class="fab-tooltip">Toolkit ğŸ”§</div>
<div id="tools-popup">
  <!-- Header with tab bar -->
  <div class="tp-head">
    <div class="tp-head-title">ğŸ› ï¸ Toolkit</div>
    <a href="tools.html" class="tp-all-link">All Tools â†’</a>
    <button class="tp-close" onclick="toolsToggle()" type="button">âœ•</button>
  </div>
  <!-- Tab buttons -->
  <div class="tp-tabs">
    <button class="tp-tab active" onclick="tpTab(this,'tp-hours')">â± Hours</button>
    <button class="tp-tab" onclick="tpTab(this,'tp-rate')">ğŸ’· Rate</button>
    <button class="tp-tab" onclick="tpTab(this,'tp-time')">ğŸŒ Time</button>
  </div>
  <!-- PANEL 1: Drivers Hours -->
  <div class="tp-panel" id="tp-hours">
    <div class="tp-field-row">
      <label>Driving (hrs)</label>
      <input type="number" id="tp-drive" placeholder="e.g. 9" min="0" max="15" step="0.5"/>
    </div>
    <div class="tp-field-row">
      <label>On duty (hrs)</label>
      <input type="number" id="tp-duty" placeholder="e.g. 11" min="0" max="16" step="0.5"/>
    </div>
    <div class="tp-field-row">
      <label>Rest (hrs)</label>
      <input type="number" id="tp-rest" placeholder="e.g. 11" min="0" max="24" step="0.5"/>
    </div>
    <button class="tp-calc-btn" onclick="tpCalcHours()">Check Compliance</button>
    <div class="tp-result" id="tp-hours-result"></div>
  </div>
  <!-- PANEL 2: Rate Calculator -->
  <div class="tp-panel" id="tp-rate" style="display:none">
    <div class="tp-field-row">
      <label>Load rate (Â£/$)</label>
      <input type="number" id="tp-loadrate" placeholder="e.g. 2800" min="0"/>
    </div>
    <div class="tp-field-row">
      <label>Miles</label>
      <input type="number" id="tp-miles" placeholder="e.g. 400" min="0"/>
    </div>
    <div class="tp-field-row">
      <label>Fee %</label>
      <input type="number" id="tp-feepct" placeholder="8" min="1" max="20" value="8"/>
    </div>
    <button class="tp-calc-btn" onclick="tpCalcRate()">Calculate</button>
    <div class="tp-result" id="tp-rate-result"></div>
  </div>
  <!-- PANEL 3: Time Zone -->
  <div class="tp-panel" id="tp-time" style="display:none">
    <div class="tp-field-row">
      <label>IST time (24h)</label>
      <input type="time" id="tp-ist" value="09:00"/>
    </div>
    <button class="tp-calc-btn" onclick="tpCalcTime()">Convert</button>
    <div class="tp-result" id="tp-time-result"></div>
  </div>
</div>
<style>
.tp-tabs { display:flex; gap:0; border-bottom:1px solid rgba(249,115,22,0.15); }
.tp-tab { flex:1; padding:8px 4px; background:none; border:none; color:rgba(255,255,255,0.4); font-size:11px; font-weight:700; cursor:pointer; font-family:'DM Sans',sans-serif; transition:all .15s; border-bottom:2px solid transparent; }
.tp-tab.active { color:var(--orange,#f97316); border-bottom-color:var(--orange,#f97316); }
.tp-tab:hover { color:rgba(255,255,255,0.8); }
.tp-panel { padding:14px 16px; }
.tp-field-row { display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; gap:8px; }
.tp-field-row label { font-size:12px; color:rgba(255,255,255,0.6); white-space:nowrap; }
.tp-field-row input { width:110px; padding:6px 10px; background:rgba(255,255,255,0.07); border:1px solid rgba(255,255,255,0.15); border-radius:8px; color:white; font-size:13px; font-family:'DM Sans',sans-serif; outline:none; text-align:right; }
.tp-field-row input:focus { border-color:rgba(249,115,22,0.5); }
.tp-calc-btn { width:100%; padding:9px; background:linear-gradient(135deg,#f97316,#ea6c0a); border:none; border-radius:10px; color:white; font-size:13px; font-weight:700; cursor:pointer; font-family:'DM Sans',sans-serif; margin-top:4px; transition:filter .15s; }
.tp-calc-btn:hover { filter:brightness(1.1); }
.tp-result { margin-top:10px; padding:10px 12px; border-radius:10px; font-size:12px; font-weight:600; line-height:1.6; display:none; }
.tp-result.ok  { background:rgba(34,197,94,0.12); border:1px solid rgba(34,197,94,0.3); color:#86efac; display:block; }
.tp-result.bad { background:rgba(239,68,68,0.12); border:1px solid rgba(239,68,68,0.3); color:#fca5a5; display:block; }
.tp-result.info { background:rgba(6,182,212,0.1); border:1px solid rgba(6,182,212,0.25); color:#67e8f9; display:block; }
.tp-all-link { font-size:11px; color:rgba(249,115,22,0.8); text-decoration:none; margin-left:auto; margin-right:8px; font-weight:600; }
.tp-all-link:hover { color:#f97316; }
</style>
<script>
function tpTab(btn, panelId) {
  document.querySelectorAll('.tp-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tp-panel').forEach(p => p.style.display = 'none');
  btn.classList.add('active');
  var p = document.getElementById(panelId);
  if (p) p.style.display = 'block';
}
function tpCalcHours() {
  var drive = parseFloat(document.getElementById('tp-drive').value) || 0;
  var duty  = parseFloat(document.getElementById('tp-duty').value)  || 0;
  var rest  = parseFloat(document.getElementById('tp-rest').value)  || 0;
  var r = document.getElementById('tp-hours-result');
  var issues = [];
  if (drive > 10) issues.push('â›” Driving exceeds 10hr max (extension)');
  else if (drive > 9) issues.push('âš ï¸ Using 10hr extension â€” max 2Ã—/week');
  if (duty > 13) issues.push('â›” On-duty exceeds 13hr max');
  if (rest < 9)  issues.push('â›” Rest below 9hr minimum');
  else if (rest < 11) issues.push('âš ï¸ Reduced rest (9hr) â€” max 3Ã—/week');
  if (issues.length === 0) {
    r.className = 'tp-result ok';
    r.textContent = 'âœ… COMPLIANT â€” Drive ' + drive + 'h Â· Duty ' + duty + 'h Â· Rest ' + rest + 'h';
  } else {
    r.className = 'tp-result bad';
    r.innerHTML = issues.join('<br>');
  }
}
function tpCalcRate() {
  var rate  = parseFloat(document.getElementById('tp-loadrate').value) || 0;
  var miles = parseFloat(document.getElementById('tp-miles').value)    || 0;
  var fee   = parseFloat(document.getElementById('tp-feepct').value)   || 8;
  var r = document.getElementById('tp-rate-result');
  if (!rate || !miles) { r.className='tp-result bad'; r.textContent='Enter load rate and miles'; return; }
  var rpm = (rate / miles).toFixed(2);
  var feeAmt = (rate * fee / 100).toFixed(2);
  var sym = 'Â£';
  r.className = 'tp-result info';
  r.innerHTML = 'RPM: <strong>' + sym + rpm + '/mile</strong><br>Fee (' + fee + '%): <strong>' + sym + feeAmt + '</strong><br>Carrier nets: <strong>' + sym + (rate - feeAmt).toFixed(2) + '</strong>';
}
function tpCalcTime() {
  var ist = document.getElementById('tp-ist').value;
  if (!ist) return;
  var parts = ist.split(':');
  var h = parseInt(parts[0]), m = parseInt(parts[1]);
  var totalMins = h * 60 + m;
  function fmt(mins) {
    mins = ((mins % 1440) + 1440) % 1440;
    var hh = Math.floor(mins/60), mm = mins%60;
    return (hh<10?'0':'')+hh+':'+(mm<10?'0':'')+mm;
  }
  var gmtMins  = totalMins - 330;
  var estMins  = totalMins - 630;
  var cstMins  = totalMins - 690;
  var pstMins  = totalMins - 810;
  var r = document.getElementById('tp-time-result');
  r.className = 'tp-result info';
  r.innerHTML = 'IST ' + ist + '<br>GMT/UK: <strong>' + fmt(gmtMins) + '</strong><br>EST (NY): <strong>' + fmt(estMins) + '</strong><br>CST (Chicago): <strong>' + fmt(cstMins) + '</strong><br>PST (LA): <strong>' + fmt(pstMins) + '</strong>';
}
</script>

<script>
// â”€â”€ Madam JI Knowledge Base + Chat â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function(){

  // â”€â”€ EMBEDDED KNOWLEDGE BASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MADAM JI â€” PRE-LOADED KNOWLEDGE BASE
// 200 Q&A pairs covering the full Eagle Academy course
// English + Hindi questions, English answers
// Fuzzy keyword matching â€” score 0-100, threshold 40
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FUZZY SEARCH ENGINE
// Scores each KB entry against the query
// Returns best match if score >= threshold
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function mjSearch(query) {
  if (!query) return null;
  var q = query.toLowerCase()
    .replace(/[?!à¥¤,]/g,'')
    .replace(/\s+/g,' ')
    .trim();
  var words = q.split(' ').filter(function(w){ return w.length > 2; });
  
  var best = null;
  var bestScore = 0;

  for (var i = 0; i < MJ_KB.length; i++) {
    var entry = MJ_KB[i];
    var score = 0;

    for (var k = 0; k < entry.k.length; k++) {
      var kw = entry.k[k].toLowerCase();
      // Exact phrase match = very high score
      if (q.indexOf(kw) !== -1) {
        score = Math.max(score, kw.length > 6 ? 90 : 70);
      }
      // Keyword phrase words match
      var kwWords = kw.split(' ');
      var matchedKwWords = 0;
      for (var kw2 = 0; kw2 < kwWords.length; kw2++) {
        if (q.indexOf(kwWords[kw2]) !== -1) matchedKwWords++;
      }
      if (kwWords.length > 0) {
        score = Math.max(score, Math.round((matchedKwWords / kwWords.length) * 75));
      }
    }

    // Also check individual query words against keywords
    for (var w = 0; w < words.length; w++) {
      var word = words[w];
      if (word.length < 3) continue;
      for (var k2 = 0; k2 < entry.k.length; k2++) {
        if (entry.k[k2].indexOf(word) !== -1) {
          score = Math.max(score, 45);
          break;
        }
      }
    }

    if (score > bestScore) {
      bestScore = score;
      best = entry;
    }
  }

  // Threshold: 40+ = good enough match
  return bestScore >= 40 ? { entry: best, score: bestScore } : null;
}


  // â”€â”€ EMBEDDED KNOWLEDGE BASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  var MJ_KB = [
  {k:['what is freight dispatch','freight dispatcher','dispatch kya','dispatcher kya karta','dispatcher job'],
  a:'A freight dispatcher connects truck carriers with shippers who need loads moved. You find loads on load boards, negotiate rates, handle paperwork, and keep communication between all parties.\n\nDispatcher carriers ko shippers se connect karta hai â€” jo loads move karna chahte hain.'},
  
  {k:['shipper broker carrier','logistics chain','who is shipper','who is broker','broker kya hota','shipper kya hota','three players'],
  a:'The logistics chain has 3 key players:\n\nShipper â€” the company with goods to move\nBroker â€” middle person connecting shippers with carriers, licensed with FMCSA\nCarrier â€” the trucking company that moves the freight\n\nPayment: Shipper pays Broker, Broker pays Carrier, Carrier pays Dispatcher fee'},
  
  {k:['mc number','motor carrier','fmcsa','dot number','mc number check'],
  a:'MC Number is a licence issued by FMCSA in the USA. Every carrier must have one to legally haul freight for hire.\n\nAlways verify a carrier MC number before booking a load â€” check at safer.fmcsa.dot.gov â€” look for "Authorized for Hire" status.\n\nNever book with a carrier whose MC is not active!'},
  
  {k:['o licence','operators licence','o-licence kya','operator licence uk','goods vehicle','transport manager'],
  a:'O-Licence (Operators Licence) is the UK legal requirement to operate commercial goods vehicles over 3.5 tonnes.\n\nThree types:\n- Standard National â€” UK only\n- Standard International â€” UK and Europe\n- Restricted â€” own goods only\n\nRequirements: Transport Manager (CPC qualified), safe operating centre, maintenance records. DVSA enforces it. Operating without one = criminal offence!'},
  
  {k:['double brokering','re-brokering','broker fraud','load fraud'],
  a:'Double brokering is when a broker secretly re-brokers your load to another carrier without permission. It is illegal and serious fraud.\n\nWarning signs: Carrier asks to re-assign the load, different carrier shows up than on Rate Con, carrier cannot show their own MC authority.\n\nProtection: Always verify carrier MC before dispatch, get signed Rate Confirmation immediately.'},
  
  {k:['icar','icar method','icar kya hai','introduce confirm authorise rate','dispatch call','carrier call script','how to call carrier'],
  a:'ICAR is the 4-step call structure every dispatcher uses:\n\nI - Introduce: "Hi, this is [Name] dispatching for [Carrier Name], MC# [number]"\nC - Confirm: Confirm load details â€” pickup, delivery, weight, equipment\nA - Authorise: Verify broker MC number, check credit score on DAT\nR - Rate: Negotiate the rate per mile, get agreement before ending call\n\nPractice this until it is automatic!'},
  
  {k:['dispatcher agreement','dispatch contract','service agreement','agreement kya hota','legal agreement'],
  a:'A Dispatcher Service Agreement is the contract between you and your carrier client.\n\nKey clauses it must include:\n- Your fee percentage (typically 5-10%)\n- Services you provide\n- Payment terms\n- Termination notice period\n- Independent contractor status (not employee)\n\nNever start dispatching without a signed agreement!'},
  
  {k:['dry van','dry van kya','dry van trailer','box trailer','most common trailer','standard trailer'],
  a:'Dry Van is the most common trailer type â€” an enclosed box trailer that protects cargo from weather.\n\nWhat it carries: Packaged goods, boxes, pallets, non-perishable items\nStandard size: 53 feet long\nMax payload: around 44,000 lbs\n\nBest for beginners â€” most loads on load boards are dry van.\n\nDry van = band enclosed trailer jo sabse common hai'},
  
  {k:['flatbed','flatbed trailer','flatbed kya','flat bed','open trailer','step deck'],
  a:'Flatbed trailers have no walls or roof â€” cargo is exposed and must be strapped and tarped.\n\nWhat it carries: Steel, lumber, machinery, construction equipment, oversized loads\nRequires: Proper strapping, tarping skills, securement knowledge\nPays more than dry van due to skill required\n\nFlatbed mein koi side wall nahi hoti â€” cargo khula hota hai'},
  
  {k:['reefer','refrigerated','temperature controlled','cold chain','reefer kya','refrigerated trailer','frozen loads','perishable'],
  a:'Reefer (Refrigerated trailer) maintains temperature-controlled environment for perishable cargo.\n\nTemperature ranges:\n- Frozen: -10F to 0F\n- Fresh: 34F to 40F\n\nWhat it carries: Meat, produce, dairy, pharmaceuticals\n\nMust monitor temperature logs â€” any temperature deviation = rejected load. Pays premium rates.'},
  
  {k:['tanker','tanker trailer','liquid freight','bulk liquid','tanker kya','hazmat','hazardous material'],
  a:'Tanker trailers carry liquid or bulk cargo â€” food grade or chemical.\n\nTypes:\n- Food grade: Milk, juice, liquid sugar, edible oils\n- Chemical: Acids, solvents, fuel (requires HAZMAT endorsement)\n- Dry bulk: Cement, grain, sand\n\nSpecial requirements: CDL with Tanker endorsement, HAZMAT for chemicals'},
  
  {k:['ftl ltl','full truck load','less than truck load','ftl kya','ltl kya','full load','partial load','ftl vs ltl'],
  a:'FTL vs LTL key difference:\n\nFTL (Full Truck Load): One shipper fills the whole trailer, direct pickup to delivery, simpler to manage, best for beginners\n\nLTL (Less Than Truck Load): Multiple shippers share one trailer, multiple pickups and deliveries, more complex\n\nStart with FTL â€” master it before moving to LTL!'},
  
  {k:['intermodal','intermodal kya','container','rail freight','port freight','drayage'],
  a:'Intermodal freight uses multiple transport modes â€” typically ocean ship + rail + truck.\n\nThe journey: Container arrives at port by ship, drayage truck moves it to rail yard, rail carries it across country, local truck delivers to destination.\n\nDrayage = short local truck move connecting transport modes (port to rail, rail to warehouse)'},
  
  {k:['curtainsider','curtain trailer','tautliner','uk trailer','side curtain'],
  a:'Curtainsider (Tautliner) is the most common trailer type in UK and Europe â€” not common in USA.\n\nThe sides are made of sliding curtain fabric instead of solid walls.\n\nAdvantages: Easy forklift loading from sides, faster loading\nCarries: Palletised goods, building materials, retail deliveries\n\nVery common in UK pallet network deliveries!'},
  
  {k:['low loader','low bed','heavy haulage','oversized load','abnormal load','wide load'],
  a:'Low loader trailers are used for very tall or heavy cargo that will not fit standard trailers.\n\nWhat it carries: Construction machinery, cranes, industrial equipment, transformers\n\nRequires: Special permits, police escorts for wide loads, route surveys\n\nUK term: Abnormal load â€” requires DVSA notification and sometimes road closures'},
  
  {k:['chicago','chicago hub','chicago freight','midwest','chicago why important','logistics hub'],
  a:'Chicago is the most important freight hub in North America.\n\nWhy Chicago matters:\n- Intersection of 6 major interstate highways\n- Largest rail hub in USA â€” 25% of all US rail freight\n- Central location connecting East, West, South\n- Home to major distribution centres for most retailers\n\nMany of your loads will start, end, or pass through Chicago!'},
  
  {k:['dallas','texas freight','dallas hub','southern freight','texas lanes'],
  a:'Dallas-Fort Worth is the second biggest freight hub in the USA.\n\nWhy Dallas matters:\n- Central location connecting all four US regions\n- Massive manufacturing and distribution activity\n- Houston nearby = huge port freight connection\n- Dallas-Chicago corridor is one of the highest paying lanes\n\nKey routes: I-35 North to Chicago, I-20 East to Atlanta, I-10 West to LA'},
  
  {k:['northeast','new york','boston','difficult lanes','congestion','northeast freight'],
  a:'The Northeast (NY, NJ, Boston, Philadelphia) is the hardest region to dispatch.\n\nWhy it is difficult:\n- Heavy traffic and congestion = slow deliveries\n- City restrictions on truck sizes and hours\n- Tolls are expensive\n- Parking extremely limited\n- Higher rates but much harder to find willing carriers\n\nNewer dispatchers should avoid Northeast loads until experienced!'},
  
  {k:['hot lane','high paying lane','best lanes','good lane','profitable lane'],
  a:'Hot lanes are routes with high demand and good paying rates.\n\nConsistently hot lanes:\n- Dallas to Chicago (I-35 North) â€” always high demand\n- LA to Chicago (I-40/I-80) â€” long haul, great RPM\n- Atlanta to Northeast â€” retail distribution\n- Texas to Southeast â€” manufacturing freight\n\nHow to spot a hot lane: Compare DAT rate history. If current rate is 20% above average = hot lane!'},
  
  {k:['deadhead','deadhead miles','empty miles','deadhead kya','empty truck'],
  a:'Deadhead miles = miles driven with an empty trailer (no load, no revenue).\n\nEvery deadhead mile costs fuel but earns nothing.\n\nGood dispatcher target: Keep deadhead under 15% of total miles.\n\nHow to minimise deadhead:\n- Find backhaul loads near delivery point\n- Search load boards for loads within 50 miles of delivery\n- Build relationships with brokers at popular delivery areas\n\nDeadhead = khali truck ka safar â€” koi payment nahi milti'},
  
  {k:['hours of service','hos','driving hours','11 hour rule','14 hour rule','70 hour rule','hos kya','driving limit'],
  a:'USA Hours of Service (HOS) Rules:\n\n- 11 hours max driving after 10hr off duty\n- 14 hours max on-duty window (driving + other work)\n- 30 minute break required after 8 hours driving\n- 70 hours max in 8 consecutive days\n- 34-hour restart resets the 70hr clock\n\nIf driver hits limits they MUST stop. Dispatcher cannot pressure driver to violate HOS!'},
  
  {k:['uk drivers hours','eu drivers hours','9 hours','10 hours','45 minute break','uk driving limit'],
  a:'UK/EU Drivers Hours Rules:\n\nDaily limits:\n- 9 hours normal daily driving\n- 10 hours extended limit â€” max 2 times per week\n- 45-minute break after 4.5 hours driving\n- 11 hours normal daily rest\n\nWeekly limits:\n- 56 hours max per week\n- 90 hours max per fortnight\n- 45 hours weekly rest required'},
  
  {k:['eld','electronic logging device','eld kya','eld mandate','hours of service log','paper log','logbook'],
  a:'ELD (Electronic Logging Device) â€” mandatory in USA since 2017.\n\nWhat it does:\n- Automatically records driving time via vehicle engine connection\n- Cannot be edited unlike paper logs\n- Syncs with FMCSA database\n- Officers can check it roadside\n\nNEVER ask a driver to violate their ELD hours!'},
  
  {k:['tachograph','tacho','tachograph kya','digital tachograph','tacho rules','dvsa tacho'],
  a:'Tachograph is the UK/EU equivalent of ELD â€” records driver hours and speed automatically.\n\nTwo types:\n- Analogue â€” uses paper disc (older vehicles)\n- Digital â€” stores data on driver smartcard\n\nDriver must insert personal smartcard before driving and select correct mode.\n\nDVSA can request 28 days of records at roadside. Infringements = fines and O-Licence risk!'},
  
  {k:['wtd','working time directive','48 hour week','working hours uk','wtd kya'],
  a:'WTD (Working Time Directive) â€” UK law on maximum working hours.\n\nKey limits:\n- 48 hours average per week (averaged over 17 weeks)\n- Break required after 6 hours work\n- Night workers limited to 10 hours per night shift\n\nFor transport workers: Driving time + loading + waiting + admin all count as working time. WTD and drivers hours rules BOTH apply simultaneously!'},
  
  {k:['dvsa','driver vehicle standards agency','dvsa kya','roadside check','vehicle inspection','prohibition'],
  a:'DVSA (Driver and Vehicle Standards Agency) â€” UK transport enforcement agency.\n\nWhat they do:\n- Roadside vehicle and driver checks\n- Issue immediate prohibitions for dangerous vehicles\n- Investigate O-Licence holders\n- Check tachograph records\n- Enforce drivers hours compliance\n\nClean DVSA record = good reputation, easier O-Licence renewal'},
  
  {k:['cmr','cmr note','consignment note','cmr kya','international freight document'],
  a:'CMR Note is the standard international road freight consignment document.\n\nRequired for all international road freight in Europe.\n\nContains: Sender and receiver details, description of goods, weight, carrier details, vehicle registration, signatures at collection and delivery.\n\nCMR acts as proof of collection AND contract between shipper and carrier. Keep copies for 7 years!'},
  
  {k:['dat','dat load board','dat kya','dat freight','load board','where to find loads','find loads'],
  a:'DAT is the largest load board in the USA with over 1.4 million loads posted daily.\n\nWhat you can do on DAT:\n- Search loads by origin, destination, equipment type\n- See real-time rate data\n- Check carrier credit scores before booking\n- Access historical rate trends\n\nDAT = USA ka sabse bada load board hai'},
  
  {k:['rpm','rate per mile','rpm kya','calculate rpm','good rpm','rate calculation','how to calculate rate'],
  a:'RPM (Rate Per Mile) = Total load rate divided by Total miles\n\nExample: 1800 load / 400 miles = 4.50 per mile\n\nTarget RPMs (USA averages):\n- Dry Van: $2.50-3.50/mile is good\n- Reefer: $3.00-4.00/mile\n- Flatbed: $3.00-4.50/mile\n\nUK rates per mile:\n- General haulage: 1.80-2.80/mile\n- Temperature controlled: 2.50-3.50/mile\n\nAlways calculate RPM before accepting any load!'},
  
  {k:['rate confirmation','rate con','rate confirmation kya','load contract','what is rate con','dispatch paperwork'],
  a:'Rate Confirmation (Rate Con) is the official contract between broker and carrier for a specific load.\n\nMust contain: Load number, broker details and MC number, pickup and delivery addresses, agreed rate, payment terms, special instructions.\n\nRules:\n- ALWAYS get signed Rate Con BEFORE truck arrives at shipper\n- Never dispatch without a signed Rate Con\n- If rate changes, get a new Rate Con â€” verbal changes mean nothing legally!'},
  
  {k:['credit score','broker credit score','dat credit score','check broker','broker verify','safe broker'],
  a:'Broker credit score tells you if a broker pays carriers on time.\n\nDAT Credit Score ranges:\n- 90-100: Excellent, pay reliably and quickly\n- 70-89: Good, occasional slow payment\n- 50-69: Risky, check payment terms carefully\n- Below 50: AVOID â€” serious payment history issues\n\nAlways check credit score on DAT before booking with a new broker!\n\nDAT par broker ka credit score check karo â€” 80+ safe hai'},
  
  {k:['bol','bill of lading','bill of lading kya','bol kya','pickup document','proof of delivery','pod'],
  a:'BOL (Bill of Lading) is the most important freight document â€” proof the load was picked up.\n\nBOL contains: Shipper name and address, receiver name and address, commodity, weight, piece count, driver signature and date at pickup.\n\nThree key moments:\n1. At pickup â€” driver signs BOL\n2. In transit â€” BOL travels with the load\n3. At delivery â€” receiver signs as POD (Proof of Delivery)\n\nNo signed BOL = no proof load was collected!'},
  
  {k:['detention','detention pay','waiting time','layover','detention kya','shipper delay'],
  a:'Detention pay = payment to carrier when shipper or receiver causes excessive waiting time.\n\nStandard terms:\n- First 2 hours of waiting = free\n- After 2 hours = detention, typically $50-75 per hour USA\n\nAs dispatcher:\n- Note arrival time when driver arrives\n- Notify broker immediately if detention starts\n- Get detention approval from broker in writing\n- Add detention to the invoice\n\nDetention MUST be pre-approved by broker!'},
  
  {k:['quickpay','quick pay','fast payment','payment terms','net 30','factoring','when do i get paid'],
  a:'Payment terms in freight dispatching:\n\nStandard: Net-30 â€” broker pays carrier 30 days after delivery\nQuickPay: Pay extra fee (1.5-5%) to get paid in 1-3 days\nFactoring: Third-party company buys your invoices, pays same day (takes 2-4% fee)\n\nRecommend QuickPay to your carriers â€” better cash flow for everyone.'},
  
  {k:['courier exchange','cx','haulage exchange','uk load board','uk freight exchange'],
  a:'Courier Exchange (CX) is the largest UK freight exchange platform.\n\nHow it works:\n- Haulage companies post available capacity (empty trucks)\n- Members post loads needing transport\n- All members are vetted and insured\n- Real-time load tracking available\n\nFor UK freight dispatching, CX membership is essential. Most UK owner-operators are on it.'},
  
  {k:['pallet network','palletforce','pall-ex','tpn','uk pallet','pallet delivery'],
  a:'UK Pallet Networks are systems where hauliers collaborate to deliver pallets nationally.\n\nMain networks:\n- Palletforce â€” premium, highest standards\n- Pall-Ex â€” good coverage, competitive\n- TPN (The Pallet Network) â€” large membership\n- Palletline â€” strong in Midlands/North\n\nHow it works: Local haulier collects pallets, takes to regional hub overnight, hub distributes to local hauliers near destination, they deliver last mile.'},
  
  {k:['time zone','ist','gmt','est','pst','india time','usa time','time difference','ist to est','ist to gmt'],
  a:'Time zone chart for Indian freight dispatchers:\n\nIST (India) is the reference:\n- IST = GMT/UK + 5:30 hours\n- IST = EST New York + 10:30 hours\n- IST = CST Chicago + 11:30 hours\n- IST = PST Los Angeles + 13:30 hours\n\nPractical example:\n- 9:00 AM IST = 3:30 AM GMT = 10:30 PM EST previous day\n- To reach Chicago brokers at 9 AM their time, you call at 8:30 PM IST\n\nUSA business hours (8AM-6PM local) = your evening/night shift!'},
  
  {k:['working hours dispatcher','shift timing','dispatcher shift','india dispatcher schedule','night shift'],
  a:'Working schedule for Indian dispatchers working USA loads:\n\nUSA East Coast (EST) loads:\n- Brokers active 8AM-6PM EST = 6:30PM-4:30AM IST\n- Your working window: around 7PM-2AM IST covers peak hours\n\nUSA West Coast (PST) loads:\n- Your working window: around 10PM-4AM IST\n\nUK loads:\n- UK working hours: 7AM-6PM GMT = 12:30PM-11:30PM IST\n- Much more comfortable afternoon/evening IST shift!'},
  
  {k:['how to negotiate','negotiation','rate negotiation','negotiate with broker','how to get better rate'],
  a:'Rate negotiation tips:\n\nOpening move: Never accept the first offer. Always counter.\n\nScript: "The market rate on DAT for this lane is $X. We can do this for $[higher amount]."\n\nTactics:\n- Quote 10-15% above what you would accept\n- Reference DAT rate data â€” makes you sound professional\n- Be willing to walk away â€” brokers often come back\n- Build relationships â€” repeat brokers give better rates'},
  
  {k:['dispatcher fee','commission','percentage','how much charge','fee structure'],
  a:'Dispatcher fees typically range from 5% to 10% of gross load rate.\n\nCommon structures:\n- 5-7%: Standard for high volume, long-term carriers\n- 8-10%: Standard for newer relationships or complex freight\n- Flat fee: Some charge per load instead of percentage\n\nExample: $3,000 load at 8% = $240 dispatcher fee\n\nFee is always specified in Dispatcher Service Agreement and invoiced separately.'},
  
  {k:['how to start','how to become dispatcher','dispatcher kaise bane','start dispatching','new dispatcher','first step'],
  a:'How to start your freight dispatching career:\n\nStep 1: Complete your training (you are doing it now!)\nStep 2: Prepare your documents â€” Dispatcher Service Agreement template\nStep 3: Set up your tools â€” DAT account, email, phone\nStep 4: Find your first carrier â€” Facebook trucking groups, LinkedIn, cold outreach\nStep 5: Sign them up, verify their MC details\nStep 6: Find their first load using ICAR call method\nStep 7: Deliver and invoice â€” build the relationship\n\nStart with 1-2 carriers, master the process, then grow!'},
  
  {k:['dispatcher tools','software','crm','tools needed','what software','dispatcher software'],
  a:'Essential tools for a freight dispatcher:\n\nMust have:\n- DAT Load Board â€” find loads and check rates\n- Google Sheets/Excel â€” track loads, carriers, invoices\n- Professional email â€” all communication\n- Phone â€” calling brokers and carriers\n\nRecommended:\n- Truckstop.com â€” second load board\n- QuickBooks â€” accounting and invoicing\n- WhatsApp â€” quick updates with carriers\n\nStart free with Google Sheets for tracking â€” upgrade as you grow'},
  
  {k:['what is eagle academy','eagle academy','about this course','course kya hai','what will i learn'],
  a:'Eagle Academy is a UK Freight Dispatcher Certification course designed for Indian students.\n\nThe 4-week programme covers:\n- Week 1: Dispatch foundations, freight types, logistics chain\n- Week 2: Geography, lanes, USA and UK markets\n- Week 3: Hours of service, tachographs, DVSA, UK regulations\n- Week 4: Load boards, rate calculation, invoicing, career launch\n\nBy the end you will be job-ready to work as a UK-based freight coordinator or remote dispatcher!'},
  
  {k:['madam ji','who are you','aap kaun ho','who is madam ji','about madam ji'],
  a:'Namaste! I am Madam JI â€” your AI study assistant for Eagle Academy!\n\nI am here to help you understand freight dispatching. Ask me anything about:\n- UK transport law and regulations\n- USA freight operations\n- Load boards and rate calculation\n- Tachographs, drivers hours, DVSA\n- ICAR method and dispatcher calls\n- BOL, Rate Confirmation, CMR documents\n\nAsk in English ya Hindi mein â€” koi bhi sawaal pucho!'},
  
  {k:['dispatcher kya hota hai','dispatcher ka kaam','freight dispatcher hindi'],
  a:'Freight Dispatcher ek aisa professional hota hai jo truck carriers ko shippers se connect karta hai.\n\nAapka kaam hoga:\n- Load boards par loads dhundhna (DAT, Truckstop)\n- Brokers se rate negotiate karna\n- Drivers ke saath coordination karna\n- Sabhi documents handle karna (BOL, Rate Con)\n- Carrier ko on time delivery ensure karna\n\nYeh kaam ghar se bhi ho sakta hai â€” laptop aur phone se!'},
  
  {k:['uk mein kaise kaam kare','uk freight','uk mein job','uk job kaise milegi'],
  a:'UK mein Freight Dispatcher ke roop mein kaam karne ke do tarike hain:\n\nOption 1: UK jakar kaam karna\n- Freight coordinator/administrator ke roop mein apply karein\n- Job boards: Indeed UK, Reed.co.uk, Totaljobs\n- Companies: DHL, XPO Logistics, Eddie Stobart\n\nOption 2: India se UK ke liye remote work\n- UK-based hauliers ke liye remote dispatcher banein\n- LinkedIn par UK transport companies connect karein\n\nEagle Academy certification aapko dono ke liye taiyaar karti hai!'},
  
  {k:['exam','test','quiz','pass karna','final exam','certificate kaise milega','exam kaise pass kare'],
  a:'Eagle Academy Final Exam ke baare mein:\n\nStructure:\n- Multiple choice questions covering all 4 weeks\n- Time limit: 60 minutes\n- Pass mark: 70%\n\nBest preparation:\n- Complete all week quizzes first\n- Review topics where you scored low\n- Use these Q&A chips to revise key concepts\n- Practice ICAR method out loud\n\nPass karne par Eagle Academy Freight Dispatcher Certificate milega â€” ise LinkedIn par add karein!'},
  
  {k:['invoice','carrier invoice','how to invoice','billing','freight invoice'],
  a:'How to invoice after a load delivers:\n\nCarrier invoice must include: Carrier name, MC number, address, load number, origin and destination, delivery date, agreed rate from Rate Con, any extras like detention.\n\nAttach these documents: Signed Rate Confirmation, Signed BOL, Signed POD (Proof of Delivery)\n\nSend to broker accounts payable email within 48 hours of delivery. Late invoicing = late payment!'}
  
  ]; // end MJ_KB
  
  function mjSearch(query) {
    if (!query) return null;
    var q = query.toLowerCase().replace(/[?!,à¥¤]/g,'').trim();
    var words = q.split(' ').filter(function(w){ return w.length > 2; });
    var best = null, bestScore = 0;
    for (var i = 0; i < MJ_KB.length; i++) {
      var entry = MJ_KB[i], score = 0;
      for (var k = 0; k < entry.k.length; k++) {
        var kw = entry.k[k].toLowerCase();
        if (q.indexOf(kw) !== -1) { score = Math.max(score, kw.length > 6 ? 90 : 70); }
        var kww = kw.split(' '), matched = 0;
        for (var j = 0; j < kww.length; j++) { if (q.indexOf(kww[j]) !== -1) matched++; }
        if (kww.length > 0) score = Math.max(score, Math.round((matched / kww.length) * 75));
      }
      for (var w = 0; w < words.length; w++) {
        for (var k2 = 0; k2 < entry.k.length; k2++) {
          if (entry.k[k2].indexOf(words[w]) !== -1) { score = Math.max(score, 45); break; }
        }
      }
      if (score > bestScore) { bestScore = score; best = entry; }
    }
    return bestScore >= 40 ? {entry: best, score: bestScore} : null;
  }
  
  // end MJ_KB marker

  var mjHistory = [];
  var mjApiKey = '';
  try { mjApiKey = localStorage.getItem('ea_mj_key') || ''; } catch(e){}
  if (!mjApiKey) document.getElementById('mj-key-row').style.display = 'block';

  var MJ_SYSTEM = 'You are Madam JI â€” the AI study assistant for Eagle Academy UK Freight Dispatcher Certification. Help students understand UK and international freight dispatch. Be friendly, encouraging, concise. Topics: UK transport law, O-Licence, DVSA, tachographs, CMR notes, drivers hours, WTD, Courier Exchange, pallet networks, USA HOS rules, ICAR method, load boards, BOL, Rate Confirmation. Never mention earnings or income promises. Respond in Hindi if asked.';

  window.mjToggle = function(){
    var p = document.getElementById('mj-popup');
    var t = document.getElementById('tools-popup');
    if(t) t.classList.remove('open');
    p.classList.toggle('open');
    if(p.classList.contains('open')) setTimeout(function(){ var q=document.getElementById('mj-q'); if(q) q.focus(); },300);
  };
  window.toolsToggle = function(){
    var p = document.getElementById('tools-popup');
    var m = document.getElementById('mj-popup');
    if(m) m.classList.remove('open');
    p.classList.toggle('open');
  };
  window.mjChip = function(q){ if(!q) return; var i=document.getElementById('mj-q'); if(i) i.value=q; window.mjSend(); };
  window.mjSaveKey = function(v){ mjApiKey=v.trim(); try{localStorage.setItem('ea_mj_key',mjApiKey);}catch(e){} if(mjApiKey) document.getElementById('mj-key-row').style.display='none'; };
  window.mjSend = async function(){
    var inp=document.getElementById('mj-q'); var q=inp?inp.value.trim():''; if(!q) return; if(inp) inp.value='';

    mjAdd(q,'user');

    // â”€â”€ STEP 1: Search knowledge base first â”€â”€â”€â”€â”€
    var match = mjSearch(q);
    if (match) {
      // Found a good match â€” answer instantly, no API needed
      var answer = match.entry.a;
      // Format markdown-style bold
      answer = answer.replace(/\*\*(.*?)\*\*/g, '$1');
      setTimeout(function(){ mjAddFormatted(answer,'bot'); }, 300);
      mjHistory.push({role:'user',content:q});
      mjHistory.push({role:'assistant',content:answer});
      return;
    }

    // â”€â”€ STEP 2: No KB match â€” try API if available â”€
    mjHistory.push({role:'user',content:q});

    if (!mjApiKey){
      document.getElementById('mj-key-row').style.display='block';
      var msgs=document.getElementById('mj-msgs');
      var lastMsg=msgs?msgs.querySelector('.mj-msg.bot:last-child'):null;
      if(!lastMsg||!lastMsg.textContent.includes('API key')){
        setTimeout(function(){
          mjAdd('I do not have a pre-loaded answer for that. Add an API key below to ask anything â€” or try rephrasing!','bot');
        },300);
      }
      return;
    }

    var t=document.createElement('div'); t.className='mj-msg bot typing'; t.id='mj-typing';
    t.innerHTML='<div class="mj-dot"></div><div class="mj-dot"></div><div class="mj-dot"></div>';
    document.getElementById('mj-msgs').appendChild(t); mjScroll();
    try {
      var r=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json','x-api-key':mjApiKey,'anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true'},body:JSON.stringify({model:'claude-haiku-4-5-20251001',max_tokens:500,system:MJ_SYSTEM,messages:mjHistory})});
      var d=await r.json(); var reply=d.content&&d.content[0]?d.content[0].text:'Sorry, try again.';
      mjHistory.push({role:'assistant',content:reply});
      var ty=document.getElementById('mj-typing'); if(ty) ty.remove();
      mjAdd(reply,'bot');
    } catch(e){ var ty=document.getElementById('mj-typing'); if(ty) ty.remove(); mjAdd('Connection error â€” check your internet or API key.','bot'); }
  };
  function mjAdd(text,role){ var d=document.createElement('div'); d.className='mj-msg '+role; d.textContent=text; document.getElementById('mj-msgs').appendChild(d); mjScroll(); }
  function mjAddFormatted(text,role){
    var d=document.createElement('div'); d.className='mj-msg '+role;
    var html = text.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'<br>');
    d.innerHTML = html;
    document.getElementById('mj-msgs').appendChild(d); mjScroll();
  }
  function mjScroll(){ var m=document.getElementById('mj-msgs'); if(m) m.scrollTop=m.scrollHeight; }
  document.addEventListener('click',function(e){
    var mf=document.getElementById('mj-fab'), mp=document.getElementById('mj-popup');
    var tf=document.getElementById('tools-fab'), tp=document.getElementById('tools-popup');
    if(mp&&mp.classList.contains('open')&&!mp.contains(e.target)&&e.target!==mf) mp.classList.remove('open');
    if(tp&&tp.classList.contains('open')&&!tp.contains(e.target)&&e.target!==tf) tp.classList.remove('open');
  });
})();
</script>
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• END FABs â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
</body>
</html>
