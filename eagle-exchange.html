<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Eagle Exchange â€” UK Load Board Simulator | Eagle Academy</title>
<link rel="stylesheet" href="assets/style.css"/>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500;600&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet"/>
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EAGLE EXCHANGE â€” UK Load Board Simulator
   Light classroom theme, Eagle Academy branding
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --navy:    #2B2BA8;
  --navy2:   #1e1e8f;
  --navy3:   #16166a;
  --orange:  #F47920;
  --orange2: #f79240;
  --og-dk:   #d4661a;
  --bg:      #f0f2f8;
  --surface: #ffffff;
  --surf2:   #f8f9ff;
  --text:    #1a1a5e;
  --text2:   #4a4a8a;
  --text3:   #8888aa;
  --border:  rgba(43,43,168,0.14);
  --green:   #16a34a;
  --green-bg:rgba(22,163,74,0.10);
  --red:     #dc2626;
  --red-bg:  rgba(220,38,38,0.10);
  --amber:   #d97706;
  --amber-bg:rgba(217,119,6,0.10);
  --sh-sm:   0 2px 8px rgba(43,43,168,0.08);
  --sh:      0 4px 20px rgba(43,43,168,0.12);
  --sh-lg:   0 8px 40px rgba(43,43,168,0.18);
  --r:       12px;
  --r-sm:    8px;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;font-size:15px;line-height:1.5;min-height:100vh}

/* HEADER */
.ex-header{background:var(--navy);border-bottom:3px solid var(--orange);position:sticky;top:0;z-index:300;box-shadow:0 2px 16px rgba(43,43,168,0.3)}
.ex-header-inner{max-width:1400px;margin:0 auto;padding:0 20px;height:62px;display:flex;align-items:center;gap:16px}
.ex-logo{display:flex;align-items:center;gap:10px;text-decoration:none;flex-shrink:0}
.ex-logo-icon{width:38px;height:38px;background:linear-gradient(135deg,var(--orange),var(--og-dk));border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:20px}
.ex-logo-text{line-height:1}
.ex-logo-text .name{font-family:'Syne',sans-serif;font-weight:800;font-size:16px;color:#fff;letter-spacing:.5px}
.ex-logo-text .sub{font-size:9px;color:var(--orange);letter-spacing:2px;text-transform:uppercase}
.ex-badge{background:rgba(244,121,32,0.2);border:1px solid rgba(244,121,32,0.4);color:var(--orange);font-size:10px;font-weight:700;padding:3px 8px;border-radius:20px;letter-spacing:.5px}
.ex-nav-back{margin-left:auto;display:flex;align-items:center;gap:10px}
.ex-nav-back a{color:rgba(255,255,255,0.75);font-size:12px;font-weight:600;text-decoration:none;padding:6px 12px;border-radius:var(--r-sm);border:1px solid rgba(255,255,255,0.2);transition:all .2s}
.ex-nav-back a:hover{color:#fff;background:rgba(255,255,255,0.1)}
.live-clock{font-family:'JetBrains Mono',monospace;font-size:11px;color:rgba(255,255,255,0.8);background:rgba(255,255,255,0.08);padding:5px 10px;border-radius:6px;border:1px solid rgba(255,255,255,0.15)}
.live-clock .uk-label{color:var(--orange);font-weight:700}

/* TICKER */
.ex-ticker{background:var(--navy3);border-bottom:1px solid rgba(244,121,32,0.2);overflow:hidden;white-space:nowrap;padding:7px 0}
.ex-ticker-inner{display:inline-block;animation:ticker 45s linear infinite}
.ex-ticker span{display:inline-block;padding:0 24px;font-size:11px;font-weight:600;color:rgba(255,255,255,0.85)}
.ex-ticker .dot{color:var(--orange)}
@keyframes ticker{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}

/* LAYOUT */
.ex-wrap{max-width:1400px;margin:0 auto;padding:20px;display:grid;grid-template-columns:1fr 420px;gap:20px;align-items:start}
@media(max-width:1100px){.ex-wrap{grid-template-columns:1fr}}

/* STATS BAR */
.stats-bar{grid-column:1/-1;display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:4px}
.stat-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:14px 18px;display:flex;align-items:center;gap:12px;box-shadow:var(--sh-sm)}
.stat-icon{width:40px;height:40px;border-radius:var(--r-sm);display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
.stat-val{font-family:'Syne',sans-serif;font-size:22px;font-weight:800;color:var(--navy);line-height:1}
.stat-lbl{font-size:11px;color:var(--text3);font-weight:600;text-transform:uppercase;letter-spacing:.4px;margin-top:2px}

/* LEFT â€” LOAD BOARD */
.board-panel{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);box-shadow:var(--sh-sm);overflow:hidden}
.board-header{background:linear-gradient(135deg,var(--navy),var(--navy2));padding:16px 20px;display:flex;align-items:center;justify-content:space-between;gap:12px}
.board-title{font-family:'Syne',sans-serif;font-weight:800;font-size:16px;color:#fff}
.board-subtitle{font-size:11px;color:rgba(255,255,255,0.7);margin-top:2px}
.board-refresh{background:rgba(255,255,255,0.12);border:1px solid rgba(255,255,255,0.2);color:#fff;padding:6px 12px;border-radius:var(--r-sm);font-size:11px;font-weight:700;cursor:pointer;transition:all .2s;font-family:'DM Sans',sans-serif}
.board-refresh:hover{background:rgba(244,121,32,0.3);border-color:var(--orange)}

/* FILTERS */
.board-filters{padding:12px 16px;background:var(--surf2);border-bottom:1px solid var(--border);display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.filter-select{background:#fff;border:1px solid var(--border);border-radius:var(--r-sm);padding:6px 10px;font-size:12px;font-weight:600;color:var(--text);cursor:pointer;font-family:'DM Sans',sans-serif;outline:none}
.filter-select:focus{border-color:var(--navy)}
.filter-search{flex:1;min-width:120px;background:#fff;border:1px solid var(--border);border-radius:var(--r-sm);padding:6px 12px;font-size:12px;color:var(--text);font-family:'DM Sans',sans-serif;outline:none}
.filter-search:focus{border-color:var(--navy)}
.filter-count{margin-left:auto;font-size:11px;font-weight:700;color:var(--text3)}

/* LOAD LIST */
.load-list{max-height:580px;overflow-y:auto;scrollbar-width:thin;scrollbar-color:var(--navy) var(--surf2)}
.load-list::-webkit-scrollbar{width:4px}
.load-list::-webkit-scrollbar-thumb{background:var(--navy);border-radius:2px}
.load-item{padding:14px 16px;border-bottom:1px solid var(--border);cursor:pointer;transition:all .18s;position:relative}
.load-item:hover{background:rgba(43,43,168,0.04)}
.load-item.selected{background:rgba(244,121,32,0.06);border-left:3px solid var(--orange)}
.load-item.booked{opacity:0.5;cursor:not-allowed}
.load-item.urgent::before{content:'URGENT';position:absolute;top:12px;right:12px;background:var(--red);color:#fff;font-size:9px;font-weight:800;padding:2px 6px;border-radius:4px;letter-spacing:.5px;animation:urgentPulse 1.5s ease-in-out infinite}
@keyframes urgentPulse{0%,100%{opacity:1}50%{opacity:0.6}}
.load-route{display:flex;align-items:center;gap:8px;margin-bottom:6px}
.load-city{font-family:'Syne',sans-serif;font-weight:700;font-size:14px;color:var(--navy)}
.load-arrow{color:var(--orange);font-size:14px}
.load-meta{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
.load-tag{font-size:10px;font-weight:700;padding:2px 7px;border-radius:10px;letter-spacing:.3px}
.lt-vehicle{background:rgba(43,43,168,0.08);color:var(--navy)}
.lt-weight{background:rgba(244,121,32,0.08);color:#c45e10}
.lt-distance{background:rgba(8,145,178,0.08);color:#0891b2}
.lt-collection{background:rgba(22,163,74,0.08);color:var(--green)}
.load-bottom{display:flex;align-items:center;justify-content:space-between}
.load-rate{font-family:'Syne',sans-serif;font-weight:800;font-size:18px;color:var(--navy)}
.load-cpm{font-size:11px;color:var(--text3);margin-top:1px}
.load-broker{display:flex;align-items:center;gap:6px}
.broker-name{font-size:11px;font-weight:600;color:var(--text2)}
.cx-score{font-size:10px;font-weight:800;padding:2px 6px;border-radius:6px}
.cx-green{background:var(--green-bg);color:var(--green)}
.cx-amber{background:var(--amber-bg);color:var(--amber)}
.cx-red{background:var(--red-bg);color:var(--red)}
.load-booked-badge{position:absolute;top:14px;right:12px;background:var(--green-bg);color:var(--green);font-size:10px;font-weight:800;padding:3px 8px;border-radius:6px}

/* RIGHT â€” DETAIL PANEL */
.detail-panel{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);box-shadow:var(--sh-sm);position:sticky;top:82px}
.detail-empty{padding:60px 20px;text-align:center;color:var(--text3)}
.detail-empty .big-icon{font-size:48px;margin-bottom:12px}
.detail-empty p{font-size:13px;line-height:1.6}
.detail-header{background:linear-gradient(135deg,var(--navy),var(--navy2));padding:18px 20px;border-radius:var(--r) var(--r) 0 0}
.detail-route{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.detail-city{font-family:'Syne',sans-serif;font-weight:800;font-size:18px;color:#fff}
.detail-arrow{color:var(--orange);font-size:20px}
.detail-rate-big{font-family:'Syne',sans-serif;font-size:32px;font-weight:800;color:#fff;line-height:1}
.detail-cpm-big{font-size:12px;color:rgba(255,255,255,0.7);margin-top:2px}
.detail-urgency{display:inline-block;background:var(--red);color:#fff;font-size:10px;font-weight:800;padding:3px 8px;border-radius:4px;margin-top:8px;animation:urgentPulse 1.5s ease-in-out infinite}
.detail-body{padding:18px 20px}
.detail-section{margin-bottom:16px}
.detail-section-title{font-size:10px;font-weight:800;text-transform:uppercase;letter-spacing:.8px;color:var(--text3);margin-bottom:8px}
.detail-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.detail-field{background:var(--surf2);border:1px solid var(--border);border-radius:var(--r-sm);padding:10px 12px}
.detail-field-label{font-size:10px;color:var(--text3);font-weight:600;text-transform:uppercase;letter-spacing:.4px}
.detail-field-value{font-size:13px;font-weight:700;color:var(--text);margin-top:2px}
.broker-card{background:var(--surf2);border:1px solid var(--border);border-radius:var(--r-sm);padding:12px;display:flex;align-items:center;justify-content:space-between}
.broker-info .bname{font-weight:700;font-size:13px;color:var(--text)}
.broker-info .bloc{font-size:11px;color:var(--text3)}
.cx-score-big{font-size:16px;font-weight:800;padding:4px 10px;border-radius:8px}
.broker-warning{background:var(--red-bg);border:1px solid rgba(220,38,38,0.2);border-radius:var(--r-sm);padding:10px 12px;font-size:12px;color:var(--red);font-weight:600;margin-top:8px}
.broker-good{background:var(--green-bg);border:1px solid rgba(22,163,74,0.2);border-radius:var(--r-sm);padding:10px 12px;font-size:12px;color:var(--green);font-weight:600;margin-top:8px}

/* NEGOTIATION */
.nego-panel{border-top:2px solid var(--border);padding:16px 20px;background:var(--surf2)}
.nego-title{font-family:'Syne',sans-serif;font-weight:800;font-size:13px;color:var(--navy);margin-bottom:4px}
.nego-sub{font-size:11px;color:var(--text3);margin-bottom:12px}
.nego-offer{background:#fff;border:1px solid var(--border);border-radius:var(--r-sm);padding:12px;margin-bottom:10px}
.nego-offer-label{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:var(--text3);margin-bottom:4px}
.nego-offer-amount{font-family:'Syne',sans-serif;font-size:22px;font-weight:800;color:var(--navy)}
.nego-input-row{display:flex;gap:8px;margin-bottom:8px}
.nego-input{flex:1;background:#fff;border:2px solid var(--border);border-radius:var(--r-sm);padding:10px 12px;font-size:15px;font-weight:700;color:var(--navy);font-family:'JetBrains Mono',monospace;outline:none}
.nego-input:focus{border-color:var(--orange)}
.nego-btn{background:linear-gradient(135deg,var(--orange),var(--og-dk));color:#fff;border:none;border-radius:var(--r-sm);padding:10px 16px;font-size:13px;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif;white-space:nowrap;transition:all .2s}
.nego-btn:hover{filter:brightness(1.08);transform:translateY(-1px)}
.nego-btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}
.nego-rounds{font-size:11px;color:var(--text3);text-align:center;margin-bottom:10px}
.nego-history{max-height:140px;overflow-y:auto;display:flex;flex-direction:column;gap:6px;margin-bottom:10px}
.nego-msg{padding:8px 12px;border-radius:var(--r-sm);font-size:12px;font-weight:600;line-height:1.4}
.nego-msg.dispatcher{background:rgba(43,43,168,0.08);color:var(--navy);text-align:right}
.nego-msg.broker{background:rgba(244,121,32,0.08);color:#c45e10;border-left:3px solid var(--orange)}
.nego-msg.system{background:var(--surf2);color:var(--text3);text-align:center;font-style:italic}
.nego-result{padding:12px;border-radius:var(--r-sm);font-size:13px;font-weight:700;margin-bottom:10px;text-align:center}
.nego-result.win{background:var(--green-bg);color:var(--green);border:1px solid rgba(22,163,74,0.3)}
.nego-result.lose{background:var(--red-bg);color:var(--red);border:1px solid rgba(220,38,38,0.3)}
.nego-result.partial{background:var(--amber-bg);color:var(--amber);border:1px solid rgba(217,119,6,0.3)}
.book-btn{width:100%;background:linear-gradient(135deg,var(--green),#15803d);color:#fff;border:none;border-radius:var(--r-sm);padding:13px;font-size:14px;font-weight:800;cursor:pointer;font-family:'Syne',sans-serif;letter-spacing:.3px;transition:all .2s;display:none}
.book-btn:hover{filter:brightness(1.08);transform:translateY(-1px)}
.book-btn.show{display:block}

/* BOOKING MODAL */
.modal-overlay{position:fixed;inset:0;background:rgba(26,26,94,0.5);backdrop-filter:blur(4px);z-index:500;display:none;align-items:center;justify-content:center;padding:20px}
.modal-overlay.show{display:flex}
.modal{background:var(--surface);border-radius:16px;width:100%;max-width:560px;max-height:90vh;overflow-y:auto;box-shadow:var(--sh-lg)}
.modal-header{background:linear-gradient(135deg,var(--navy),var(--navy2));padding:20px 24px;border-radius:16px 16px 0 0;display:flex;align-items:center;justify-content:space-between}
.modal-title{font-family:'Syne',sans-serif;font-weight:800;font-size:17px;color:#fff}
.modal-close{background:rgba(255,255,255,0.15);border:none;color:#fff;width:30px;height:30px;border-radius:50%;cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center}
.modal-body{padding:24px}
.modal-section{margin-bottom:20px}
.modal-section-title{font-size:11px;font-weight:800;text-transform:uppercase;letter-spacing:.8px;color:var(--text3);margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid var(--border)}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px}
.form-group{margin-bottom:10px}
.form-label{font-size:11px;font-weight:700;color:var(--text2);margin-bottom:4px;display:block}
.form-input{width:100%;background:var(--surf2);border:1.5px solid var(--border);border-radius:var(--r-sm);padding:9px 12px;font-size:13px;color:var(--text);font-family:'DM Sans',sans-serif;outline:none;transition:border-color .2s}
.form-input:focus{border-color:var(--navy)}
.driver-select{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:10px}
.driver-option{padding:10px;border:2px solid var(--border);border-radius:var(--r-sm);cursor:pointer;transition:all .2s;background:#fff}
.driver-option:hover{border-color:var(--navy);background:rgba(43,43,168,0.04)}
.driver-option.selected{border-color:var(--orange);background:rgba(244,121,32,0.06)}
.driver-name{font-weight:700;font-size:13px;color:var(--text)}
.driver-vehicle{font-size:11px;color:var(--text3)}
.driver-location{font-size:10px;color:var(--text3);margin-top:2px}
.modal-footer{padding:16px 24px;border-top:1px solid var(--border);display:flex;gap:10px;justify-content:flex-end}
.btn-cancel{background:transparent;border:1.5px solid var(--border);color:var(--text2);padding:10px 20px;border-radius:var(--r-sm);cursor:pointer;font-size:13px;font-weight:600;font-family:'DM Sans',sans-serif}
.btn-confirm{background:linear-gradient(135deg,var(--green),#15803d);color:#fff;border:none;padding:10px 24px;border-radius:var(--r-sm);cursor:pointer;font-size:13px;font-weight:800;font-family:'Syne',sans-serif}

/* CONSIGNMENT NOTE MODAL */
.cn-modal{max-width:680px}
.cn-header-branded{background:linear-gradient(135deg,var(--navy),var(--navy2));padding:24px;text-align:center;border-radius:16px 16px 0 0}
.cn-logo-text{font-family:'Syne',sans-serif;font-weight:800;font-size:22px;color:#fff;letter-spacing:1px}
.cn-doc-title{font-size:13px;color:rgba(255,255,255,0.8);letter-spacing:3px;text-transform:uppercase;margin-top:4px}
.cn-ref{background:var(--orange);color:#fff;display:inline-block;padding:4px 12px;border-radius:6px;font-family:'JetBrains Mono',monospace;font-size:12px;font-weight:700;margin-top:8px}
.cn-body{padding:24px}
.cn-grid{display:grid;grid-template-columns:1fr 1fr;gap:0;border:1px solid rgba(43,43,168,0.2);border-radius:var(--r-sm);overflow:hidden;margin-bottom:16px}
.cn-field{padding:10px 14px;border-bottom:1px solid rgba(43,43,168,0.1)}
.cn-field:nth-child(odd){border-right:1px solid rgba(43,43,168,0.1)}
.cn-field-label{font-size:9px;font-weight:800;text-transform:uppercase;letter-spacing:.6px;color:var(--text3);margin-bottom:3px}
.cn-field-value{font-size:13px;font-weight:600;color:var(--text)}
.cn-full{grid-column:1/-1}
.cn-stamp{display:flex;gap:16px;justify-content:space-between;margin-top:16px}
.cn-stamp-box{flex:1;border:2px solid var(--border);border-radius:var(--r-sm);padding:16px;text-align:center}
.cn-stamp-label{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:var(--text3);margin-bottom:24px}
.cn-stamp-line{border-top:1px solid var(--border);margin-top:8px;padding-top:6px;font-size:10px;color:var(--text3)}
.cn-footer{background:var(--surf2);border-top:1px solid var(--border);padding:14px 24px;display:flex;gap:10px;justify-content:flex-end;border-radius:0 0 16px 16px}
.btn-print{background:linear-gradient(135deg,var(--navy),var(--navy2));color:#fff;border:none;padding:10px 20px;border-radius:var(--r-sm);cursor:pointer;font-size:13px;font-weight:700;font-family:'DM Sans',sans-serif}
.btn-new{background:linear-gradient(135deg,var(--orange),var(--og-dk));color:#fff;border:none;padding:10px 20px;border-radius:var(--r-sm);cursor:pointer;font-size:13px;font-weight:700;font-family:'DM Sans',sans-serif}

/* SCORE TOAST */
.score-toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%);background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:14px 24px;box-shadow:var(--sh-lg);z-index:600;display:none;align-items:center;gap:12px;min-width:300px}
.score-toast.show{display:flex;animation:slideUp .3s ease}
@keyframes slideUp{from{transform:translateX(-50%) translateY(20px);opacity:0}to{transform:translateX(-50%) translateY(0);opacity:1}}
.score-emoji{font-size:24px}
.score-text .score-title{font-family:'Syne',sans-serif;font-weight:800;font-size:14px;color:var(--navy)}
.score-text .score-xp{font-size:12px;color:var(--orange);font-weight:700}

/* EMPTY STATE */
.no-loads{padding:40px;text-align:center;color:var(--text3);font-size:13px}

/* SESSION STATS */
.session-bar{grid-column:1/-1;background:linear-gradient(135deg,var(--navy),var(--navy2));border-radius:var(--r);padding:16px 20px;display:flex;align-items:center;gap:20px;flex-wrap:wrap}
.session-bar .s-title{font-family:'Syne',sans-serif;font-weight:800;font-size:14px;color:#fff;flex-shrink:0}
.session-stat{display:flex;align-items:center;gap:8px}
.session-stat .sv{font-family:'Syne',sans-serif;font-weight:800;font-size:18px;color:#fff}
.session-stat .sl{font-size:11px;color:rgba(255,255,255,0.7)}
.session-sep{width:1px;height:30px;background:rgba(255,255,255,0.15)}
.xp-pill{margin-left:auto;background:var(--orange);color:#fff;font-family:'Syne',sans-serif;font-weight:800;font-size:14px;padding:6px 16px;border-radius:20px}
</style>
</head>
<body>

<!-- HEADER -->
<header class="ex-header">
  <div class="ex-header-inner">
    <a href="index.html" class="ex-logo">
      <div class="ex-logo-icon">ğŸ¦…</div>
      <div class="ex-logo-text">
        <div class="name">EAGLE EXCHANGE</div>
        <div class="sub">UK Load Board Simulator</div>
      </div>
    </a>
    <span class="ex-badge">TRAINING MODE</span>
    <div class="ex-nav-back">
      <div class="live-clock">
        <span class="uk-label">UK </span><span id="uk-time">--:--</span>
        &nbsp;|&nbsp;
        <span class="uk-label">IST </span><span id="ist-time">--:--</span>
      </div>
      <a href="tools.html">â† Tools</a>
      <a href="week1.html">Week 1</a>
    </div>
  </div>
</header>

<!-- TICKER -->
<div class="ex-ticker">
  <div class="ex-ticker-inner">
    <span><span class="dot">â—</span> Courier Exchange (CX) â€” UK's real load board. This simulator trains you for the real thing.</span>
    <span><span class="dot">â—</span> Always check CX Credit Rating before booking â€” never accept below 70</span>
    <span><span class="dot">â—</span> UK CPM target: Â£1.80â€“Â£3.00 per mile depending on vehicle type</span>
    <span><span class="dot">â—</span> O-Licence check: vehicle-operator-licensing.service.gov.uk â€” verify every new carrier</span>
    <span><span class="dot">â—</span> UK business hours: 09:00â€“17:30 GMT = 14:30â€“23:00 IST â€” your Xeagle shift</span>
    <span><span class="dot">â—</span> Courier Exchange (CX) â€” UK's real load board. This simulator trains you for the real thing.</span>
    <span><span class="dot">â—</span> Always check CX Credit Rating before booking â€” never accept below 70</span>
    <span><span class="dot">â—</span> UK CPM target: Â£1.80â€“Â£3.00 per mile depending on vehicle type</span>
    <span><span class="dot">â—</span> O-Licence check: vehicle-operator-licensing.service.gov.uk â€” verify every new carrier</span>
    <span><span class="dot">â—</span> UK business hours: 09:00â€“17:30 GMT = 14:30â€“23:00 IST â€” your Xeagle shift</span>
  </div>
</div>

<div style="max-width:1400px;margin:0 auto;padding:16px 20px 0">
  <!-- SESSION STATS BAR -->
  <div class="session-bar" id="session-bar">
    <span class="s-title">ğŸ¦… Today's Session</span>
    <div class="session-sep"></div>
    <div class="session-stat"><span class="sv" id="s-booked">0</span><span class="sl">Loads Booked</span></div>
    <div class="session-sep"></div>
    <div class="session-stat"><span class="sv" id="s-revenue">Â£0</span><span class="sl">Revenue Secured</span></div>
    <div class="session-sep"></div>
    <div class="session-stat"><span class="sv" id="s-fee">Â£0</span><span class="sl">Xeagle Fee (8%)</span></div>
    <div class="session-sep"></div>
    <div class="session-stat"><span class="sv" id="s-best">â€”</span><span class="sl">Best Negotiation</span></div>
    <div class="session-sep"></div>
    <div class="session-stat"><span class="sv" id="s-grade">â€”</span><span class="sl">Grade</span></div>
    <div class="xp-pill">âš¡ <span id="s-xp">0</span> XP</div>
  </div>
</div>

<!-- MAIN LAYOUT -->
<div class="ex-wrap">
  <!-- STATS CARDS -->
  <div class="stats-bar">
    <div class="stat-card">
      <div class="stat-icon" style="background:rgba(43,43,168,0.10)">ğŸšš</div>
      <div><div class="stat-val" id="st-available">15</div><div class="stat-lbl">Loads Available</div></div>
    </div>
    <div class="stat-card">
      <div class="stat-icon" style="background:rgba(220,38,38,0.10)">ğŸ”´</div>
      <div><div class="stat-val" id="st-urgent">3</div><div class="stat-lbl">Urgent Loads</div></div>
    </div>
    <div class="stat-card">
      <div class="stat-icon" style="background:rgba(22,163,74,0.10)">âœ…</div>
      <div><div class="stat-val" id="st-booked">0</div><div class="stat-lbl">You've Booked</div></div>
    </div>
    <div class="stat-card">
      <div class="stat-icon" style="background:rgba(244,121,32,0.10)">ğŸ’·</div>
      <div><div class="stat-val" id="st-xp">0</div><div class="stat-lbl">XP Earned</div></div>
    </div>
  </div>

  <!-- LOAD BOARD -->
  <div class="board-panel">
    <div class="board-header">
      <div>
        <div class="board-title">ğŸ¦… Eagle Exchange â€” Live UK Loads</div>
        <div class="board-subtitle">Click any load to view details and negotiate</div>
      </div>
      <button class="board-refresh" onclick="refreshLoads()">â†» Refresh</button>
    </div>
    <div class="board-filters">
      <select class="filter-select" id="filter-vehicle" onchange="applyFilters()">
        <option value="">All Vehicles</option>
        <option value="Curtainsider">Curtainsider</option>
        <option value="Box Van">Box Van</option>
        <option value="Flatbed">Flatbed</option>
        <option value="Refrigerated">Refrigerated</option>
        <option value="Tanker">Tanker</option>
        <option value="Low Loader">Low Loader</option>
      </select>
      <select class="filter-select" id="filter-region" onchange="applyFilters()">
        <option value="">All Regions</option>
        <option value="London">London</option>
        <option value="Midlands">Midlands</option>
        <option value="North">North England</option>
        <option value="Scotland">Scotland</option>
        <option value="South West">South West</option>
        <option value="Wales">Wales</option>
      </select>
      <select class="filter-select" id="filter-sort" onchange="applyFilters()">
        <option value="time">Sort: Collection Time</option>
        <option value="rate-high">Sort: Rate (Highâ†’Low)</option>
        <option value="rate-low">Sort: Rate (Lowâ†’High)</option>
        <option value="cpm">Sort: CPM (Best)</option>
        <option value="distance">Sort: Distance</option>
      </select>
      <input class="filter-search" id="filter-search" placeholder="Search city, vehicleâ€¦" oninput="applyFilters()"/>
      <span class="filter-count" id="filter-count">15 loads</span>
    </div>
    <div class="load-list" id="load-list"></div>
  </div>

  <!-- DETAIL PANEL -->
  <div class="detail-panel" id="detail-panel">
    <div class="detail-empty" id="detail-empty">
      <div class="big-icon">ğŸš›</div>
      <p><strong>Select a load from the board</strong><br/>to view full details and start negotiating</p>
      <br/>
      <p style="font-size:11px;color:var(--text3)">ğŸ’¡ Tip: Check the CX Rating before you negotiate.<br/>Below 70 = walk away!</p>
    </div>
    <div id="detail-content" style="display:none"></div>
  </div>
</div>

<!-- BOOKING MODAL -->
<div class="modal-overlay" id="booking-modal">
  <div class="modal">
    <div class="modal-header">
      <span class="modal-title">ğŸ“‹ Book This Load</span>
      <button class="modal-close" onclick="closeModal('booking-modal')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="modal-section">
        <div class="modal-section-title">Load Details</div>
        <div id="modal-load-summary" style="background:var(--surf2);border:1px solid var(--border);border-radius:var(--r-sm);padding:12px;font-size:13px;color:var(--text);font-weight:600"></div>
      </div>
      <div class="modal-section">
        <div class="modal-section-title">Select Driver</div>
        <div class="driver-select" id="driver-select">
          <!-- populated by JS -->
        </div>
      </div>
      <div class="modal-section">
        <div class="modal-section-title">Collection Details</div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Collection Address</label>
            <input class="form-input" id="f-collection" placeholder="e.g. Unit 4, Birmingham Business Park"/>
          </div>
          <div class="form-group">
            <label class="form-label">Collection Contact</label>
            <input class="form-input" id="f-col-contact" placeholder="e.g. Dave â€” 07700 900123"/>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Delivery Address</label>
            <input class="form-input" id="f-delivery" placeholder="e.g. Glasgow Distribution Centre"/>
          </div>
          <div class="form-group">
            <label class="form-label">Delivery Contact</label>
            <input class="form-input" id="f-del-contact" placeholder="e.g. Sandra â€” 07700 900456"/>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Special Instructions</label>
          <input class="form-input" id="f-instructions" placeholder="e.g. Tail-lift required, call 30 mins before arrival"/>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-cancel" onclick="closeModal('booking-modal')">Cancel</button>
      <button class="btn-confirm" onclick="confirmBooking()">âœ… Confirm Booking & Generate Consignment Note</button>
    </div>
  </div>
</div>

<!-- CONSIGNMENT NOTE MODAL -->
<div class="modal-overlay" id="cn-modal">
  <div class="modal cn-modal">
    <div class="cn-header-branded">
      <div class="cn-logo-text">EAGLE EXCHANGE</div>
      <div class="cn-doc-title">UK Consignment Note</div>
      <div class="cn-ref" id="cn-ref">EX-000000</div>
    </div>
    <div class="cn-body" id="cn-body"><!-- populated by JS --></div>
    <div class="cn-footer">
      <button class="btn-cancel" onclick="closeModal('cn-modal')">Close</button>
      <button class="btn-print" onclick="printCN()">ğŸ–¨ï¸ Print Note</button>
      <button class="btn-new" onclick="closeModal('cn-modal');refreshLoads()">ğŸ“¦ Find Next Load</button>
    </div>
  </div>
</div>

<!-- SCORE TOAST -->
<div class="score-toast" id="score-toast">
  <div class="score-emoji" id="toast-emoji">ğŸ‰</div>
  <div class="score-text">
    <div class="score-title" id="toast-title">Great negotiation!</div>
    <div class="score-xp" id="toast-xp">+120 XP earned</div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  EAGLE EXCHANGE â€” LOAD BOARD ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// LIVE CLOCK
function updateClock(){
  const now = new Date();
  // UK time (GMT, simplified)
  const ukOffset = 0; // GMT, adjust for BST in summer
  const uk = new Date(now.getTime() + (ukOffset * 60 - now.getTimezoneOffset()) * 60000);
  const ist = new Date(now.getTime() + (330 - now.getTimezoneOffset()) * 60000);
  const fmt = d => d.getHours().toString().padStart(2,'0') + ':' + d.getMinutes().toString().padStart(2,'0');
  document.getElementById('uk-time').textContent = fmt(uk);
  document.getElementById('ist-time').textContent = fmt(ist);
}
updateClock(); setInterval(updateClock, 1000);

// SESSION STATE
let session = {
  booked: 0, revenue: 0, xp: 0,
  negoWins: 0, bestRateAbove: 0
};

function updateSessionBar(){
  document.getElementById('s-booked').textContent = session.booked;
  document.getElementById('s-revenue').textContent = 'Â£' + session.revenue.toLocaleString();
  document.getElementById('s-fee').textContent = 'Â£' + Math.round(session.revenue * 0.08).toLocaleString();
  document.getElementById('s-best').textContent = session.bestRateAbove > 0 ? '+Â£' + session.bestRateAbove + ' above offer' : 'â€”';
  document.getElementById('s-xp').textContent = session.xp;
  document.getElementById('st-booked').textContent = session.booked;
  document.getElementById('st-xp').textContent = session.xp;
  // Grade
  let grade = 'â€”';
  if(session.booked >= 1) grade = 'Rookie ğŸŸ¡';
  if(session.booked >= 3) grade = 'Dispatcher ğŸŸ¢';
  if(session.booked >= 5 && session.negoWins >= 2) grade = 'Pro â­';
  if(session.booked >= 7 && session.negoWins >= 4) grade = 'Senior ğŸ†';
  document.getElementById('s-grade').textContent = grade;
}

// LOAD DATA
const BROKERS = [
  {name:'Morris Freight Ltd', location:'Manchester', cx:92, type:'green'},
  {name:'Apex Logistics UK', location:'Birmingham', cx:87, type:'green'},
  {name:'TruckLine Solutions', location:'Leeds', cx:78, type:'green'},
  {name:'Northern Roads Ltd', location:'Newcastle', cx:74, type:'amber'},
  {name:'FastHaul UK', location:'Bristol', cx:85, type:'green'},
  {name:'Premier Transport', location:'London', cx:91, type:'green'},
  {name:'MidEx Freight', location:'Coventry', cx:65, type:'red'},
  {name:'Scottish Haulage Co', location:'Glasgow', cx:82, type:'green'},
  {name:'Southern Logistics', location:'Southampton', cx:68, type:'red'},
  {name:'AtoB Freight', location:'Sheffield', cx:79, type:'green'},
  {name:'Coastal Carriers', location:'Felixstowe', cx:88, type:'green'},
  {name:'Trans-UK Ltd', location:'Nottingham', cx:71, type:'amber'},
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BAAZ SAMEDAY RATE SHEET â€” REAL RATES
//  Source: Baaz Sameday Ltd, 10 Hill Street, Cleckheaton BD19 3NP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const VEHICLE_RATES = {
  'Small Van':              {capacity:'450kg',  pallets:1,  pallets_e:1,  min30:50,  min50:65,  pmLow:1.00, pmHigh:1.00, extraStop:10},
  'Short Wheelbase':        {capacity:'900kg',  pallets:1,  pallets_e:2,  min30:60,  min50:75,  pmLow:1.10, pmHigh:1.10, extraStop:10},
  'Mid Wheelbase':          {capacity:'700kg',  pallets:2,  pallets_e:2,  min30:65,  min50:80,  pmLow:1.20, pmHigh:1.20, extraStop:10},
  'Long Wheelbase':         {capacity:'1250kg', pallets:3,  pallets_e:3,  min30:70,  min50:85,  pmLow:1.30, pmHigh:1.30, extraStop:15},
  'Extra Long Wheelbase':   {capacity:'1000kg', pallets:4,  pallets_e:5,  min30:75,  min50:90,  pmLow:1.40, pmHigh:1.40, extraStop:15},
  'Luton Curtainside':      {capacity:'1000kg', pallets:6,  pallets_e:7,  min30:95,  min50:120, pmLow:1.60, pmHigh:1.60, extraStop:20},
  'Luton + Tail Lift':      {capacity:'1000kg', pallets:6,  pallets_e:7,  min30:100, min50:125, pmLow:1.75, pmHigh:1.75, extraStop:20},
  '7.5t Curtainside':       {capacity:'2500kg', pallets:10, pallets_e:12, min30:225, min50:275, pmLow:2.00, pmHigh:3.00, extraStop:30},
  '7.5t + Tail Lift':       {capacity:'2500kg', pallets:10, pallets_e:12, min30:250, min50:300, pmLow:2.25, pmHigh:3.25, extraStop:30},
  '12t Curtainside':        {capacity:'5850kg', pallets:14, pallets_e:16, min30:300, min50:350, pmLow:2.50, pmHigh:3.50, extraStop:40},
  '18t Curtainside':        {capacity:'9500kg', pallets:16, pallets_e:18, min30:350, min50:425, pmLow:2.75, pmHigh:3.75, extraStop:40},
  '26t Curtainside':        {capacity:'15000kg',pallets:18, pallets_e:20, min30:385, min50:450, pmLow:3.00, pmHigh:4.00, extraStop:40},
  'Artic Curtainside':      {capacity:'26000kg',pallets:26, pallets_e:30, min30:445, min50:495, pmLow:3.25, pmHigh:4.25, extraStop:60},
};

// Calculate min, market and target rates from real Baaz sheet
function calcRates(vehicle, miles){
  const r = VEHICLE_RATES[vehicle];
  if(!r) return {min:500, market:700, target:900};
  let minRate, marketRate, targetRate;
  if(miles <= 30){
    minRate = r.min30;
    marketRate = Math.round(r.min30 * 1.15);
    targetRate = Math.round(r.min30 * 1.30);
  } else if(miles <= 50){
    minRate = r.min50;
    marketRate = Math.round(r.min50 * 1.15);
    targetRate = Math.round(r.min50 * 1.25);
  } else {
    const extra = miles - 50;
    minRate = Math.round(r.min50 + extra * r.pmLow);
    marketRate = Math.round(r.min50 + extra * ((r.pmLow + r.pmHigh) / 2));
    targetRate = Math.round(r.min50 + extra * r.pmHigh);
  }
  return {min:minRate, market:marketRate, target:targetRate};
}

// Score 0-100: how well did student negotiate vs real rate sheet?
function calcNegoScore(vehicle, miles, negotiated){
  const {min, market, target} = calcRates(vehicle, miles);
  if(negotiated <= min) return {score:Math.max(0,Math.round((negotiated/min)*30)), band:'poor'};
  if(negotiated >= target) return {score:100, band:'excellent'};
  if(negotiated >= market){
    return {score:Math.round(60 + ((negotiated-market)/(target-market))*40), band:'good'};
  }
  return {score:Math.round(30 + ((negotiated-min)/(market-min))*30), band:'ok'};
}

// All loads â€” vehicles & rates from real Baaz Sameday sheet
const ALL_LOADS = [
  {id:'EX001',from:'Birmingham',fromRegion:'Midlands',to:'Glasgow',    miles:305,vehicle:'26t Curtainside',  weight:'15,000kg',pallets:'18 std / 20 euro',goods:'Automotive Parts',      col:'08:00',del:'18:00',urgent:false,broker:0, notes:'Strapping required. Tail-lift NOT needed. Direct delivery.'},
  {id:'EX002',from:'London',    fromRegion:'London',  to:'Manchester',  miles:212,vehicle:'18t Curtainside',  weight:'9,500kg', pallets:'16 std / 18 euro',goods:'Fresh Produce (Chilled)',col:'06:30',del:'12:00',urgent:true, broker:1, notes:'Temp sensitive â€” keep doors closed. Delivery by 12:00 hard deadline.'},
  {id:'EX003',from:'Bristol',   fromRegion:'South West',to:'Leeds',     miles:208,vehicle:'7.5t Curtainside', weight:'2,500kg', pallets:'10 std / 12 euro',goods:'Retail Clothing',         col:'09:00',del:'16:00',urgent:false,broker:2, notes:'2 drop points in Leeds. Extra stop charge applies.'},
  {id:'EX004',from:'Manchester',fromRegion:'North',   to:'Southampton', miles:247,vehicle:'26t Curtainside',  weight:'15,000kg',pallets:'18 std / 20 euro',goods:'Steel Coils',             col:'07:00',del:'15:30',urgent:false,broker:5, notes:'Coil bolsters required. Strapping to be checked at loading.'},
  {id:'EX005',from:'Leeds',     fromRegion:'North',   to:'London',      miles:204,vehicle:'18t Curtainside',  weight:'9,500kg', pallets:'16 std / 18 euro',goods:'Dairy Products',          col:'05:00',del:'11:00',urgent:true, broker:0, notes:'URGENT â€” Dock 7 only. Driver must be on site by 11:00.'},
  {id:'EX006',from:'Glasgow',   fromRegion:'Scotland',to:'Birmingham',  miles:303,vehicle:'26t Curtainside',  weight:'15,000kg',pallets:'18 std / 20 euro',goods:'Whisky Barrels',          col:'10:00',del:'20:00',urgent:false,broker:7, notes:'Fragile â€” max 2 straps per barrel. Very careful loading required.'},
  {id:'EX007',from:'London',    fromRegion:'London',  to:'Edinburgh',   miles:414,vehicle:'12t Curtainside',  weight:'5,850kg', pallets:'14 std / 16 euro',goods:'Construction Equipment',  col:'07:30',del:'18:00',urgent:false,broker:5, notes:'Oversized item. Check height restrictions M1/M6.'},
  {id:'EX008',from:'Cardiff',   fromRegion:'Wales',   to:'Sheffield',   miles:178,vehicle:'7.5t + Tail Lift', weight:'2,500kg', pallets:'10 std / 12 euro',goods:'Electrical Components',   col:'09:30',del:'15:00',urgent:false,broker:2, notes:'Tail lift and pump truck required at delivery.'},
  {id:'EX009',from:'Newcastle', fromRegion:'North',   to:'Bristol',     miles:308,vehicle:'26t Curtainside',  weight:'15,000kg',pallets:'18 std / 20 euro',goods:'FMCG Goods',              col:'06:00',del:'17:00',urgent:false,broker:6, notes:'âš ï¸ CHECK CX RATING â€” broker has flagged payment history.'},
  {id:'EX010',from:'Southampton',fromRegion:'South West',to:'Glasgow',  miles:448,vehicle:'Artic Curtainside',weight:'26,000kg',pallets:'26 std / 30 euro',goods:'Port Freight (Seafood)',  col:'04:00',del:'14:00',urgent:true, broker:4, notes:'Urgent â€” vessel just docked. Temperature: 0-2Â°C. Time critical.'},
  {id:'EX011',from:'Birmingham',fromRegion:'Midlands',to:'Edinburgh',   miles:320,vehicle:'Artic Curtainside',weight:'26,000kg',pallets:'26 std / 30 euro',goods:'Retail Distribution',     col:'08:30',del:'19:00',urgent:false,broker:1, notes:'Full artic. Loading bay clearance required at Edinburgh depot.'},
  {id:'EX012',from:'Liverpool', fromRegion:'North',   to:'London',      miles:218,vehicle:'18t Curtainside',  weight:'9,500kg', pallets:'16 std / 18 euro',goods:'Retail Products',         col:'11:00',del:'19:30',urgent:false,broker:9, notes:''},
  {id:'EX013',from:'Manchester',fromRegion:'North',   to:'Cardiff',     miles:198,vehicle:'Luton + Tail Lift',weight:'1,000kg', pallets:'6 std / 7 euro',  goods:'Medical Supplies',        col:'08:00',del:'13:00',urgent:false,broker:0, notes:'White glove handling. Tail lift mandatory. Sign for each item.'},
  {id:'EX014',from:'Felixstowe',fromRegion:'London',  to:'Birmingham',  miles:148,vehicle:'12t Curtainside',  weight:'5,850kg', pallets:'14 std / 16 euro',goods:'Port Containers',         col:'10:30',del:'16:00',urgent:false,broker:10,notes:'Driver must have valid port DCSA card. Booking ref required at gate.'},
  {id:'EX015',from:'Bristol',   fromRegion:'South West',to:'Glasgow',   miles:383,vehicle:'Artic Curtainside',weight:'26,000kg',pallets:'26 std / 30 euro',goods:'Agricultural Machinery',  col:'07:00',del:'20:00',urgent:false,broker:8, notes:'âš ï¸ POOR CX RATING â€” verify payment terms before accepting this load.'},
];

// Mark booked loads
let bookedIds = JSON.parse(localStorage.getItem('ex_booked') || '[]');
let currentLoad = null;
let negoState = null;
let negotiatedRate = null;
let selectedDriver = null;

function getCPM(load){
  const rates = calcRates(load.vehicle, load.miles);
  const market = rates.market;
  return (market / load.miles).toFixed(2);
}
function getOfferedRate(load){
  // Broker offers minimum rate â€” student must negotiate up
  return calcRates(load.vehicle, load.miles).min;
}
function getCXClass(score){ if(score>=80)return 'cx-green'; if(score>=70)return 'cx-amber'; return 'cx-red'; }
function getCXBig(score){ if(score>=80)return 'cx-green'; if(score>=70)return 'cx-amber'; return 'cx-red'; }

// RENDER LOAD LIST
let filteredLoads = [...ALL_LOADS];

function applyFilters(){
  const v = document.getElementById('filter-vehicle').value;
  const r = document.getElementById('filter-region').value;
  const s = document.getElementById('filter-sort').value;
  const q = document.getElementById('filter-search').value.toLowerCase();

  filteredLoads = ALL_LOADS.filter(l => {
    if(v && l.vehicle !== v) return false;
    if(r && l.fromRegion !== r) return false;
    if(q && !l.from.toLowerCase().includes(q) && !l.to.toLowerCase().includes(q) && !l.vehicle.toLowerCase().includes(q)) return false;
    return true;
  });

  if(s==='rate-high') filteredLoads.sort((a,b)=>calcRates(b.vehicle,b.miles).min-calcRates(a.vehicle,a.miles).min);
  else if(s==='rate-low') filteredLoads.sort((a,b)=>calcRates(a.vehicle,a.miles).min-calcRates(b.vehicle,b.miles).min);
  else if(s==='cpm') filteredLoads.sort((a,b)=>(calcRates(b.vehicle,b.miles).market/b.miles)-(calcRates(a.vehicle,a.miles).market/a.miles));
  else if(s==='distance') filteredLoads.sort((a,b)=>b.miles-a.miles);
  else filteredLoads.sort((a,b)=>a.col.localeCompare(b.col));

  document.getElementById('filter-count').textContent = filteredLoads.length + ' load' + (filteredLoads.length!==1?'s':'');
  renderLoadList();
}

function renderLoadList(){
  const list = document.getElementById('load-list');
  if(!filteredLoads.length){
    list.innerHTML = '<div class="no-loads">No loads match your filters.<br/>Try adjusting or clearing filters.</div>';
    return;
  }

  list.innerHTML = filteredLoads.map(l => {
    const b = BROKERS[l.broker];
    const rates = calcRates(l.vehicle, l.miles);
    const offered = rates.min;
    const cpm = (rates.market / l.miles).toFixed(2);
    const isBooked = bookedIds.includes(l.id);
    const isSelected = currentLoad && currentLoad.id === l.id;
    const cpmNum = parseFloat(cpm);
    const cpmColor = cpmNum >= 2.50 ? 'color:var(--green)' : cpmNum >= 1.80 ? 'color:var(--amber)' : 'color:var(--red)';

    return `
    <div class="load-item ${l.urgent?'urgent':''} ${isSelected?'selected':''} ${isBooked?'booked':''}"
         onclick="${isBooked?'':("selectLoad('"+l.id+"')")}"
         id="li-${l.id}">
      ${isBooked ? '<div class="load-booked-badge">âœ… Booked</div>' : ''}
      <div class="load-route">
        <span class="load-city">${l.from}</span>
        <span class="load-arrow">â†’</span>
        <span class="load-city">${l.to}</span>
      </div>
      <div class="load-meta">
        <span class="load-tag lt-vehicle">ğŸšš ${l.vehicle}</span>
        <span class="load-tag lt-weight">âš–ï¸ ${l.weight}</span>
        <span class="load-tag lt-distance">ğŸ“ ${l.miles} mi</span>
        <span class="load-tag lt-collection">ğŸ• Col: ${l.col}</span>
      </div>
      <div class="load-bottom">
        <div>
          <div class="load-rate">Â£${offered.toLocaleString()}</div>
          <div class="load-cpm" style="${cpmColor}">Â£${cpm}/mi CPM</div>
        </div>
        <div class="load-broker">
          <div>
            <div class="broker-name">${b.name}</div>
            <div style="text-align:right;margin-top:2px">
              <span class="cx-score ${getCXClass(b.cx)}">CX: ${b.cx}</span>
            </div>
          </div>
        </div>
      </div>
    </div>`;
  }).join('');
}

function selectLoad(id){
  currentLoad = ALL_LOADS.find(l=>l.id===id);
  if(!currentLoad) return;
  negoState = null;
  negotiatedRate = null;
  selectedDriver = null;
  document.querySelectorAll('.load-item').forEach(el=>el.classList.remove('selected'));
  const el = document.getElementById('li-'+id);
  if(el) el.classList.add('selected');
  renderDetail();
}

function renderDetail(){
  const l = currentLoad;
  const b = BROKERS[l.broker];
  const rates = calcRates(l.vehicle, l.miles);
    const offered = rates.min;
    const cpm = (rates.market / l.miles).toFixed(2);
  const cpmNum = parseFloat(cpm);
  const cpmColor = cpmNum >= 2.50 ? 'var(--green)' : cpmNum >= 1.80 ? 'var(--amber)' : 'var(--red)';

  document.getElementById('detail-empty').style.display = 'none';
  document.getElementById('detail-content').style.display = 'block';

  const hasWarning = b.cx < 70;
  const isBooked = bookedIds.includes(l.id);

  document.getElementById('detail-content').innerHTML = `
    <div class="detail-header">
      <div class="detail-route">
        <span class="detail-city">${l.from}</span>
        <span class="detail-arrow">â†’</span>
        <span class="detail-city">${l.to}</span>
      </div>
      <div class="detail-rate-big">Â£${offeredRate.toLocaleString()}</div>
      <div class="detail-cpm-big" style="color:${cpmColor}">Market: Â£${cpm}/mi Â· ${l.miles} miles</div>
      ${l.urgent ? '<div class="detail-urgency">âš¡ URGENT LOAD</div>' : ''}
    </div>
    <div class="detail-body">
      <div class="detail-section">
        <div class="detail-section-title">Load Information</div>
        <div class="detail-grid">
          <div class="detail-field"><div class="detail-field-label">Vehicle Required</div><div class="detail-field-value">ğŸšš ${l.vehicle}</div></div>
          <div class="detail-field"><div class="detail-field-label">Max Weight</div><div class="detail-field-value">âš–ï¸ ${l.weight}</div></div>
          <div class="detail-field"><div class="detail-field-label">Goods Type</div><div class="detail-field-value">ğŸ“¦ ${l.goods}</div></div>
          <div class="detail-field"><div class="detail-field-label">Distance</div><div class="detail-field-value">ğŸ“ ${l.miles} miles</div></div>
          <div class="detail-field"><div class="detail-field-label">Collection Time</div><div class="detail-field-value">ğŸ• ${l.col} today</div></div>
          <div class="detail-field"><div class="detail-field-label">Delivery By</div><div class="detail-field-value">ğŸ¯ ${l.del} today</div></div>
        </div>
        ${l.notes ? `<div style="background:rgba(244,121,32,0.06);border-left:3px solid var(--orange);padding:10px 12px;border-radius:0 var(--r-sm) var(--r-sm) 0;margin-top:8px;font-size:12px;color:var(--text2)"><strong>ğŸ“‹ Notes:</strong> ${l.notes}</div>` : ''}
      </div>
      <div class="detail-section">
        <div class="detail-section-title">Load Poster (Broker)</div>
        <div class="broker-card">
          <div class="broker-info">
            <div class="bname">${b.name}</div>
            <div class="bloc">ğŸ“ ${b.location}</div>
          </div>
          <span class="cx-score-big ${getCXBig(b.cx)}">CX: ${b.cx}</span>
        </div>
        ${hasWarning ?
          '<div class="broker-warning">âš ï¸ CX Rating below 70 â€” HIGH RISK. This broker has poor payment history. Instructor: discuss whether to proceed and why.</div>' :
          '<div class="broker-good">âœ… CX Rating above 70 â€” Safe to negotiate</div>'
        }
      </div>
    </div>
    <div class="nego-panel" id="nego-section">
      ${isBooked ? '<div class="nego-result win">âœ… Already booked â€” find your next load!</div>' : renderNegoPanel()}
    </div>`;
}

function renderNegoPanel(state){
  const l = currentLoad;
  const rates = calcRates(l.vehicle, l.miles);
  const offered = rates.min;
  const currentOffer = state ? state.currentOffer : offered;
  const roundsLeft = state ? state.roundsLeft : 3;
  const disabled = roundsLeft <= 0 || (state && state.done);
  const vr = VEHICLE_RATES[l.vehicle] || {};

  // Score circle for current negotiated rate
  const scoreData = negotiatedRate ? calcNegoScore(l.vehicle, l.miles, negotiatedRate) :
                    (state && state.currentOffer ? calcNegoScore(l.vehicle, l.miles, state.currentOffer) : null);
  const score = scoreData ? scoreData.score : null;
  const scoreBand = scoreData ? scoreData.band : null;
  const scoreColor = scoreBand==='excellent'?'#16a34a':scoreBand==='good'?'#2B2BA8':scoreBand==='ok'?'#d97706':'#dc2626';
  const circumference = 2 * Math.PI * 36; // r=36
  const fillAmount = score !== null ? circumference * (1 - score/100) : circumference;

  const scoreCircleHTML = `
    <div style="display:flex;align-items:center;justify-content:center;margin-bottom:12px">
      <div style="position:relative;width:88px;height:88px;flex-shrink:0">
        <svg width="88" height="88" viewBox="0 0 88 88">
          <circle cx="44" cy="44" r="36" fill="none" stroke="rgba(43,43,168,0.1)" stroke-width="8"/>
          <circle cx="44" cy="44" r="36" fill="none" stroke="${scoreColor}" stroke-width="8"
            stroke-dasharray="${circumference}" stroke-dashoffset="${fillAmount}"
            stroke-linecap="round" transform="rotate(-90 44 44)"
            style="transition:stroke-dashoffset 0.6s ease,stroke 0.3s"/>
        </svg>
        <div style="position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center">
          <span style="font-family:Syne,sans-serif;font-weight:800;font-size:${score!==null?'20px':'14px'};color:${scoreColor};line-height:1">${score!==null?score:'â€”'}</span>
          <span style="font-size:9px;color:#8888aa;text-transform:uppercase;letter-spacing:.5px">Score</span>
        </div>
      </div>
      <div style="margin-left:14px;flex:1">
        <div style="font-size:11px;font-weight:800;text-transform:uppercase;letter-spacing:.5px;color:#8888aa;margin-bottom:6px">Baaz Rate Guide</div>
        <div style="display:flex;justify-content:space-between;padding:5px 8px;background:rgba(220,38,38,0.08);border-radius:6px;margin-bottom:3px">
          <span style="font-size:11px;color:#dc2626;font-weight:700">ğŸ”´ Min Rate</span>
          <span style="font-size:12px;font-weight:800;color:#dc2626">Â£${rates.min.toLocaleString()}</span>
        </div>
        <div style="display:flex;justify-content:space-between;padding:5px 8px;background:rgba(217,119,6,0.08);border-radius:6px;margin-bottom:3px">
          <span style="font-size:11px;color:#d97706;font-weight:700">ğŸŸ¡ Market</span>
          <span style="font-size:12px;font-weight:800;color:#d97706">Â£${rates.market.toLocaleString()}</span>
        </div>
        <div style="display:flex;justify-content:space-between;padding:5px 8px;background:rgba(22,163,74,0.08);border-radius:6px">
          <span style="font-size:11px;color:#16a34a;font-weight:700">ğŸŸ¢ Target</span>
          <span style="font-size:12px;font-weight:800;color:#16a34a">Â£${rates.target.toLocaleString()}</span>
        </div>
      </div>
    </div>`;

  // Vehicle rate card
  const rateCardHTML = vr.min30 ? `
    <div style="background:#fff;border:1px solid rgba(43,43,168,0.12);border-radius:8px;padding:10px 12px;margin-bottom:10px;font-size:11px">
      <div style="font-size:10px;font-weight:800;text-transform:uppercase;letter-spacing:.5px;color:#8888aa;margin-bottom:6px">ğŸ“‹ ${l.vehicle} â€” Baaz Sameday Rate Card</div>
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:4px">
        <div style="text-align:center;padding:4px;background:#f0f2f8;border-radius:4px">
          <div style="font-weight:800;color:#1a1a5e">Â£${vr.min30}</div><div style="color:#8888aa;font-size:9px">â‰¤30 miles</div>
        </div>
        <div style="text-align:center;padding:4px;background:#f0f2f8;border-radius:4px">
          <div style="font-weight:800;color:#1a1a5e">Â£${vr.min50}</div><div style="color:#8888aa;font-size:9px">â‰¤50 miles</div>
        </div>
        <div style="text-align:center;padding:4px;background:#f0f2f8;border-radius:4px">
          <div style="font-weight:800;color:#1a1a5e">${vr.pmLow===vr.pmHigh?'Â£'+vr.pmLow:'Â£'+vr.pmLow+'â€“Â£'+vr.pmHigh}</div><div style="color:#8888aa;font-size:9px">per mile 50+</div>
        </div>
      </div>
      <div style="margin-top:5px;padding:4px 8px;background:rgba(244,121,32,0.08);border-radius:4px;color:#c45e10;font-weight:700">
        Extra Stop: Â£${vr.extraStop} Â· Capacity: ${vr.capacity} Â· ${vr.pallets} std pallets / ${vr.pallets_e} euro
      </div>
    </div>` : '';

  let historyHTML = '';
  if(state && state.history && state.history.length){
    historyHTML = `<div class="nego-history">${state.history.map(m=>`<div class="nego-msg ${m.type}">${m.text}</div>`).join('')}</div>`;
  }
  let resultHTML = state && state.result ? `<div class="nego-result ${state.result.type}">${state.result.text}</div>` : '';
  const showBookBtn = state && state.done && state.result && state.result.type !== 'lose';

  return `
    <div class="nego-title">ğŸ’¬ Rate Negotiation <span style="font-size:11px;font-weight:600;color:#8888aa;margin-left:6px">â€” Based on Baaz Sameday Rate Sheet</span></div>
    <div class="nego-sub">Broker offers the minimum rate. Use the guide to negotiate up to market or target rate.</div>
    ${scoreCircleHTML}
    ${rateCardHTML}
    <div class="nego-offer">
      <div class="nego-offer-label">Broker's Current Offer</div>
      <div class="nego-offer-amount">Â£${currentOffer.toLocaleString()}</div>
    </div>
    ${historyHTML}
    ${resultHTML}
    <div class="nego-input-row">
      <input class="nego-input" id="nego-input" type="number" placeholder="Your counter Â£" min="${offered}" max="${Math.round(rates.target*1.1)}" ${disabled?'disabled':''} onkeydown="if(event.key==='Enter')submitNego()" oninput="previewScore(this.value)"/>
      <button class="nego-btn" onclick="submitNego()" ${disabled?'disabled':''}>Counter â†’</button>
    </div>
    <div class="nego-rounds" id="nego-rounds" style="font-size:11px;color:#8888aa;text-align:center;margin-bottom:8px">${disabled?'':roundsLeft+' round'+(roundsLeft!==1?'s':'')+' remaining'}</div>
    <button class="book-btn ${showBookBtn?'show':''}" onclick="openBookingModal()">ğŸ“‹ Book Load â€” Â£${(negotiatedRate||currentOffer).toLocaleString()}</button>
    ${!showBookBtn&&!disabled?`<button class="book-btn show" style="background:linear-gradient(135deg,#64748b,#475569)" onclick="acceptOffer()">Accept Min Rate â€” Â£${offered.toLocaleString()}</button>`:''}`;
}

function previewScore(val){
  // Live update score circle as student types
  if(!currentLoad || !val) return;
  const n = parseInt(val);
  if(isNaN(n)) return;
  const s = calcNegoScore(currentLoad.vehicle, currentLoad.miles, n);
  const color = s.band==='excellent'?'#16a34a':s.band==='good'?'#2B2BA8':s.band==='ok'?'#d97706':'#dc2626';
  const c = 2*Math.PI*36;
  const fill = c*(1-s.score/100);
  const circles = document.querySelectorAll('#nego-section svg circle:last-child');
  circles.forEach(el=>{
    el.setAttribute('stroke-dashoffset', fill);
    el.setAttribute('stroke', color);
  });
  const scoreEls = document.querySelectorAll('#nego-section svg + div span:first-child');
  scoreEls.forEach(el=>{ el.textContent=s.score; el.style.color=color; });
}

function submitNego(){
  const input = document.getElementById('nego-input');
  const val = parseInt(input.value);
  const rates = calcRates(currentLoad.vehicle, currentLoad.miles);
  const offered = rates.min;

  if(!val || val < offered){
    input.style.borderColor = 'var(--red)';
    setTimeout(()=>input.style.borderColor='',1000);
    showToast('âš ï¸','Enter a valid counter â€” must be at or above minimum rate (Â£'+offered.toLocaleString()+')','');
    return;
  }

  if(!negoState) negoState = {roundsLeft:3, history:[], currentOffer:offered, done:false};

  const diff = val - negoState.currentOffer;
  const pct = (diff / negoState.currentOffer) * 100;
  const scoreNow = calcNegoScore(currentLoad.vehicle, currentLoad.miles, val);

  negoState.history.push({type:'dispatcher', text:`You: Counter Â£${val.toLocaleString()} (Score preview: ${scoreNow.score}/100)`});
  negoState.roundsLeft--;

  let brokerResponse, accepted = false;

  // Broker accepts if student within 8% of current offer (more realistic)
  if(pct <= 8){
    negotiatedRate = val;
    brokerResponse = getBrokerAccept(val);
    negoState.done = true;
    accepted = true;
    const finalScore = calcNegoScore(currentLoad.vehicle, currentLoad.miles, val);
    const earned = val - offered;
    if(earned > session.bestRateAbove) session.bestRateAbove = earned;
    session.negoWins++;
    const xp = 60 + Math.round(finalScore.score * 0.8);
    session.xp += xp;
    updateSessionBar();
    negoState.result = {type:'win',
      text:`ğŸ‰ Deal at Â£${val.toLocaleString()} â€” Score: ${finalScore.score}/100 (${finalScore.band}) Â· +Â£${earned} above min rate`};
    showToast('ğŸ‰','Deal secured! Score: '+finalScore.score+'/100','+'+xp+' XP');
  } else if(pct <= 20 && negoState.roundsLeft > 0){
    // Broker counters at midpoint
    const counter = Math.round(negoState.currentOffer + diff * 0.45);
    negoState.currentOffer = counter;
    brokerResponse = getBrokerCounter(counter, negoState.roundsLeft);
    negoState.history.push({type:'broker', text:`Broker: ${brokerResponse}`});
  } else if(negoState.roundsLeft <= 0){
    negotiatedRate = negoState.currentOffer;
    negoState.done = true;
    accepted = true;
    const finalScore = calcNegoScore(currentLoad.vehicle, currentLoad.miles, negoState.currentOffer);
    negoState.result = {type:'partial',
      text:`â±ï¸ Rounds used â€” booked at Â£${negoState.currentOffer.toLocaleString()} Â· Score: ${finalScore.score}/100. Tip: counter closer to market rate next time.`};
    session.xp += 35;
    updateSessionBar();
    showToast('â±ï¸','Out of rounds â€” Score: '+finalScore.score+'/100','+35 XP');
  } else {
    brokerResponse = getBrokerReject();
    negoState.history.push({type:'broker', text:`Broker: ${brokerResponse}`});
    negoState.done = true;
    negoState.result = {type:'lose',
      text:`âŒ Broker walked away â€” counter too high. Baaz target rate is Â£${rates.target.toLocaleString()}. Try starting at market rate (Â£${rates.market.toLocaleString()}).`};
    session.xp += 8;
    updateSessionBar();
    showToast('âŒ','Broker rejected â€” too high above target rate','+8 XP');
  }

  if(accepted && brokerResponse){
    negoState.history.push({type:'broker', text:`Broker: ${brokerResponse}`});
  }

  const ns = document.getElementById('nego-section');
  if(ns) ns.innerHTML = renderNegoPanel(negoState);
}

function acceptOffer(){
  const rates = calcRates(currentLoad.vehicle, currentLoad.miles);
  negotiatedRate = rates.min;
  negoState = negoState || {history:[], roundsLeft:3, done:true, currentOffer:rates.min};
  negoState.done = true;
  negoState.currentOffer = rates.min;
  const s = calcNegoScore(currentLoad.vehicle, currentLoad.miles, rates.min);
  negoState.result = {type:'partial',
    text:`ğŸ“Œ Accepted minimum rate â€” Â£${rates.min.toLocaleString()} Â· Score: ${s.score}/100. Market rate was Â£${rates.market.toLocaleString()} â€” aim higher next time!`};
  session.xp += 20;
  updateSessionBar();
  const ns = document.getElementById('nego-section');
  if(ns) ns.innerHTML = renderNegoPanel(negoState);
}

function getBrokerAccept(rate){
  const phrases = [
    `Alright, Â£${rate.toLocaleString()} it is. Can you confirm collection for ${currentLoad.col}?`,
    `Fair enough mate â€” Â£${rate.toLocaleString()} works. What's your vehicle reg?`,
    `Done at Â£${rate.toLocaleString()}. Send me the driver details and I'll issue the paperwork.`,
    `Right, we'll go Â£${rate.toLocaleString()}. Driver needs to be there by ${currentLoad.col} sharp.`,
  ];
  return phrases[Math.floor(Math.random()*phrases.length)];
}
function getBrokerCounter(counter, rounds){
  const phrases = [
    `Best I can do is Â£${counter.toLocaleString()}. We're not far off â€” what do you say?`,
    `Look, I can go to Â£${counter.toLocaleString()} but that's my final offer on this one.`,
    `I'll meet you halfway at Â£${counter.toLocaleString()}. Solid load, worth it.`,
    `Â£${counter.toLocaleString()} and we have a deal â€” but I need a decision now, I have another carrier waiting.`,
  ];
  return phrases[Math.floor(Math.random()*phrases.length)];
}
function getBrokerReject(){
  const phrases = [
    `That's way over budget mate. I'll have to go elsewhere. Thanks anyway.`,
    `No chance at that rate. I've got three other carriers interested. Good luck.`,
    `That doesn't work for us. We'll pass â€” thanks for calling.`,
    `Sorry, that's not going to work. I need to move on.`,
  ];
  return phrases[Math.floor(Math.random()*phrases.length)];
}

// ACCEPT OFFER BUTTON
function openBookingModal(){
  if(!currentLoad) return;
  if(!negotiatedRate){ negotiatedRate = calcRates(currentLoad.vehicle, currentLoad.miles).min; }
  const b = BROKERS[currentLoad.broker];
  const l = currentLoad;

  document.getElementById('modal-load-summary').innerHTML =
    `<strong>${l.from} â†’ ${l.to}</strong> Â· ${l.miles} miles Â· ${l.vehicle}<br/>
     Agreed Rate: <strong style="color:var(--navy);font-family:'Syne',sans-serif;font-size:16px">Â£${negotiatedRate.toLocaleString()}</strong> Â· Broker: ${b.name}<br/>
     <span style="font-size:11px;color:#8888aa">Min: Â£${calcRates(l.vehicle,l.miles).min.toLocaleString()} Â· Market: Â£${calcRates(l.vehicle,l.miles).market.toLocaleString()} Â· Target: Â£${calcRates(l.vehicle,l.miles).target.toLocaleString()}</span>`;

  // Render drivers
  const drivers = [
    {name:'Rajesh Kumar', vehicle:'Curtainsider 44t', location:'Birmingham'},
    {name:'Harpreet Singh', vehicle:'Refrigerated 20t', location:'Manchester'},
    {name:'David Jones', vehicle:'Box Van 3.5t', location:'Bristol'},
    {name:'Mohammed Ali', vehicle:'Flatbed 30t', location:'Leeds'},
    {name:'Colin Fraser', vehicle:'Tanker 28t', location:'Glasgow'},
  ];
  document.getElementById('driver-select').innerHTML = drivers.map((d,i)=>`
    <div class="driver-option" onclick="selectDriver(${i},this)">
      <div class="driver-name">${d.name}</div>
      <div class="driver-vehicle">${d.vehicle}</div>
      <div class="driver-location">ğŸ“ ${d.location}</div>
    </div>`).join('');

  selectedDriver = null;
  document.getElementById('f-collection').value = '';
  document.getElementById('f-delivery').value = '';
  document.getElementById('f-col-contact').value = '';
  document.getElementById('f-del-contact').value = '';
  document.getElementById('f-instructions').value = '';
  document.getElementById('booking-modal').classList.add('show');
}

function selectDriver(idx, el){
  document.querySelectorAll('.driver-option').forEach(d=>d.classList.remove('selected'));
  el.classList.add('selected');
  selectedDriver = idx;
}

function confirmBooking(){
  if(selectedDriver === null){
    showToast('âš ï¸','Please select a driver first','');
    return;
  }
  const col = document.getElementById('f-collection').value.trim();
  const del = document.getElementById('f-delivery').value.trim();
  if(!col || !del){
    showToast('âš ï¸','Please fill in collection and delivery addresses','');
    return;
  }
  closeModal('booking-modal');
  generateCN();
}

function generateCN(){
  const l = currentLoad;
  const b = BROKERS[l.broker];
  const drivers = [
    {name:'Rajesh Kumar', vehicle:'Curtainsider 44t', reg:'BG23 XKL'},
    {name:'Harpreet Singh', vehicle:'Refrigerated 20t', reg:'MN71 PLQ'},
    {name:'David Jones', vehicle:'Box Van 3.5t', reg:'YK19 CRV'},
    {name:'Mohammed Ali', vehicle:'Flatbed 30t', reg:'SH65 JWP'},
    {name:'Colin Fraser', vehicle:'Tanker 28t', reg:'LG70 KMR'},
  ];
  const driver = drivers[selectedDriver];
  const ref = 'EX-' + l.id + '-' + Date.now().toString().slice(-4);
  const col = document.getElementById('f-collection').value || l.from + ' Depot';
  const del = document.getElementById('f-delivery').value || l.to + ' Depot';
  const colContact = document.getElementById('f-col-contact').value || 'Contact on arrival';
  const delContact = document.getElementById('f-del-contact').value || 'Contact on arrival';
  const instructions = document.getElementById('f-instructions').value || 'Standard delivery â€” no special requirements';
  const today = new Date().toLocaleDateString('en-GB');

  document.getElementById('cn-ref').textContent = ref;
  document.getElementById('cn-body').innerHTML = `
    <div class="cn-grid">
      <div class="cn-field"><div class="cn-field-label">Date</div><div class="cn-field-value">${today}</div></div>
      <div class="cn-field"><div class="cn-field-label">Reference</div><div class="cn-field-value" style="font-family:'JetBrains Mono',monospace;font-size:12px">${ref}</div></div>
      <div class="cn-field"><div class="cn-field-label">Carrier / Haulier</div><div class="cn-field-value">Xeagle Ltd (on behalf of carrier)</div></div>
      <div class="cn-field"><div class="cn-field-label">Driver Name</div><div class="cn-field-value">${driver.name}</div></div>
      <div class="cn-field"><div class="cn-field-label">Vehicle Reg</div><div class="cn-field-value" style="font-family:'JetBrains Mono',monospace">${driver.reg}</div></div>
      <div class="cn-field"><div class="cn-field-label">Vehicle Type</div><div class="cn-field-value">${l.vehicle}</div></div>
      <div class="cn-field cn-full"><div class="cn-field-label">Collection Address</div><div class="cn-field-value">${col}</div></div>
      <div class="cn-field"><div class="cn-field-label">Collection Time</div><div class="cn-field-value">${l.col} â€” ${today}</div></div>
      <div class="cn-field"><div class="cn-field-label">Collection Contact</div><div class="cn-field-value">${colContact}</div></div>
      <div class="cn-field cn-full"><div class="cn-field-label">Delivery Address</div><div class="cn-field-value">${del}</div></div>
      <div class="cn-field"><div class="cn-field-label">Delivery Time</div><div class="cn-field-value">By ${l.del} â€” ${today}</div></div>
      <div class="cn-field"><div class="cn-field-label">Delivery Contact</div><div class="cn-field-value">${delContact}</div></div>
      <div class="cn-field"><div class="cn-field-label">Description of Goods</div><div class="cn-field-value">${l.goods}</div></div>
      <div class="cn-field"><div class="cn-field-label">Weight</div><div class="cn-field-value">${l.weight}</div></div>
      <div class="cn-field"><div class="cn-field-label">Distance</div><div class="cn-field-value">${l.miles} miles</div></div>
      <div class="cn-field"><div class="cn-field-label">Agreed Rate</div><div class="cn-field-value" style="font-family:'Syne',sans-serif;font-weight:800;font-size:16px;color:var(--navy)">Â£${negotiatedRate.toLocaleString()}</div></div>
      <div class="cn-field"><div class="cn-field-label">Load Poster</div><div class="cn-field-value">${b.name}</div></div>
      <div class="cn-field cn-full"><div class="cn-field-label">Special Instructions</div><div class="cn-field-value">${instructions}</div></div>
    </div>
    <div class="cn-stamp">
      <div class="cn-stamp-box">
        <div class="cn-stamp-label">Dispatcher Signature</div>
        <div class="cn-stamp-line">Dispatched by Xeagle Ltd</div>
      </div>
      <div class="cn-stamp-box">
        <div class="cn-stamp-label">Driver Signature</div>
        <div class="cn-stamp-line">${driver.name}</div>
      </div>
      <div class="cn-stamp-box">
        <div class="cn-stamp-label">Collected By (Shipper)</div>
        <div class="cn-stamp-line">Stamp &amp; Sign</div>
      </div>
    </div>
    <div style="background:rgba(43,43,168,0.06);border:1px solid var(--border);border-radius:var(--r-sm);padding:10px 14px;margin-top:16px;font-size:11px;color:var(--text3)">
      This is a training document generated by Eagle Exchange. In real operations, consignment notes are legally binding documents carried by the driver throughout the journey. For international loads a CMR Note would be used instead.
    </div>`;

  // Mark as booked
  bookedIds.push(l.id);
  localStorage.setItem('ex_booked', JSON.stringify(bookedIds));
  session.booked++;
  session.revenue += negotiatedRate || calcRates(currentLoad.vehicle, currentLoad.miles).min;
  session.xp += 50;
  updateSessionBar();

  document.getElementById('st-booked').textContent = session.booked;
  document.getElementById('st-available').textContent = ALL_LOADS.length - bookedIds.length;

  renderLoadList();
  document.getElementById('cn-modal').classList.add('show');
  showToast('ğŸ“‹','Consignment note generated!','+50 XP for booking');
}

function refreshLoads(){
  // Simulate new loads appearing
  bookedIds = JSON.parse(localStorage.getItem('ex_booked') || '[]');
  applyFilters();
  showToast('â†»','Load board refreshed','New loads may be available');
}

function closeModal(id){
  document.getElementById(id).classList.remove('show');
}

function printCN(){
  window.print();
}

let toastTimeout;
function showToast(emoji, title, xp){
  const t = document.getElementById('score-toast');
  document.getElementById('toast-emoji').textContent = emoji;
  document.getElementById('toast-title').textContent = title;
  document.getElementById('toast-xp').textContent = xp;
  t.classList.add('show');
  clearTimeout(toastTimeout);
  toastTimeout = setTimeout(()=>t.classList.remove('show'), 3000);
}

// INIT
applyFilters();
updateSessionBar();

// Auto-refresh loads every 60 seconds (simulate live board)
setInterval(()=>{
  // Add subtle animation to urgent items
  document.querySelectorAll('.load-item.urgent').forEach(el=>{
    el.style.borderLeft = '3px solid var(--red)';
  });
}, 60000);
</script>
</body>
</html>
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     EAGLE EXCHANGE PART 2 â€” STYLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<style id="part2-styles">

/* â”€â”€ TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.ex-tabs{max-width:1400px;margin:0 auto;padding:0 20px;display:flex;gap:4px;border-bottom:2px solid var(--border);background:var(--surface);position:sticky;top:65px;z-index:200;box-shadow:0 2px 8px rgba(43,43,168,0.06)}
.ex-tab{padding:12px 20px;font-size:13px;font-weight:700;color:var(--text3);cursor:pointer;border-bottom:2px solid transparent;margin-bottom:-2px;transition:all .2s;font-family:'DM Sans',sans-serif;background:none;border-top:none;border-left:none;border-right:none;white-space:nowrap}
.ex-tab:hover{color:var(--navy)}
.ex-tab.active{color:var(--navy);border-bottom-color:var(--orange)}
.ex-tab-badge{background:var(--orange);color:#fff;font-size:9px;font-weight:800;padding:1px 5px;border-radius:10px;margin-left:4px;vertical-align:middle}

/* â”€â”€ TAB PANELS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.tab-panel{display:none;max-width:1400px;margin:0 auto;padding:20px}
.tab-panel.active{display:block}

/* â”€â”€ UK TRACKING MAP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.tracking-wrap{display:grid;grid-template-columns:1fr 380px;gap:20px;align-items:start}
@media(max-width:1000px){.tracking-wrap{grid-template-columns:1fr}}
.map-panel{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);box-shadow:var(--sh-sm);overflow:hidden}
.map-header{background:linear-gradient(135deg,var(--navy),var(--navy2));padding:14px 20px;display:flex;align-items:center;justify-content:space-between}
.map-title{font-family:'Syne',sans-serif;font-weight:800;font-size:15px;color:#fff}
.map-subtitle{font-size:11px;color:rgba(255,255,255,0.7);margin-top:2px}
.map-status-pill{font-size:11px;font-weight:700;padding:4px 10px;border-radius:20px}
.map-status-pill.moving{background:rgba(22,163,74,0.25);color:#4ade80;animation:pulse-green 2s ease-in-out infinite}
.map-status-pill.idle{background:rgba(255,255,255,0.1);color:rgba(255,255,255,0.6)}
@keyframes pulse-green{0%,100%{opacity:1}50%{opacity:.6}}
.map-body{padding:16px;position:relative}

/* UK SVG MAP */
.uk-map-svg{width:100%;max-width:520px;margin:0 auto;display:block}
.map-road{stroke:#cbd5e1;stroke-width:2;fill:none;stroke-linecap:round}
.map-road.active-route{stroke:var(--orange);stroke-width:3;stroke-dasharray:8 4;animation:dash-move 1.5s linear infinite}
@keyframes dash-move{to{stroke-dashoffset:-24}}
.map-city-dot{fill:var(--navy);stroke:#fff;stroke-width:2;cursor:pointer;transition:all .2s}
.map-city-dot:hover{fill:var(--orange);r:7}
.map-city-dot.origin{fill:var(--green);r:8}
.map-city-dot.destination{fill:var(--orange);r:8}
.map-city-label{font-family:'Syne',sans-serif;font-size:11px;font-weight:700;fill:var(--text);pointer-events:none}
.map-motorway{stroke:#e2e8f0;stroke-width:1.5;fill:none}
.truck-marker{font-size:20px;transition:all 0.5s ease}

/* JOURNEY PROGRESS */
.journey-bar{padding:14px 16px;border-top:1px solid var(--border);background:var(--surf2)}
.journey-route{display:flex;align-items:center;gap:8px;margin-bottom:10px}
.j-city{font-family:'Syne',sans-serif;font-weight:800;font-size:14px;color:var(--navy)}
.j-arrow{color:var(--orange);font-size:16px}
.j-miles{font-size:11px;color:var(--text3);margin-left:auto}
.journey-track{height:8px;background:rgba(43,43,168,0.12);border-radius:4px;overflow:hidden;position:relative;margin-bottom:8px}
.journey-fill{height:100%;background:linear-gradient(90deg,var(--green),var(--orange));border-radius:4px;transition:width 1s ease}
.journey-truck{position:absolute;top:-6px;font-size:18px;transition:left 1s ease;transform:translateX(-50%)}
.journey-stats{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.j-stat{text-align:center;background:#fff;border:1px solid var(--border);border-radius:var(--r-sm);padding:8px 4px}
.j-stat .jv{font-family:'Syne',sans-serif;font-weight:800;font-size:15px;color:var(--navy)}
.j-stat .jl{font-size:9px;color:var(--text3);text-transform:uppercase;letter-spacing:.4px}

/* CHECK CALLS */
.cc-panel{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);box-shadow:var(--sh-sm)}
.cc-header{background:linear-gradient(135deg,#0891b2,#0e7490);padding:14px 16px;border-radius:var(--r) var(--r) 0 0}
.cc-title{font-family:'Syne',sans-serif;font-weight:800;font-size:14px;color:#fff}
.cc-sub{font-size:11px;color:rgba(255,255,255,0.75);margin-top:2px}
.cc-body{padding:16px}
.cc-log{max-height:260px;overflow-y:auto;display:flex;flex-direction:column;gap:8px;margin-bottom:12px;scrollbar-width:thin}
.cc-entry{padding:10px 12px;border-radius:var(--r-sm);font-size:12px;line-height:1.5}
.cc-entry.system{background:rgba(43,43,168,0.06);color:var(--navy);border-left:3px solid var(--navy)}
.cc-entry.driver{background:rgba(8,145,178,0.08);color:#0e7490;border-left:3px solid #0891b2}
.cc-entry.dispatcher{background:rgba(22,163,74,0.08);color:var(--green);border-left:3px solid var(--green);text-align:right}
.cc-entry.incident{background:rgba(220,38,38,0.08);color:var(--red);border-left:3px solid var(--red)}
.cc-entry.resolved{background:rgba(22,163,74,0.06);color:var(--green)}
.cc-input-row{display:flex;gap:8px}
.cc-input{flex:1;background:var(--surf2);border:1.5px solid var(--border);border-radius:var(--r-sm);padding:8px 12px;font-size:13px;color:var(--text);font-family:'DM Sans',sans-serif;outline:none}
.cc-input:focus{border-color:#0891b2}
.cc-send{background:linear-gradient(135deg,#0891b2,#0e7490);color:#fff;border:none;border-radius:var(--r-sm);padding:8px 14px;font-size:12px;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif;white-space:nowrap}
.cc-next{width:100%;margin-top:10px;background:linear-gradient(135deg,var(--orange),var(--og-dk));color:#fff;border:none;border-radius:var(--r-sm);padding:10px;font-size:13px;font-weight:700;cursor:pointer;font-family:'Syne',sans-serif;display:none}
.cc-done-msg{text-align:center;padding:16px;font-size:13px;color:var(--text3)}

/* INCIDENT MODAL */
.incident-overlay{position:fixed;inset:0;background:rgba(220,38,38,0.15);backdrop-filter:blur(3px);z-index:600;display:none;align-items:center;justify-content:center;padding:20px}
.incident-overlay.show{display:flex;animation:incidentIn .3s ease}
@keyframes incidentIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
.incident-card{background:var(--surface);border-radius:16px;width:100%;max-width:520px;box-shadow:0 20px 60px rgba(220,38,38,0.25);border:2px solid rgba(220,38,38,0.3);overflow:hidden}
.incident-header{background:linear-gradient(135deg,#dc2626,#b91c1c);padding:20px 24px;display:flex;align-items:center;gap:12px}
.incident-icon{font-size:32px}
.incident-htext .ititle{font-family:'Syne',sans-serif;font-weight:800;font-size:18px;color:#fff}
.incident-htext .isub{font-size:12px;color:rgba(255,255,255,0.8);margin-top:2px}
.incident-body{padding:20px 24px}
.incident-situation{background:rgba(220,38,38,0.06);border-left:3px solid var(--red);padding:12px 16px;border-radius:0 var(--r-sm) var(--r-sm) 0;font-size:13px;color:var(--text);line-height:1.6;margin-bottom:16px;font-weight:500}
.incident-question{font-size:13px;font-weight:700;color:var(--navy);margin-bottom:12px}
.incident-options{display:flex;flex-direction:column;gap:8px}
.incident-option{padding:12px 16px;border:2px solid var(--border);border-radius:var(--r-sm);cursor:pointer;font-size:13px;font-weight:600;color:var(--text);background:var(--surf2);transition:all .2s;text-align:left;font-family:'DM Sans',sans-serif;line-height:1.4}
.incident-option:hover{border-color:var(--orange);background:rgba(244,121,32,0.06)}
.incident-option.correct{border-color:var(--green);background:var(--green-bg);color:var(--green);cursor:default}
.incident-option.wrong{border-color:var(--red);background:var(--red-bg);color:var(--red);cursor:default}
.incident-option.neutral{border-color:var(--amber);background:var(--amber-bg);color:var(--amber);cursor:default}
.incident-feedback{margin-top:14px;padding:12px 16px;border-radius:var(--r-sm);font-size:13px;font-weight:600;display:none}
.incident-feedback.show{display:block}
.incident-feedback.good{background:var(--green-bg);color:var(--green)}
.incident-feedback.ok{background:var(--amber-bg);color:var(--amber)}
.incident-feedback.poor{background:var(--red-bg);color:var(--red)}
.incident-continue{width:100%;margin-top:14px;background:linear-gradient(135deg,var(--navy),var(--navy2));color:#fff;border:none;border-radius:var(--r-sm);padding:12px;font-size:13px;font-weight:800;cursor:pointer;font-family:'Syne',sans-serif;display:none}
.incident-continue.show{display:block}

/* NO LOAD TRACKING */
.no-tracking{padding:60px 20px;text-align:center;color:var(--text3)}
.no-tracking .big{font-size:48px;margin-bottom:12px}

/* â”€â”€ LEADERBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.lb-wrap{display:grid;grid-template-columns:1fr 340px;gap:20px}
@media(max-width:900px){.lb-wrap{grid-template-columns:1fr}}
.lb-panel{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);box-shadow:var(--sh-sm);overflow:hidden}
.lb-header{background:linear-gradient(135deg,var(--navy),var(--navy2));padding:16px 20px;display:flex;align-items:center;justify-content:space-between}
.lb-title{font-family:'Syne',sans-serif;font-weight:800;font-size:16px;color:#fff}
.lb-sub{font-size:11px;color:rgba(255,255,255,0.7);margin-top:2px}
.lb-reset{background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);color:rgba(255,255,255,0.8);padding:5px 12px;border-radius:var(--r-sm);font-size:11px;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif}
.lb-body{padding:16px}
.lb-entry{display:flex;align-items:center;gap:12px;padding:12px 16px;border-radius:var(--r-sm);margin-bottom:6px;background:var(--surf2);border:1px solid var(--border);transition:all .2s}
.lb-entry:hover{border-color:rgba(43,43,168,0.25);background:#fff}
.lb-entry.me{border-color:var(--orange);background:rgba(244,121,32,0.06)}
.lb-rank{font-family:'Syne',sans-serif;font-weight:800;font-size:18px;color:var(--text3);width:32px;text-align:center;flex-shrink:0}
.lb-rank.gold{color:#f59e0b}
.lb-rank.silver{color:#94a3b8}
.lb-rank.bronze{color:#b45309}
.lb-crown{font-size:20px;width:32px;text-align:center;flex-shrink:0}
.lb-name{font-weight:700;font-size:14px;color:var(--navy);flex:1}
.lb-name .lb-badge{font-size:10px;font-weight:700;padding:2px 6px;border-radius:8px;margin-left:6px;background:rgba(43,43,168,0.1);color:var(--navy)}
.lb-name .lb-me-tag{font-size:10px;color:var(--orange);font-weight:700;margin-left:6px}
.lb-stats{text-align:right}
.lb-xp{font-family:'Syne',sans-serif;font-weight:800;font-size:16px;color:var(--orange)}
.lb-detail{font-size:11px;color:var(--text3)}
.lb-empty{padding:40px;text-align:center;color:var(--text3);font-size:13px}

/* JOIN PANEL */
.join-panel{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);box-shadow:var(--sh-sm);padding:24px}
.join-title{font-family:'Syne',sans-serif;font-weight:800;font-size:16px;color:var(--navy);margin-bottom:6px}
.join-sub{font-size:13px;color:var(--text3);margin-bottom:20px}
.join-input{width:100%;background:var(--surf2);border:2px solid var(--border);border-radius:var(--r-sm);padding:12px 16px;font-size:15px;font-weight:700;color:var(--navy);font-family:'DM Sans',sans-serif;outline:none;margin-bottom:10px;transition:border-color .2s}
.join-input:focus{border-color:var(--orange)}
.join-btn{width:100%;background:linear-gradient(135deg,var(--orange),var(--og-dk));color:#fff;border:none;border-radius:var(--r-sm);padding:12px;font-size:14px;font-weight:800;cursor:pointer;font-family:'Syne',sans-serif;margin-bottom:16px}
.my-score-card{background:linear-gradient(135deg,var(--navy),var(--navy2));border-radius:var(--r-sm);padding:16px;color:#fff;margin-bottom:16px;display:none}
.my-score-card.show{display:block}
.my-score-name{font-family:'Syne',sans-serif;font-weight:800;font-size:18px}
.my-score-stats{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:12px}
.my-stat{background:rgba(255,255,255,0.1);border-radius:var(--r-sm);padding:10px;text-align:center}
.my-stat .mv{font-family:'Syne',sans-serif;font-weight:800;font-size:20px;color:var(--orange)}
.my-stat .ml{font-size:10px;color:rgba(255,255,255,0.7);text-transform:uppercase;letter-spacing:.4px}
.tips-box{background:var(--surf2);border:1px solid var(--border);border-radius:var(--r-sm);padding:16px}
.tips-title{font-size:12px;font-weight:800;color:var(--navy);margin-bottom:10px;text-transform:uppercase;letter-spacing:.5px}
.tip-item{font-size:12px;color:var(--text2);padding:4px 0;border-bottom:1px solid var(--border);display:flex;gap:8px}
.tip-item:last-child{border-bottom:none}

/* â”€â”€ END OF SHIFT REPORT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.report-overlay{position:fixed;inset:0;background:rgba(26,26,94,0.6);backdrop-filter:blur(6px);z-index:700;display:none;align-items:center;justify-content:center;padding:20px}
.report-overlay.show{display:flex}
.report-modal{background:var(--surface);border-radius:16px;width:100%;max-width:620px;max-height:92vh;overflow-y:auto;box-shadow:0 20px 80px rgba(26,26,94,0.4)}
.report-header{background:linear-gradient(135deg,var(--navy),var(--navy2));padding:24px;text-align:center;border-radius:16px 16px 0 0;position:relative}
.report-eagle{font-size:48px;margin-bottom:8px}
.report-title{font-family:'Syne',sans-serif;font-weight:800;font-size:22px;color:#fff}
.report-date{font-size:12px;color:rgba(255,255,255,0.7);margin-top:4px}
.report-grade-badge{display:inline-block;background:var(--orange);color:#fff;font-family:'Syne',sans-serif;font-weight:800;font-size:18px;padding:6px 20px;border-radius:20px;margin-top:12px}
.report-body{padding:24px}
.report-section{margin-bottom:20px}
.report-section-title{font-size:11px;font-weight:800;text-transform:uppercase;letter-spacing:.8px;color:var(--text3);margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid var(--border)}
.report-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.report-stat{background:var(--surf2);border:1px solid var(--border);border-radius:var(--r-sm);padding:14px;text-align:center}
.report-stat .rv{font-family:'Syne',sans-serif;font-weight:800;font-size:24px;color:var(--navy)}
.report-stat .rl{font-size:11px;color:var(--text3);text-transform:uppercase;letter-spacing:.4px;margin-top:2px}
.report-stat.highlight .rv{color:var(--orange)}
.report-breakdown{background:var(--surf2);border:1px solid var(--border);border-radius:var(--r-sm);overflow:hidden}
.rb-row{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;border-bottom:1px solid var(--border);font-size:13px}
.rb-row:last-child{border-bottom:none}
.rb-row .rb-label{color:var(--text2);font-weight:600}
.rb-row .rb-val{font-weight:800;color:var(--navy);font-family:'Syne',sans-serif}
.rb-row .rb-val.good{color:var(--green)}
.rb-row .rb-val.ok{color:var(--amber)}
.rb-row .rb-val.poor{color:var(--red)}
.verdict-box{border-radius:var(--r-sm);padding:16px;text-align:center;margin-bottom:16px}
.verdict-box.excellent{background:var(--green-bg);border:1px solid rgba(22,163,74,0.3)}
.verdict-box.good{background:var(--amber-bg);border:1px solid rgba(217,119,6,0.3)}
.verdict-box.poor{background:var(--red-bg);border:1px solid rgba(220,38,38,0.3)}
.verdict-emoji{font-size:32px;margin-bottom:6px}
.verdict-text{font-family:'Syne',sans-serif;font-weight:800;font-size:16px}
.verdict-sub{font-size:12px;color:var(--text3);margin-top:4px}
.report-footer{padding:16px 24px;border-top:1px solid var(--border);display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
.btn-report-print{background:linear-gradient(135deg,var(--navy),var(--navy2));color:#fff;border:none;padding:11px 20px;border-radius:var(--r-sm);cursor:pointer;font-size:13px;font-weight:700;font-family:'DM Sans',sans-serif}
.btn-report-close{background:linear-gradient(135deg,var(--orange),var(--og-dk));color:#fff;border:none;padding:11px 20px;border-radius:var(--r-sm);cursor:pointer;font-size:13px;font-weight:700;font-family:'DM Sans',sans-serif}
.btn-report-lb{background:linear-gradient(135deg,var(--green),#15803d);color:#fff;border:none;padding:11px 20px;border-radius:var(--r-sm);cursor:pointer;font-size:13px;font-weight:700;font-family:'DM Sans',sans-serif}
</style>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     INJECT TAB BAR AFTER TICKER (via JS)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<!-- TRACKING TAB PANEL -->
<div class="tab-panel" id="tab-tracking">
  <div class="tracking-wrap" id="tracking-content">
    <div class="no-tracking">
      <div class="big">ğŸ—ºï¸</div>
      <p><strong>No load being tracked</strong><br/>Book a load on the Load Board first,<br/>then return here to track your driver.</p>
    </div>
  </div>
</div>

<!-- LEADERBOARD TAB PANEL -->
<div class="tab-panel" id="tab-leaderboard">
  <div class="lb-wrap">
    <!-- LEADERBOARD TABLE -->
    <div class="lb-panel">
      <div class="lb-header">
        <div>
          <div class="lb-title">ğŸ† Eagle Exchange Leaderboard</div>
          <div class="lb-sub">Top dispatchers in your classroom today</div>
        </div>
        <button class="lb-reset" onclick="clearLeaderboard()">Reset Board</button>
      </div>
      <div class="lb-body" id="lb-body">
        <div class="lb-empty">No scores yet â€” book loads and earn XP to appear here!</div>
      </div>
    </div>
    <!-- JOIN + MY SCORE -->
    <div>
      <div class="join-panel" style="margin-bottom:16px">
        <div class="join-title">ğŸ“ Join the Leaderboard</div>
        <div class="join-sub">Enter your name to save your score and compete with classmates</div>
        <input class="join-input" id="lb-name-input" placeholder="Your name (e.g. Priya Sharma)" maxlength="30"/>
        <button class="join-btn" onclick="submitToLeaderboard()">ğŸ¦… Submit My Score</button>
        <div class="my-score-card" id="my-score-card">
          <div class="my-score-name" id="my-score-name"></div>
          <div class="my-score-stats">
            <div class="my-stat"><div class="mv" id="my-xp">0</div><div class="ml">XP</div></div>
            <div class="my-stat"><div class="mv" id="my-loads">0</div><div class="ml">Loads</div></div>
            <div class="my-stat"><div class="mv" id="my-revenue">Â£0</div><div class="ml">Revenue</div></div>
            <div class="my-stat"><div class="mv" id="my-grade">â€”</div><div class="ml">Grade</div></div>
          </div>
        </div>
        <div class="tips-box">
          <div class="tips-title">ğŸ’¡ How to earn more XP</div>
          <div class="tip-item"><span>âš¡</span><span>Negotiate above offered rate: +80â€“120 XP</span></div>
          <div class="tip-item"><span>ğŸ“‹</span><span>Book a load: +50 XP per booking</span></div>
          <div class="tip-item"><span>ğŸš¨</span><span>Handle incident correctly: +40 XP</span></div>
          <div class="tip-item"><span>âœ…</span><span>Complete check-call: +20 XP</span></div>
          <div class="tip-item"><span>ğŸ”´</span><span>Reject bad CX broker: +30 XP</span></div>
          <div class="tip-item"><span>ğŸ“¦</span><span>Book urgent load: +25 bonus XP</span></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- RATE BOOK PANEL -->
<div class="tab-panel" id="tab-ratebook">
  <div id="ratebook-content"></div>
</div>

<!-- INCIDENT MODAL -->
<div class="incident-overlay" id="incident-overlay">
  <div class="incident-card" id="incident-card">
    <!-- populated by JS -->
  </div>
</div>

<!-- END OF SHIFT REPORT MODAL -->
<div class="report-overlay" id="report-overlay">
  <div class="report-modal" id="report-modal">
    <!-- populated by JS -->
  </div>
</div>

<script id="part2-script">
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  EAGLE EXCHANGE PART 2 â€” TRACKING, INCIDENTS,
//  LEADERBOARD & END OF SHIFT REPORT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€ INJECT TAB BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function injectTabs(){
  const ticker = document.querySelector('.ex-ticker');
  const tabBar = document.createElement('div');
  tabBar.className = 'ex-tabs';
  tabBar.innerHTML = `
    <button class="ex-tab active" onclick="switchTab('loadboard',this)">ğŸ“¦ Load Board</button>
    <button class="ex-tab" onclick="switchTab('tracking',this)" id="tab-btn-tracking">ğŸ—ºï¸ Track Load <span class="ex-tab-badge" id="tracking-badge" style="display:none">LIVE</span></button>
    <button class="ex-tab" onclick="switchTab('leaderboard',this)">ğŸ† Leaderboard</button>
    <button class="ex-tab" onclick="switchTab('ratebook',this)">ğŸ“‹ Rate Sheet</button>
    <button class="ex-tab" onclick="showShiftReport()" style="margin-left:auto;color:var(--orange)">ğŸ“Š End of Shift Report</button>`;
  ticker.after(tabBar);

  // Wrap existing ex-wrap in loadboard tab
  const exWrap = document.querySelector('.ex-wrap');
  const sessionBarWrap = exWrap.previousElementSibling;
  const lbDiv = document.createElement('div');
  lbDiv.className = 'tab-panel active';
  lbDiv.id = 'tab-loadboard';
  // Move session bar + ex-wrap into tab
  lbDiv.style.padding = '0';
  const container = document.createElement('div');
  container.style.cssText = 'max-width:1400px;margin:0 auto;padding:0 20px 20px';
  lbDiv.appendChild(container);
  exWrap.parentNode.insertBefore(lbDiv, exWrap);
  container.appendChild(sessionBarWrap);
  container.appendChild(exWrap);

  // Insert tracking and leaderboard panels after
  lbDiv.after(document.getElementById('tab-leaderboard'));
  document.getElementById('tab-leaderboard').after(document.getElementById('tab-tracking'));
})();

function switchTab(name, btn){
  document.querySelectorAll('.ex-tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.tab-panel').forEach(p=>p.classList.remove('active'));
  if(btn) btn.classList.add('active');
  const panel = document.getElementById('tab-'+name);
  if(panel) panel.classList.add('active');
  if(name==='leaderboard') renderLeaderboard();
  if(name==='ratebook') renderRateBook();
  if(name==='tracking') renderTracking();
}

// â”€â”€ TRACKING STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let tracking = {
  active: false,
  load: null,
  progress: 0,       // 0â€“100
  milesGone: 0,
  startTime: null,
  incidents: [],
  incidentsResolved: 0,
  incidentScore: 0,   // 0=poor, 1=ok, 2=good per incident
  checkCalls: 0,
  checkCallLog: [],
  completed: false,
  intervalId: null,
};

// UK CITY COORDINATES on a 400Ã—500 SVG viewport
const UK_CITIES = {
  'London':      {x:285, y:390, label:'London'},
  'Birmingham':  {x:240, y:300, label:'Birmingham'},
  'Manchester':  {x:220, y:235, label:'Manchester'},
  'Leeds':       {x:250, y:220, label:'Leeds'},
  'Glasgow':     {x:190, y:110, label:'Glasgow'},
  'Edinburgh':   {x:215, y:130, label:'Edinburgh'},
  'Bristol':     {x:195, y:360, label:'Bristol'},
  'Cardiff':     {x:185, y:370, label:'Cardiff'},
  'Southampton': {x:255, y:400, label:'Southampton'},
  'Sheffield':   {x:255, y:240, label:'Sheffield'},
  'Newcastle':   {x:255, y:175, label:'Newcastle'},
  'Liverpool':   {x:205, y:245, label:'Liverpool'},
  'Felixstowe':  {x:320, y:345, label:'Felixstowe'},
  'Nottingham':  {x:260, y:275, label:'Nottingham'},
  'Coventry':    {x:250, y:310, label:'Coventry'},
};

const MOTORWAYS = [
  // M1: London â†’ Leeds
  [{x:280,y:380},{x:268,y:340},{x:260,y:300},{x:255,y:260},{x:252,y:230}],
  // M6: Birmingham â†’ Glasgow
  [{x:240,y:305},{x:228,y:265},{x:220,y:240},{x:210,y:200},{x:200,y:160},{x:192,y:120}],
  // M25: London orbital
  [{x:260,y:410},{x:290,y:405},{x:315,y:390},{x:300,y:370},{x:265,y:378}],
  // M4: London â†’ Bristol
  [{x:265,y:388},{x:235,y:385},{x:205,y:375},{x:195,y:363}],
];

function renderTracking(){
  const panel = document.getElementById('tracking-content');
  if(!tracking.active && !tracking.completed){
    panel.innerHTML = `<div class="no-tracking"><div class="big">ğŸ—ºï¸</div><p><strong>No load being tracked</strong><br/>Book a load on the Load Board first,<br/>then click "Track This Load" after booking.</p></div>`;
    return;
  }
  const l = tracking.load;
  const from = UK_CITIES[l.from] || {x:240,y:300};
  const to   = UK_CITIES[l.to]   || {x:285,y:390};
  const pct  = tracking.progress;
  const truckX = from.x + (to.x - from.x) * (pct/100);
  const truckY = from.y + (to.y - from.y) * (pct/100);
  const elapsed = tracking.startTime ? Math.round((Date.now()-tracking.startTime)/60000) : 0;
  const eta = Math.max(0, Math.round((l.miles / 50) * 60 * (1 - pct/100)));

  // Build motorway/road lines
  const mwLines = MOTORWAYS.map(pts=>{
    const d = pts.map((p,i)=>(i===0?`M${p.x},${p.y}`:`L${p.x},${p.y}`)).join(' ');
    return `<path d="${d}" class="map-motorway"/>`;
  }).join('');

  // Active route line
  const routeD = `M${from.x},${from.y} L${to.x},${to.y}`;

  // All city dots
  const cityDots = Object.entries(UK_CITIES).map(([name,c])=>{
    const isFrom = name===l.from, isTo = name===l.to;
    const cls = isFrom?'origin':isTo?'destination':'';
    return `
      <circle class="map-city-dot ${cls}" cx="${c.x}" cy="${c.y}" r="${isFrom||isTo?7:5}"/>
      <text class="map-city-label" x="${c.x+10}" y="${c.y+4}">${name}</text>`;
  }).join('');

  const cpmNum = (l.rate / l.miles).toFixed(2);
  const statusText = tracking.completed ? 'DELIVERED âœ…' : 'EN ROUTE ğŸš›';

  panel.innerHTML = `
  <div class="tracking-wrap">
    <div class="map-panel">
      <div class="map-header">
        <div>
          <div class="map-title">ğŸ—ºï¸ ${l.from} â†’ ${l.to}</div>
          <div class="map-subtitle">${l.vehicle} Â· ${l.goods} Â· ${l.miles} miles</div>
        </div>
        <div class="map-status-pill ${tracking.completed?'idle':'moving'}">${statusText}</div>
      </div>
      <div class="map-body">
        <svg class="uk-map-svg" viewBox="70 80 320 370" xmlns="http://www.w3.org/2000/svg">
          <!-- UK outline simplified -->
          <path d="M180,90 L200,85 L220,95 L240,88 L255,95 L270,90 L285,100 L295,115 L290,135 L280,155 L285,170 L278,185 L290,200 L295,220 L290,240 L300,255 L305,275 L310,295 L305,315 L315,335 L320,355 L315,370 L305,385 L290,400 L270,415 L250,420 L235,415 L220,420 L205,415 L195,405 L185,395 L180,410 L170,405 L175,388 L168,375 L160,360 L165,345 L158,330 L155,310 L162,295 L155,275 L150,255 L155,235 L148,215 L145,195 L150,175 L145,155 L148,135 L155,115 L165,100 Z" fill="#e8eef8" stroke="#cbd5e1" stroke-width="1.5"/>
          <!-- Motorways -->
          ${mwLines}
          <!-- Active route -->
          <path d="${routeD}" class="map-road active-route"/>
          <!-- Cities -->
          ${cityDots}
          <!-- TRUCK -->
          ${!tracking.completed ? `<text x="${truckX-10}" y="${truckY+6}" font-size="20" class="truck-marker">ğŸš›</text>` : `<text x="${to.x-10}" y="${to.y+6}" font-size="20">âœ…</text>`}
          <!-- Labels for route cities -->
          <circle cx="${from.x}" cy="${from.y}" r="9" fill="none" stroke="var(--green)" stroke-width="2"/>
          <circle cx="${to.x}"   cy="${to.y}"   r="9" fill="none" stroke="var(--orange)" stroke-width="2"/>
        </svg>
      </div>
      <div class="journey-bar">
        <div class="journey-route">
          <span class="j-city">${l.from}</span>
          <span class="j-arrow">â†’</span>
          <span class="j-city">${l.to}</span>
          <span class="j-miles">${l.miles} miles total</span>
        </div>
        <div class="journey-track">
          <div class="journey-fill" style="width:${pct}%"></div>
          <div class="journey-truck" style="left:${pct}%">ğŸš›</div>
        </div>
        <div class="journey-stats">
          <div class="j-stat"><div class="jv">${Math.round(l.miles*pct/100)}mi</div><div class="jl">Covered</div></div>
          <div class="j-stat"><div class="jv">${Math.round(l.miles*(1-pct/100))}mi</div><div class="jl">Remaining</div></div>
          <div class="j-stat"><div class="jv">${elapsed}m</div><div class="jl">Elapsed</div></div>
          <div class="j-stat"><div class="jv">${tracking.completed?'Done':eta+'m'}</div><div class="jl">ETA</div></div>
        </div>
      </div>
    </div>
    <!-- CHECK CALLS PANEL -->
    <div class="cc-panel">
      <div class="cc-header">
        <div class="cc-title">ğŸ“ Check-Calls & Updates</div>
        <div class="cc-sub">Stay in contact with your driver throughout the journey</div>
      </div>
      <div class="cc-body">
        <div class="cc-log" id="cc-log">
          ${tracking.checkCallLog.map(e=>`<div class="cc-entry ${e.type}">${e.text}</div>`).join('')}
          ${tracking.checkCallLog.length===0?'<div class="cc-entry system">Journey started. Driver en route from '+l.from+'. Call for regular check-calls!</div>':''}
        </div>
        ${tracking.completed ?
          `<div class="cc-done-msg">âœ… Load delivered! Generate your shift report below.</div>
           <button class="cc-next show" onclick="showShiftReport()">ğŸ“Š View End of Shift Report</button>` :
          `<div class="cc-input-row">
            <input class="cc-input" id="cc-input" placeholder="Type your check-call messageâ€¦" onkeydown="if(event.key==='Enter')sendCheckCall()"/>
            <button class="cc-send" onclick="sendCheckCall()">Send ğŸ“</button>
          </div>
          <button class="cc-next show" style="margin-top:8px;background:linear-gradient(135deg,#16a34a,#15803d)" onclick="advanceJourney()">â© Advance Journey (simulate 20%)</button>`
        }
      </div>
    </div>
  </div>`;
}

const CHECK_CALL_REPLIES = [
  "All good here, boss. Just passed {checkpoint}. On track for {eta}.",
  "Running smoothly. Traffic clear on the M6. Should make delivery no problem.",
  "Just stopped for a 45-minute break as required. Back on road in {eta}.",
  "Delivery point confirmed â€” they're expecting me at {eta}. All good.",
  "Just loaded. Truck is sealed and paperwork signed. Heading your way now.",
  "Bit of traffic near {checkpoint} but nothing major. Still making good time.",
];

const CHECKPOINTS = ['Birmingham','Manchester','Sheffield','the M25','Leeds','Bristol','Coventry','the M6 junction'];

function sendCheckCall(){
  const input = document.getElementById('cc-input');
  const msg = input.value.trim();
  if(!msg) return;
  const l = tracking.load;
  const eta = Math.max(5, Math.round((l.miles/50)*60*(1-tracking.progress/100)));
  const cp = CHECKPOINTS[Math.floor(Math.random()*CHECKPOINTS.length)];
  const reply = CHECK_CALL_REPLIES[Math.floor(Math.random()*CHECK_CALL_REPLIES.length)]
    .replace('{checkpoint}', cp).replace('{eta}', eta+'min');

  tracking.checkCallLog.push({type:'dispatcher', text:'You: '+msg});
  tracking.checkCallLog.push({type:'driver', text:'Driver: '+reply});
  tracking.checkCalls++;
  session.xp += 20;
  updateSessionBar();
  input.value = '';
  showToast('ğŸ“','Check-call complete','+20 XP');
  renderTracking();
  // scroll log to bottom
  setTimeout(()=>{
    const log = document.getElementById('cc-log');
    if(log) log.scrollTop = log.scrollHeight;
  }, 100);
}

function advanceJourney(){
  if(tracking.completed) return;
  tracking.progress = Math.min(100, tracking.progress + 20);
  tracking.milesGone = Math.round(tracking.load.miles * tracking.progress / 100);
  if(tracking.progress >= 100){
    tracking.completed = true;
    tracking.active = false;
    clearInterval(tracking.intervalId);
    tracking.checkCallLog.push({type:'resolved', text:'âœ… DELIVERED â€” Driver has successfully delivered to '+tracking.load.to+'. Paperwork signed.'});
    session.xp += 60;
    updateSessionBar();
    document.getElementById('tracking-badge').style.display = 'none';
    showToast('ğŸ‰','Load delivered successfully!','+60 XP');
  } else {
    // Maybe trigger incident
    if(Math.random() < 0.45 && tracking.incidents.length < 4){
      setTimeout(()=>triggerIncident(), 800);
    }
  }
  renderTracking();
}

// â”€â”€ INCIDENT SYSTEM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const INCIDENTS = [
  {
    icon:'ğŸš§', title:'M6 Motorway Closure', sub:'Major incident reported',
    situation:'Your driver has just called â€” the M6 is completely closed near Junction 15 due to a multi-vehicle accident. Police say it will be closed for at least 2 hours. The delivery deadline is in 3 hours and the detour adds 45 minutes.',
    question:'What do you do as the dispatcher?',
    options:[
      {text:'Contact the broker immediately â€” explain the situation, provide updated ETA, and send driver on the A34 diversion. Update all parties in writing.', score:'good', label:'âœ… Correct'},
      {text:'Tell the driver to wait on the motorway until it reopens â€” it might clear sooner than expected.', score:'poor', label:'âŒ Wrong'},
      {text:'Call the broker but do not mention the delay â€” wait to see if driver makes it in time.', score:'poor', label:'âŒ Wrong'},
      {text:'Email the broker only â€” no need to call. They will see it eventually.', score:'neutral', label:'âš ï¸ Partial'},
    ],
    feedback:{
      good:'Perfect! Proactive communication is the dispatcher\'s most important skill. Broker informed, alternative route sent, ETA updated. This is professional dispatch.',
      poor:'Never keep the broker in the dark. Late communication = damaged relationship and possible penalty charges.',
      neutral:'Email is not enough for urgent situations. Always call first, then follow up in writing.'
    }
  },
  {
    icon:'ğŸ”§', title:'Truck Breakdown', sub:'Driver needs urgent assistance',
    situation:'Your driver has broken down on the A1 near Peterborough. The load is 24 tonnes of chilled dairy products. Recovery is 90 minutes away. The delivery window closes in 4 hours.',
    question:'What is your priority action as dispatcher?',
    options:[
      {text:'Call the broker, explain breakdown, arrange recovery, and check if a replacement vehicle is available to transship the load. Document everything.', score:'good', label:'âœ… Correct'},
      {text:'Wait for the driver to sort it out â€” it\'s their truck, not your problem.', score:'poor', label:'âŒ Wrong'},
      {text:'Call the broker and say the driver is "running slightly late" without mentioning the breakdown.', score:'poor', label:'âŒ Wrong'},
      {text:'Call broker, wait for recovery, do not mention transship option â€” see what happens.', score:'neutral', label:'âš ï¸ Partial'},
    ],
    feedback:{
      good:'Excellent! Breakdown protocol: inform broker immediately, arrange recovery, consider transship, document everything. Chilled goods especially need urgent action.',
      poor:'Dispatchers are responsible for communication and problem-solving. Never ignore or hide a breakdown.',
      neutral:'Good you called, but not mentioning the transship option when the delivery is time-critical shows lack of experience.'
    }
  },
  {
    icon:'â±ï¸', title:'Shipper Not Ready', sub:'Collection delayed at origin',
    situation:'Driver arrived at collection at 08:00 as booked. It is now 10:15 â€” the shipper says the load won\'t be ready until 12:00. This puts the delivery window at serious risk. Detention charges may apply after 2 free hours.',
    question:'What is the correct dispatcher response?',
    options:[
      {text:'Log the arrival time, notify broker of delay, confirm detention clock started at 08:00, get written confirmation from shipper, and recalculate delivery ETA.', score:'good', label:'âœ… Correct'},
      {text:'Tell driver to wait patiently â€” nothing you can do from India.', score:'poor', label:'âŒ Wrong'},
      {text:'Cancel the load and find a new one â€” this is too much trouble.', score:'poor', label:'âŒ Wrong'},
      {text:'Notify broker of delay but forget to log detention time â€” follow up later.', score:'neutral', label:'âš ï¸ Partial'},
    ],
    feedback:{
      good:'Spot on! Detention time must be logged from driver\'s arrival. Written confirmation protects the carrier. Broker must be notified immediately â€” they may have delivery rebooked.',
      poor:'Dispatchers manage situations remotely â€” you have tools and processes for exactly this. Never just wait.',
      neutral:'You notified the broker, good â€” but missing the detention log costs the carrier money. Always document arrival time.'
    }
  },
  {
    icon:'ğŸ“¦', title:'Damaged Goods Discovered', sub:'Driver reports damage at delivery',
    situation:'Your driver has arrived at the delivery point. The consignee is refusing to accept 4 pallets â€” they say the goods are damaged. Driver is unsure if the damage happened in transit or was pre-existing. Consignee wants to reject the entire load.',
    question:'What do you instruct the driver to do?',
    options:[
      {text:'Driver photographs all damage, gets consignee to sign CMR with damage noted (not full rejection). Contact broker and carrier\'s insurer immediately. Do not leave until note is signed.', score:'good', label:'âœ… Correct'},
      {text:'Accept full rejection, bring everything back, and deal with it later.', score:'poor', label:'âŒ Wrong'},
      {text:'Tell driver to argue with the consignee until they accept the full load.', score:'poor', label:'âŒ Wrong'},
      {text:'Driver photographs damage and leaves â€” send email to broker later.', score:'neutral', label:'âš ï¸ Partial'},
    ],
    feedback:{
      good:'Perfect protocol! Photography + signed CMR note with damage notation protects the carrier legally. Never allow full rejection without documentation. Insurer notified immediately.',
      poor:'Full rejection without documentation is a disaster for the carrier. Always get a signed damage note.',
      neutral:'Photography is right but leaving without a signed note is a serious mistake. That note is your legal protection.'
    }
  },
  {
    icon:'â›½', title:'Driver Fuel Crisis', sub:'Unexpected cost issue',
    situation:'Your driver has called â€” he forgot to fill up before starting and is now almost out of fuel on the M1, 40 miles from the nearest services. He has no company card and insufficient personal funds to fill the 44-tonne vehicle.',
    question:'How do you handle this situation?',
    options:[
      {text:'Find the nearest fuel station, arrange for carrier to make a card payment over phone, log the incident, and remind driver of pre-trip checklist for future loads.', score:'good', label:'âœ… Correct'},
      {text:'Tell driver this is his problem â€” he should have filled up before starting.', score:'poor', label:'âŒ Wrong'},
      {text:'Call the broker to explain the situation and ask for help.', score:'neutral', label:'âš ï¸ Partial'},
      {text:'Find alternative driver for the load immediately.', score:'poor', label:'âŒ Wrong'},
    ],
    feedback:{
      good:'Good problem-solving! You found a solution, arranged payment, and used this as a training moment. Pro dispatchers prevent problems with checklists, not just react to them.',
      poor:'Leaving a driver stranded puts the delivery and the carrier at risk. Problem-solving is your job.',
      neutral:'The broker doesn\'t need to know about this internal issue. Handle it with the carrier directly.'
    }
  },
  {
    icon:'ğŸŒ§ï¸', title:'Severe Weather Warning', sub:'Safety alert issued',
    situation:'Met Office has issued a red weather warning for heavy snow across Scotland. Your driver is 80 miles from Glasgow with a 4-hour delivery window. The A74(M) may close. Temperature is -4Â°C.',
    question:'What is your response?',
    options:[
      {text:'Check road conditions on Traffic Scotland, advise driver to proceed carefully or park safely if roads unsafe. Notify broker of potential delay. Driver safety is the priority.', score:'good', label:'âœ… Correct'},
      {text:'Push driver to continue at normal speed â€” the delivery must make it on time.', score:'poor', label:'âŒ Wrong'},
      {text:'Cancel the load and rebook for tomorrow without informing broker first.', score:'poor', label:'âŒ Wrong'},
      {text:'Call broker to warn them but leave the decision entirely to the driver without any guidance.', score:'neutral', label:'âš ï¸ Partial'},
    ],
    feedback:{
      good:'Driver safety ALWAYS comes first. UK law is clear â€” drivers must not be pressured to drive in unsafe conditions. Broker informed, roads checked, driver supported. This is professional dispatch.',
      poor:'Pressuring a driver to continue in dangerous conditions is illegal and deeply unethical. Driver safety is always above delivery targets.',
      neutral:'Informing the broker is right, but not providing any guidance to the driver shows a gap in your incident management.'
    }
  },
];

let pendingIncident = null;

function triggerIncident(){
  const available = INCIDENTS.filter((_,i)=>!tracking.incidents.includes(i));
  if(!available.length) return;
  const idx = Math.floor(Math.random()*INCIDENTS.length);
  if(tracking.incidents.includes(idx)) return;
  tracking.incidents.push(idx);
  const inc = INCIDENTS[idx];
  pendingIncident = inc;
  renderIncident(inc);
  document.getElementById('incident-overlay').classList.add('show');
  tracking.checkCallLog.push({type:'incident', text:'ğŸš¨ INCIDENT: '+inc.title+' â€” Respond immediately!'});
}

function renderIncident(inc){
  document.getElementById('incident-card').innerHTML = `
    <div class="incident-header">
      <div class="incident-icon">${inc.icon}</div>
      <div class="incident-htext">
        <div class="ititle">ğŸš¨ ${inc.title}</div>
        <div class="isub">${inc.sub}</div>
      </div>
    </div>
    <div class="incident-body">
      <div class="incident-situation">${inc.situation}</div>
      <div class="incident-question">${inc.question}</div>
      <div class="incident-options">
        ${inc.options.map((o,i)=>`
          <button class="incident-option" onclick="answerIncident(${i})">${o.text}</button>
        `).join('')}
      </div>
      <div class="incident-feedback" id="inc-feedback"></div>
      <button class="incident-continue" id="inc-continue" onclick="closeIncident()">Continue Journey â†’</button>
    </div>`;
}

function answerIncident(idx){
  const inc = pendingIncident;
  const chosen = inc.options[idx];
  const score = chosen.score;

  // Style all options
  document.querySelectorAll('.incident-option').forEach((btn,i)=>{
    btn.disabled = true;
    if(i===idx) btn.classList.add(score==='good'?'correct':score==='neutral'?'neutral':'wrong');
  });

  const fb = document.getElementById('inc-feedback');
  fb.textContent = inc.feedback[score];
  fb.className = 'incident-feedback show ' + (score==='good'?'good':score==='neutral'?'ok':'poor');

  document.getElementById('inc-continue').classList.add('show');

  let xpEarned = 0;
  if(score==='good'){ xpEarned=40; tracking.incidentScore+=2; }
  else if(score==='neutral'){ xpEarned=15; tracking.incidentScore+=1; }
  else { xpEarned=5; }
  tracking.incidentsResolved++;
  session.xp += xpEarned;
  updateSessionBar();
  showToast(score==='good'?'âœ…':score==='neutral'?'âš ï¸':'âŒ',
    score==='good'?'Correct response!':score==='neutral'?'Partially correct':'Incorrect response',
    '+'+xpEarned+' XP');
  tracking.checkCallLog.push({type:score==='good'?'resolved':score==='neutral'?'system':'incident',
    text: (score==='good'?'âœ… Well handled: ':score==='neutral'?'âš ï¸ Partial response: ':'âŒ Poor response: ') + inc.title});
}

function closeIncident(){
  document.getElementById('incident-overlay').classList.remove('show');
  pendingIncident = null;
  renderTracking();
}

// â”€â”€ START TRACKING (called after booking) â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startTracking(loadId){
  const l = ALL_LOADS.find(ld=>ld.id===loadId);
  if(!l) return;
  tracking.active = true;
  tracking.load = l;
  tracking.progress = 0;
  tracking.milesGone = 0;
  tracking.startTime = Date.now();
  tracking.incidents = [];
  tracking.incidentsResolved = 0;
  tracking.incidentScore = 0;
  tracking.checkCalls = 0;
  tracking.checkCallLog = [];
  tracking.completed = false;
  clearInterval(tracking.intervalId);

  // Show tracking badge on tab
  document.getElementById('tracking-badge').style.display = 'inline';

  // Auto-advance every 45 seconds
  tracking.intervalId = setInterval(()=>{
    if(!tracking.active) return;
    tracking.progress = Math.min(100, tracking.progress + 8);
    tracking.milesGone = Math.round(l.miles * tracking.progress / 100);
    if(tracking.progress >= 100){
      tracking.completed = true;
      tracking.active = false;
      clearInterval(tracking.intervalId);
      tracking.checkCallLog.push({type:'resolved', text:'âœ… DELIVERED â€” '+l.to+'. Paperwork signed.'});
      session.xp += 60;
      updateSessionBar();
      document.getElementById('tracking-badge').style.display = 'none';
      showToast('ğŸ‰','Load delivered!','+60 XP');
      renderTracking();
    } else {
      if(Math.random() < 0.3 && tracking.incidents.length < 3){
        triggerIncident();
      }
    }
    // Refresh if tracking tab is active
    if(document.getElementById('tab-tracking').classList.contains('active')) renderTracking();
  }, 45000);

  showToast('ğŸš›','Tracking started â€” switch to Track Load tab','');
}

// Patch generateCN to add Track button
const _origGenerateCN = generateCN;
generateCN = function(){
  _origGenerateCN.apply(this, arguments);
  // After CN modal appears, patch the "Find Next Load" button to also offer tracking
  setTimeout(()=>{
    const footer = document.querySelector('.cn-footer');
    if(footer && currentLoad){
      const trackBtn = document.createElement('button');
      trackBtn.className = 'btn-confirm';
      trackBtn.style.cssText = 'background:linear-gradient(135deg,#0891b2,#0e7490);border:none;padding:10px 16px;border-radius:8px;cursor:pointer;font-size:13px;font-weight:700;font-family:DM Sans,sans-serif;color:#fff';
      trackBtn.textContent = 'ğŸ—ºï¸ Track This Load';
      trackBtn.onclick = ()=>{
        closeModal('cn-modal');
        startTracking(currentLoad.id);
        // Switch to tracking tab
        document.querySelectorAll('.ex-tab').forEach(t=>t.classList.remove('active'));
        document.querySelectorAll('.tab-panel').forEach(p=>p.classList.remove('active'));
        document.querySelector('[onclick*="tracking"]').classList.add('active');
        document.getElementById('tab-tracking').classList.add('active');
        renderTracking();
      };
      footer.insertBefore(trackBtn, footer.children[1]);
    }
  }, 300);
};

// â”€â”€ LEADERBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getLeaderboard(){
  return JSON.parse(localStorage.getItem('ex_leaderboard') || '[]');
}
function saveLeaderboard(lb){
  localStorage.setItem('ex_leaderboard', JSON.stringify(lb));
}

function submitToLeaderboard(){
  const name = document.getElementById('lb-name-input').value.trim();
  if(!name){ showToast('âš ï¸','Enter your name first',''); return; }

  const grade = getGrade();
  const entry = {
    name, xp:session.xp, loads:session.booked,
    revenue:session.revenue, negoWins:session.negoWins,
    grade, timestamp: Date.now()
  };

  let lb = getLeaderboard();
  // Remove existing entry for same name
  lb = lb.filter(e=>e.name.toLowerCase()!==name.toLowerCase());
  lb.push(entry);
  lb.sort((a,b)=>b.xp-a.xp);
  lb = lb.slice(0,20); // top 20
  saveLeaderboard(lb);

  // Update my score card
  document.getElementById('my-score-card').classList.add('show');
  document.getElementById('my-score-name').textContent = 'ğŸ¦… '+name;
  document.getElementById('my-xp').textContent = session.xp;
  document.getElementById('my-loads').textContent = session.booked;
  document.getElementById('my-revenue').textContent = 'Â£'+session.revenue.toLocaleString();
  document.getElementById('my-grade').textContent = grade;

  renderLeaderboard(name);
  showToast('ğŸ†','Score submitted to leaderboard!','+0 XP');
}

function getGrade(){
  const {booked, xp, negoWins} = session;
  if(xp >= 600 && negoWins >= 4) return 'ğŸ‘‘ Eagle Pro';
  if(xp >= 400 && booked >= 5)   return 'â­ Senior';
  if(xp >= 200 && booked >= 3)   return 'ğŸŸ¢ Dispatcher';
  if(booked >= 1)                return 'ğŸŸ¡ Rookie';
  return 'â€” Ungraded';
}

function renderLeaderboard(myName){
  const lb = getLeaderboard();
  const body = document.getElementById('lb-body');
  if(!lb.length){
    body.innerHTML = '<div class="lb-empty">No scores yet â€” book loads and earn XP to appear here!</div>';
    return;
  }
  const crowns = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
  const rankClass = ['gold','silver','bronze'];
  body.innerHTML = lb.map((e,i)=>{
    const isMe = myName && e.name.toLowerCase()===myName.toLowerCase();
    const crown = i<3 ? `<div class="lb-crown">${crowns[i]}</div>` : `<div class="lb-rank ${rankClass[i]||''}">${i+1}</div>`;
    return `
    <div class="lb-entry ${isMe?'me':''}">
      ${crown}
      <div class="lb-name">
        ${e.name}
        ${isMe?'<span class="lb-me-tag">â† YOU</span>':''}
        <span class="lb-badge">${e.grade}</span>
      </div>
      <div class="lb-stats">
        <div class="lb-xp">âš¡ ${e.xp} XP</div>
        <div class="lb-detail">${e.loads} loads Â· Â£${e.revenue.toLocaleString()}</div>
      </div>
    </div>`;
  }).join('');
}

function clearLeaderboard(){
  if(confirm('Clear the entire leaderboard? This cannot be undone.'))
  { saveLeaderboard([]); renderLeaderboard(); showToast('ğŸ—‘ï¸','Leaderboard cleared',''); }
}

// â”€â”€ END OF SHIFT REPORT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showShiftReport(){
  const grade = getGrade();
  const negoScore = session.negoWins > 0 ? Math.round((session.negoWins / Math.max(session.booked,1))*100)+'%' : '0%';
  const incScore = tracking.incidentsResolved > 0 ? Math.round((tracking.incidentScore / (tracking.incidentsResolved*2))*100)+'%' : 'N/A';
  const cpm = session.revenue > 0 && tracking.load ? (session.revenue / (tracking.load.miles || 1)).toFixed(2) : 'N/A';

  const verdict = session.xp >= 400 ? 'excellent' : session.xp >= 150 ? 'good' : 'poor';
  const verdictData = {
    excellent: {emoji:'ğŸ†', text:'Outstanding Session!', sub:'You have the skills of a professional UK freight dispatcher. Excellent negotiation, proactive communication, and incident handling.'},
    good:      {emoji:'â­', text:'Good Performance', sub:'Solid foundation. Keep practising negotiation and incident response. You are on track to become a confident dispatcher.'},
    poor:      {emoji:'ğŸ“š', text:'Keep Practising', sub:'Every dispatcher starts somewhere. Focus on negotiating above offered rates and completing more loads. Review your incident responses with the instructor.'},
  };
  const vd = verdictData[verdict];

  const xpBreakdown = [
    {label:'Loads booked', val: session.booked*50, note: session.booked+' Ã— 50 XP'},
    {label:'Negotiation wins', val: session.negoWins*80, note: session.negoWins+' wins Ã— 80 XP avg'},
    {label:'Check-calls made', val: tracking.checkCalls*20, note: tracking.checkCalls+' Ã— 20 XP'},
    {label:'Incidents handled', val: tracking.incidentsResolved*25, note: tracking.incidentsResolved+' Ã— avg 25 XP'},
    {label:'Load delivered', val: tracking.completed?60:0, note: tracking.completed?'Journey completed':'Not completed'},
  ];

  const today = new Date().toLocaleDateString('en-GB', {weekday:'long',year:'numeric',month:'long',day:'numeric'});

  document.getElementById('report-modal').innerHTML = `
    <div class="report-header">
      <div class="report-eagle">ğŸ¦…</div>
      <div class="report-title">End of Shift Report</div>
      <div class="report-date">${today} Â· Eagle Exchange Training Session</div>
      <div class="report-grade-badge">${grade}</div>
    </div>
    <div class="report-body">
      <div class="verdict-box ${verdict}">
        <div class="verdict-emoji">${vd.emoji}</div>
        <div class="verdict-text">${vd.text}</div>
        <div class="verdict-sub">${vd.sub}</div>
      </div>
      <div class="report-section">
        <div class="report-section-title">Session Summary</div>
        <div class="report-grid">
          <div class="report-stat highlight"><div class="rv">âš¡ ${session.xp}</div><div class="rl">Total XP Earned</div></div>
          <div class="report-stat"><div class="rv">${session.booked}</div><div class="rl">Loads Booked</div></div>
          <div class="report-stat"><div class="rv">Â£${session.revenue.toLocaleString()}</div><div class="rl">Revenue Secured</div></div>
          <div class="report-stat"><div class="rv">Â£${Math.round(session.revenue*0.08).toLocaleString()}</div><div class="rl">Xeagle Fee (8%)</div></div>
        </div>
      </div>
      <div class="report-section">
        <div class="report-section-title">Performance Breakdown</div>
        <div class="report-breakdown">
          <div class="rb-row"><span class="rb-label">Negotiation Success Rate</span><span class="rb-val ${parseInt(negoScore)>=50?'good':parseInt(negoScore)>=25?'ok':'poor'}">${negoScore}</span></div>
          <div class="rb-row"><span class="rb-label">Best Rate Above Offer</span><span class="rb-val good">${session.bestRateAbove>0?'+Â£'+session.bestRateAbove:'No negotiations above offer'}</span></div>
          <div class="rb-row"><span class="rb-label">Incident Response Score</span><span class="rb-val ${incScore==='N/A'?'':'good'}">${incScore}</span></div>
          <div class="rb-row"><span class="rb-label">Check-Calls Made</span><span class="rb-val ${tracking.checkCalls>=3?'good':tracking.checkCalls>=1?'ok':'poor'}">${tracking.checkCalls}</span></div>
          <div class="rb-row"><span class="rb-label">Incidents Handled</span><span class="rb-val">${tracking.incidentsResolved}</span></div>
          <div class="rb-row"><span class="rb-label">Load Delivery</span><span class="rb-val ${tracking.completed?'good':'ok'}">${tracking.completed?'âœ… Delivered':'Not yet completed'}</span></div>
        </div>
      </div>
      <div class="report-section">
        <div class="report-section-title">XP Breakdown</div>
        <div class="report-breakdown">
          ${xpBreakdown.map(x=>`<div class="rb-row"><span class="rb-label">${x.label} <span style="font-size:11px;color:var(--text3)">(${x.note})</span></span><span class="rb-val ${x.val>0?'good':''}">+${x.val} XP</span></div>`).join('')}
          <div class="rb-row" style="background:rgba(43,43,168,0.04)"><span class="rb-label" style="font-weight:800">TOTAL</span><span class="rb-val" style="font-size:18px">âš¡ ${session.xp} XP</span></div>
        </div>
      </div>
      <div class="report-section">
        <div class="report-section-title">Instructor Note</div>
        <div style="background:rgba(244,121,32,0.06);border-left:3px solid var(--orange);padding:14px 16px;border-radius:0 var(--r-sm) var(--r-sm) 0;font-size:13px;color:var(--text2);line-height:1.7">
          <strong>Focus areas for next session:</strong><br/>
          ${session.booked===0?'â€¢ Book at least 3 loads next session<br/>':''}
          ${session.negoWins===0?'â€¢ Practice rate negotiation â€” aim to get above the offered rate<br/>':''}
          ${tracking.checkCalls<3?'â€¢ Make more check-calls â€” minimum 1 call per hour of journey<br/>':''}
          ${tracking.incidentsResolved===0?'â€¢ No incidents encountered â€” ask your instructor to trigger manual scenarios<br/>':''}
          ${session.xp>=400?'â€¢ Excellent session! Challenge: can you beat your score tomorrow?':'â€¢ Review the negotiation techniques from Week 2 before next session'}
        </div>
      </div>
    </div>
    <div class="report-footer">
      <button class="btn-report-print" onclick="window.print()">ğŸ–¨ï¸ Print Report</button>
      <button class="btn-report-lb" onclick="closeReport();switchTab('leaderboard',document.querySelector('[onclick*=leaderboard]'))">ğŸ† Submit to Leaderboard</button>
      <button class="btn-report-close" onclick="closeReport()">Close</button>
    </div>`;

  document.getElementById('report-overlay').classList.add('show');
}

function closeReport(){
  document.getElementById('report-overlay').classList.remove('show');
}

// â”€â”€ RATE BOOK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderRateBook(){
  const rows = Object.entries(VEHICLE_RATES).map(([v,r])=>{
    const pm = r.pmLow===r.pmHigh ? `Â£${r.pmLow.toFixed(2)}` : `Â£${r.pmLow.toFixed(2)}â€“Â£${r.pmHigh.toFixed(2)}`;
    return `
    <tr style="border-bottom:1px solid rgba(43,43,168,0.08)">
      <td style="padding:11px 14px;font-weight:700;color:var(--navy)">${v}</td>
      <td style="padding:11px 14px;text-align:center;font-size:12px">${r.capacity}</td>
      <td style="padding:11px 14px;text-align:center"><span style="background:rgba(244,121,32,0.1);color:#c45e10;font-weight:700;padding:2px 7px;border-radius:8px">${r.pallets}</span></td>
      <td style="padding:11px 14px;text-align:center"><span style="background:rgba(43,43,168,0.08);color:var(--navy);font-weight:700;padding:2px 7px;border-radius:8px">${r.pallets_e}</span></td>
      <td style="padding:11px 14px;text-align:center;font-weight:800;color:var(--red)">Â£${r.min30}</td>
      <td style="padding:11px 14px;text-align:center;font-weight:800;color:var(--amber)">Â£${r.min50}</td>
      <td style="padding:11px 14px;text-align:center;font-weight:800;color:var(--navy)">${pm}</td>
      <td style="padding:11px 14px;text-align:center;font-weight:700;color:var(--text3)">Â£${r.extraStop}</td>
    </tr>`;
  }).join('');

  document.getElementById('ratebook-content').innerHTML = `
    <div style="max-width:1200px;margin:0 auto">
      <div style="background:linear-gradient(135deg,var(--navy),var(--navy2));border-radius:var(--r);padding:20px 24px;margin-bottom:20px;display:flex;align-items:center;justify-content:space-between">
        <div>
          <div style="font-family:Syne,sans-serif;font-weight:800;font-size:18px;color:#fff">ğŸ“‹ Baaz Sameday Ltd â€” Official Rate Sheet</div>
          <div style="font-size:12px;color:rgba(255,255,255,0.7);margin-top:4px">10 Hill Street, Cleckheaton, BD19 3NP Â· Tel: +44 113 868 9400 Â· Company Reg: 14233856 Â· VAT: GB 425184700</div>
        </div>
        <div style="background:var(--orange);color:#fff;font-family:Syne,sans-serif;font-weight:800;font-size:13px;padding:6px 14px;border-radius:20px">LIVE RATES USED IN SIMULATOR</div>
      </div>

      <div style="background:#fff;border:1px solid var(--border);border-radius:var(--r);box-shadow:var(--sh-sm);overflow:hidden;margin-bottom:20px">
        <div style="background:var(--surf2);padding:12px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:8px">
          <span style="font-size:11px;font-weight:700;color:var(--red)">ğŸ”´ Min Rate = minimum you must charge</span>
          <span style="color:var(--border);font-size:14px">|</span>
          <span style="font-size:11px;font-weight:700;color:var(--amber)">ğŸŸ¡ Market = fair rate (negotiate to here)</span>
          <span style="color:var(--border);font-size:14px">|</span>
          <span style="font-size:11px;font-weight:700;color:var(--green)">ğŸŸ¢ Target = excellent rate (aim for this!)</span>
        </div>
        <div style="overflow-x:auto">
          <table style="width:100%;border-collapse:collapse;font-size:13px">
            <thead>
              <tr style="background:var(--navy)">
                <th style="padding:11px 14px;text-align:left;color:#fff;font-family:Syne,sans-serif;font-size:11px;letter-spacing:.5px">VEHICLE</th>
                <th style="padding:11px 14px;text-align:center;color:rgba(255,255,255,0.8);font-size:11px">CAPACITY</th>
                <th style="padding:11px 14px;text-align:center;color:rgba(255,255,255,0.8);font-size:11px">PALLETS (STD)</th>
                <th style="padding:11px 14px;text-align:center;color:rgba(255,255,255,0.8);font-size:11px">PALLETS (EURO)</th>
                <th style="padding:11px 14px;text-align:center;color:#fca5a5;font-size:11px">MIN â‰¤30mi</th>
                <th style="padding:11px 14px;text-align:center;color:#fcd34d;font-size:11px">MIN â‰¤50mi</th>
                <th style="padding:11px 14px;text-align:center;color:#86efac;font-size:11px">Â£/MILE 50+</th>
                <th style="padding:11px 14px;text-align:center;color:rgba(255,255,255,0.8);font-size:11px">EXTRA STOP</th>
              </tr>
            </thead>
            <tbody>${rows}</tbody>
          </table>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;margin-bottom:20px">
        <div style="background:#fff;border:1px solid var(--border);border-radius:var(--r);padding:18px;box-shadow:var(--sh-sm)">
          <div style="font-size:12px;font-weight:800;text-transform:uppercase;letter-spacing:.5px;color:var(--text3);margin-bottom:10px">ğŸ“Š How Score is Calculated</div>
          <div style="display:flex;flex-direction:column;gap:8px">
            <div style="display:flex;justify-content:space-between;align-items:center;padding:7px 10px;background:rgba(220,38,38,0.06);border-radius:6px">
              <span style="font-size:12px;font-weight:700;color:var(--red)">At Minimum Rate</span>
              <span style="font-weight:800;color:var(--red)">0â€“30</span>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;padding:7px 10px;background:rgba(217,119,6,0.06);border-radius:6px">
              <span style="font-size:12px;font-weight:700;color:var(--amber)">Min â†’ Market Rate</span>
              <span style="font-weight:800;color:var(--amber)">31â€“60</span>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;padding:7px 10px;background:rgba(43,43,168,0.06);border-radius:6px">
              <span style="font-size:12px;font-weight:700;color:var(--navy)">Market â†’ Target Rate</span>
              <span style="font-weight:800;color:var(--navy)">61â€“80</span>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;padding:7px 10px;background:rgba(22,163,74,0.06);border-radius:6px">
              <span style="font-size:12px;font-weight:700;color:var(--green)">At or Above Target</span>
              <span style="font-weight:800;color:var(--green)">81â€“100 â­</span>
            </div>
          </div>
        </div>
        <div style="background:#fff;border:1px solid var(--border);border-radius:var(--r);padding:18px;box-shadow:var(--sh-sm)">
          <div style="font-size:12px;font-weight:800;text-transform:uppercase;letter-spacing:.5px;color:var(--text3);margin-bottom:10px">ğŸ§® Quick Rate Calculator</div>
          <select id="rc-vehicle" style="width:100%;border:1px solid var(--border);border-radius:6px;padding:7px 10px;font-size:12px;font-weight:600;margin-bottom:8px;font-family:DM Sans,sans-serif;outline:none" onchange="calcQuick()">
            ${Object.keys(VEHICLE_RATES).map(v=>`<option>${v}</option>`).join('')}
          </select>
          <input id="rc-miles" type="number" placeholder="Distance in miles" style="width:100%;border:1px solid var(--border);border-radius:6px;padding:7px 10px;font-size:12px;margin-bottom:8px;font-family:DM Sans,sans-serif;outline:none" oninput="calcQuick()"/>
          <div id="rc-result" style="background:var(--surf2);border-radius:6px;padding:10px;font-size:12px;font-weight:700;color:var(--text3);text-align:center">Enter distance to calculate</div>
        </div>
        <div style="background:#fff;border:1px solid var(--border);border-radius:var(--r);padding:18px;box-shadow:var(--sh-sm)">
          <div style="font-size:12px;font-weight:800;text-transform:uppercase;letter-spacing:.5px;color:var(--text3);margin-bottom:10px">ğŸ¦ Bank Details</div>
          <div style="font-size:13px;line-height:2;color:var(--text2)">
            <strong>Account:</strong> Baaz Sameday Ltd<br/>
            <strong>Sort Code:</strong> 60-83-71<br/>
            <strong>Account No:</strong> 55967585<br/>
            <strong>VAT No:</strong> GB 425184700<br/>
            <strong>Payment Terms:</strong> 30 days from invoice
          </div>
        </div>
      </div>
    </div>`;
}

function calcQuick(){
  const v = document.getElementById('rc-vehicle').value;
  const m = parseInt(document.getElementById('rc-miles').value);
  const res = document.getElementById('rc-result');
  if(!v||!m||m<1){ res.textContent='Enter distance to calculate'; return; }
  const r = calcRates(v, m);
  res.innerHTML = `<div style="display:flex;justify-content:space-around">
    <div style="text-align:center"><div style="color:var(--red);font-size:15px;font-weight:800">Â£${r.min}</div><div style="font-size:9px;color:#8888aa">Minimum</div></div>
    <div style="text-align:center"><div style="color:var(--amber);font-size:15px;font-weight:800">Â£${r.market}</div><div style="font-size:9px;color:#8888aa">Market</div></div>
    <div style="text-align:center"><div style="color:var(--green);font-size:15px;font-weight:800">Â£${r.target}</div><div style="font-size:9px;color:#8888aa">Target</div></div>
  </div>`;
}

// Init leaderboard on load
renderLeaderboard();
</script>
